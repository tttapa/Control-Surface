<!-- HTML header for doxygen 1.9.2-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Control Surface: 1.FilteredAnalog-Advanced.ino</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript">
window.MathJax = {
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  }
};
</script>
<script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300&family=Roboto:wght@400&family=Roboto:wght@500&display=swap" rel="stylesheet">
<link href="../../custom_stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
  <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Control Surface<span id="projectnumber">&#160;<code><a href="/Control-Surface/">stm32</a></code></span>
   </div>
   <div id="projectbrief">MIDI Control Surface library for Arduino</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle"><div class="title">1.FilteredAnalog-Advanced.ino</div></div>
</div><!--header-->
<div class="contents">
<h1><a class="anchor" id="autotoc_md153"></a>
1.FilteredAnalog-Advanced</h1>
<p >This examples shows how to filter an analog input, so you can get the position of a knob or fader without noise.</p>
<dl class="section user"><dt>Boards:</dt><dd>AVR, AVR USB, Nano Every, Nano 33 IoT, Nano 33 BLE, Pi Pico, Due, Teensy 3.x, ESP8266, ESP32</dd></dl>
<h2><a class="anchor" id="autotoc_md154"></a>
Connections</h2>
<ul>
<li>A0: wiper of a potentiometer</li>
</ul>
<p >Connect the left terminal of the potentiometer to ground, and the right one to V<sub>CC</sub>.</p>
<h2><a class="anchor" id="autotoc_md155"></a>
Behavior</h2>
<ul>
<li>Upload the sketch to the Arduino, and open the Serial Monitor (<code>CTRL+Shift+M</code>)</li>
<li>When you turn the potentiometer, you should see the position of the potentiometer being printed as a number between 0 and 1023.</li>
<li>The analog input is filtered, so there shouldn't be any noise on the position. If there is, check your wiring, and make sure that the resistance of the potentiometer isn't too high (10 kÎ© is ideal).</li>
</ul>
<p >A simpler version of this example can be found in <a class="el" href="../../d3/dbe/1_8FilteredAnalog_8ino-example.html">1.FilteredAnalog.ino</a>.</p>
<p >Written by PieterP, 2019-10-10 <br  />
 <a href="https://github.com/tttapa/Arduino-Helpers">https://github.com/tttapa/Arduino-Helpers</a></p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="comment">// Include the library</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../dc/de6/Arduino__Helpers_8h.html">Arduino_Helpers.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d8/df3/FilteredAnalog_8hpp.html">AH/Hardware/FilteredAnalog.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d1/dd0/MillisMicrosTimer_8hpp.html">AH/Timing/MillisMicrosTimer.hpp</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create a filtered analog object on pin A0:</span></div>
<div class="line">FilteredAnalog&lt;10,       <span class="comment">// Output precision in bits</span></div>
<div class="line">               2,        <span class="comment">// The amount of filtering</span></div>
<div class="line">               uint16_t, <span class="comment">// The integer type for the filter calculations</span></div>
<div class="line">               <a id="a0" name="a0"></a><a class="code hl_typedef" href="../../dc/d69/namespaceAH.html#a30fffbcff933a72fdd7bfc161d386bef">analog_t</a>  <span class="comment">// The integer type for the upscaled analog values</span></div>
<div class="line">              &gt;</div>
<div class="line">  analog = A0;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// If you want more filtering, you can increase the filter shift factor.</span></div>
<div class="line"><span class="comment">// The number of bits required for the intermediate calculations increases if</span></div>
<div class="line"><span class="comment">// you do so, so you have to use a larger type as well.</span></div>
<div class="line">FilteredAnalog&lt;10,      <span class="comment">// Output precision in bits</span></div>
<div class="line">               6,       <span class="comment">// The amount of filtering</span></div>
<div class="line">               uint32_t <span class="comment">// The integer type for the filter calculations</span></div>
<div class="line">              &gt;</div>
<div class="line">  moreFiltering = A0;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// If you don&#39;t care about the specific settings, and just want a</span></div>
<div class="line"><span class="comment">// default that works, you can use the following:</span></div>
<div class="line">FilteredAnalog&lt;&gt; simpleAnalog = A0;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> setup() {</div>
<div class="line">  Serial.begin(115200);</div>
<div class="line">  <span class="keywordflow">while</span> (!Serial);</div>
<div class="line">  <span class="comment">// Select the correct ADC resolution</span></div>
<div class="line">  FilteredAnalog&lt;&gt;::setupADC();</div>
<div class="line">  <span class="comment">// If you want, you can add mapping functions to invert the input, for example</span></div>
<div class="line">  analog.invert();</div>
<div class="line">  <span class="comment">// Initialize the filter to whatever the value on the input is right now</span></div>
<div class="line">  <span class="comment">// (otherwise, the filter is initialized to zero and you get transients)</span></div>
<div class="line">  analog.resetToCurrentValue();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> loop() {</div>
<div class="line">  <span class="comment">// Read the analog input every millisecond, and print if the value has changed</span></div>
<div class="line">  <span class="keyword">static</span> Timer&lt;millis&gt; timer = 1; <span class="comment">// ms</span></div>
<div class="line">  <span class="keywordflow">if</span> (timer &amp;&amp; analog.update())</div>
<div class="line">    Serial.println(analog.getValue());</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Explanation:</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// analog.update() reads the analog input, applies the filters,</span></div>
<div class="line">  <span class="comment">// saves the value, and returns true if the value has changed.</span></div>
<div class="line">  <span class="comment">// You can then retreive the new value using analog.getValue().</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Timer is just a &quot;Blink Without Delay&quot; wrapper, it returns true</span></div>
<div class="line">  <span class="comment">// every time the specified amount of time has passed.</span></div>
<div class="line">}</div>
<div class="ttc" id="aArduino__Helpers_8h_html"><div class="ttname"><a href="../../dc/de6/Arduino__Helpers_8h.html">Arduino_Helpers.h</a></div><div class="ttdoc">Dummy header file for Arduino builder.</div></div>
<div class="ttc" id="aFilteredAnalog_8hpp_html"><div class="ttname"><a href="../../d8/df3/FilteredAnalog_8hpp.html">FilteredAnalog.hpp</a></div></div>
<div class="ttc" id="aMillisMicrosTimer_8hpp_html"><div class="ttname"><a href="../../d1/dd0/MillisMicrosTimer_8hpp.html">MillisMicrosTimer.hpp</a></div></div>
<div class="ttc" id="anamespaceAH_html_a30fffbcff933a72fdd7bfc161d386bef"><div class="ttname"><a href="../../dc/d69/namespaceAH.html#a30fffbcff933a72fdd7bfc161d386bef">AH::analog_t</a></div><div class="ttdeci">uint16_t analog_t</div><div class="ttdoc">The type returned from analogRead and similar functions.</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d35/Hardware-Types_8hpp_source.html#l00015">Hardware-Types.hpp:15</a></div></div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4
</small></address>
</body>
</html>
