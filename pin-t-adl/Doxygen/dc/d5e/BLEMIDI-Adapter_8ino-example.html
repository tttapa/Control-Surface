<!-- HTML header for doxygen 1.10.0-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Control Surface: BLEMIDI-Adapter.ino</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../clipboard.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
window.MathJax = {
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  }
};
</script>
<script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300&family=Roboto:wght@400&family=Roboto:wght@500&display=swap" rel="stylesheet">
<link href="../../custom_stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Control Surface<span id="projectnumber">&#160;<code><a href="/Control-Surface/">pin-t-adl</a></code></span>
   </div>
   <div id="projectbrief">MIDI Control Surface library for Arduino</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">BLEMIDI-Adapter.ino</div></div>
</div><!--header-->
<div class="contents">
<h1><a class="anchor" id="blemidi-adapter"></a>
BLEMIDI-Adapter</h1>
<p>Turns an Arduino into a Bluetooth Low Energy (BLE) to 5-pin DIN MIDI adapter.</p>
<dl class="section user"><dt>Boards: <b class="boards-info" title="Control Surface&apos;s automated continuous integration workflows regularly verify that this example compiles successfully for the following boards. The list is not exhaustive, and the example will most likely work on other boards as well (perhaps requiring slight modifications).">ðŸ›ˆ</b> </dt><dd>Nano 33 IoT, Nano 33 BLE, ESP32, ESP32-S3, Pi Pico W</dd></dl>
<h2><a class="anchor" id="configuration"></a>
Configuration</h2>
<ul>
<li>If you're using a Pi Pico W, you'll have to enable the Bluetooth stack from the <em>Tools &gt; IP/Bluetooth Stack</em> menu in the IDE.</li>
<li>If you're using an ESP32, you can optionally switch to the NimBLE backend by installing the <a href="https://github.com/h2zero/NimBLE-Arduino">h2zero/NimBLE-Arduino</a> library, and adding <code>#define CS_USE_NIMBLE</code> at the top of this sketch.</li>
<li>If you're not using a Pico or an ESP32, you'll have to install the <a href="https://github.com/arduino-libraries/ArduinoBLE">ArduinoBLE</a> library.</li>
</ul>
<h2><a class="anchor" id="connections-37"></a>
Connections</h2>
<ul>
<li>TXD: connected to a MIDI 5-pin DIN output connector (with series resistor, possibly through a buffer)</li>
<li>RXD: connected to a MIDI 5-pin DIN input connector (with an optocoupler)</li>
</ul>
<p>See <a href="https://midi.org/specifications/midi-transports-specifications/5-pin-din-electrical-specs">https://midi.org/specifications/midi-transports-specifications/5-pin-din-electrical-specs</a> for the schematic, optocoupler models and resistor values.</p>
<h2><a class="anchor" id="behavior-41"></a>
Behavior</h2>
<ul>
<li>The Arduino will advertise itself as a Bluetooth Low Energy MIDI device with the name <code>MIDI Adapter</code>.</li>
<li>When you connect to the Arduino using your phone or computer, the built-in LED turns on to indicate that the connection was successful.</li>
<li>Any MIDI messages sent to the Arduino over BLE are sent out to the 5-pin DIN output connector.</li>
<li>Any MIDI messages sent to the Arduino through the 5-pin DIN input connector are sent over BLE.</li>
</ul>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="../../db/d99/md_pages_MIDI-over-BLE.html">MIDI over BLE</a> </dd>
<dd>
<a class="el" href="../../d3/df7/midi-tutorial.html">MIDI Tutorial</a></dd></dl>
<p>Written by PieterP, 2024-01-21 <br  />
 <a href="https://github.com/tttapa/Control-Surface">https://github.com/tttapa/Control-Surface</a></p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../db/dbf/Control__Surface_8h.html">Control_Surface.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../df/ded/BluetoothMIDI__Interface_8hpp.html">MIDI_Interfaces/BluetoothMIDI_Interface.hpp</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Instantiate a MIDI over BLE interface</span></div>
<div class="line"><a id="_a0" name="_a0"></a><a class="code hl_struct" href="../../df/d43/structBluetoothMIDI__Interface.html">BluetoothMIDI_Interface</a> midi_ble;</div>
<div class="line"><span class="comment">// Instantiate a 5-pin DIN MIDI interface (on the TX and RX pins of Serial1)</span></div>
<div class="line"><a id="_a1" name="_a1"></a><a class="code hl_class" href="../../d9/d78/classHardwareSerialMIDI__Interface.html">HardwareSerialMIDI_Interface</a> midi_ser {Serial1};</div>
<div class="line"><span class="comment">// Instantiate the pipe to connect the two interfaces</span></div>
<div class="line"><a class="code hl_typedef" href="../../df/ddc/group__MIDI__Routing.html#ga987286a8b6dfd1b157a8fde75c203627">BidirectionalMIDI_Pipe</a> pipes;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> setup() {</div>
<div class="line">  <span class="comment">// Change the name of the BLE device (must be done before initializing it)</span></div>
<div class="line">  midi_ble.<a id="a2" name="a2"></a><a class="code hl_function" href="../../d0/dea/classGenericBLEMIDI__Interface.html#ab3a256e7d9fad73fa57de7c1fedf51c5">setName</a>(<span class="stringliteral">&quot;MIDI Adapter&quot;</span>);</div>
<div class="line">  <span class="comment">// Manually route MIDI input from the serial interface to the BLE interface,</span></div>
<div class="line">  <span class="comment">// and the MIDI input from the BLE interface to the serial interface</span></div>
<div class="line">  midi_ser | pipes | midi_ble;</div>
<div class="line">  <span class="comment">// Initialize the MIDI interfaces</span></div>
<div class="line">  <a id="a3" name="a3"></a><a class="code hl_function" href="../../d1/d55/classAH_1_1Updatable.html#a4f7077a56ec41a07f5a54dd8b3828984">MIDI_Interface::beginAll</a>();</div>
<div class="line">  <span class="comment">// Initialize the built-in LED</span></div>
<div class="line">  pinMode(LED_BUILTIN, <a id="a4" name="a4"></a><a class="code hl_variable" href="../../d2/d3c/Arduino-Hardware-Types_8hpp.html#ad01d99486fd89841afe767b337b8dc92">OUTPUT</a>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> loop() {</div>
<div class="line">  <span class="comment">// Continuously poll all interfaces and route the traffic between them</span></div>
<div class="line">  <a id="a5" name="a5"></a><a class="code hl_function" href="../../d1/d55/classAH_1_1Updatable.html#a44e05f733dace05adcf585b5a17be292">MIDI_Interface::updateAll</a>();</div>
<div class="line">  <span class="comment">// Display the connection status using the built-in LED</span></div>
<div class="line">  <a class="code hl_function" href="../../db/dd3/group__AH__ExtIO.html#gaff89e0a727f5b97e0618b8f2f65b3356">digitalWrite</a>(LED_BUILTIN, midi_ble.<a id="a6" name="a6"></a><a class="code hl_function" href="../../d0/dea/classGenericBLEMIDI__Interface.html#a80178eafbc14f5434c65b0a8413c12c7">isConnected</a>() ? <a id="a7" name="a7"></a><a class="code hl_variable" href="../../d2/d3c/Arduino-Hardware-Types_8hpp.html#a4b2f87da16a1a26dce6e6ba3fbe5f572">HIGH</a> : <a id="a8" name="a8"></a><a class="code hl_variable" href="../../d2/d3c/Arduino-Hardware-Types_8hpp.html#a05bc6f80bb782de0d489a41bdb652305">LOW</a>);</div>
<div class="line">}</div>
<div class="ttc" id="aArduino-Hardware-Types_8hpp_html_a05bc6f80bb782de0d489a41bdb652305"><div class="ttname"><a href="../../d2/d3c/Arduino-Hardware-Types_8hpp.html#a05bc6f80bb782de0d489a41bdb652305">LOW</a></div><div class="ttdeci">constexpr PinStatus_t LOW</div><div class="ttdef"><b>Definition</b> <a href="../../d2/d3c/Arduino-Hardware-Types_8hpp_source.html#l00057">Arduino-Hardware-Types.hpp:57</a></div></div>
<div class="ttc" id="aArduino-Hardware-Types_8hpp_html_a4b2f87da16a1a26dce6e6ba3fbe5f572"><div class="ttname"><a href="../../d2/d3c/Arduino-Hardware-Types_8hpp.html#a4b2f87da16a1a26dce6e6ba3fbe5f572">HIGH</a></div><div class="ttdeci">constexpr PinStatus_t HIGH</div><div class="ttdef"><b>Definition</b> <a href="../../d2/d3c/Arduino-Hardware-Types_8hpp_source.html#l00056">Arduino-Hardware-Types.hpp:56</a></div></div>
<div class="ttc" id="aArduino-Hardware-Types_8hpp_html_ad01d99486fd89841afe767b337b8dc92"><div class="ttname"><a href="../../d2/d3c/Arduino-Hardware-Types_8hpp.html#ad01d99486fd89841afe767b337b8dc92">OUTPUT</a></div><div class="ttdeci">constexpr PinMode_t OUTPUT</div><div class="ttdef"><b>Definition</b> <a href="../../d2/d3c/Arduino-Hardware-Types_8hpp_source.html#l00059">Arduino-Hardware-Types.hpp:59</a></div></div>
<div class="ttc" id="aBluetoothMIDI__Interface_8hpp_html"><div class="ttname"><a href="../../df/ded/BluetoothMIDI__Interface_8hpp.html">BluetoothMIDI_Interface.hpp</a></div></div>
<div class="ttc" id="aControl__Surface_8h_html"><div class="ttname"><a href="../../db/dbf/Control__Surface_8h.html">Control_Surface.h</a></div><div class="ttdoc">The main header file that includes all Control-Surface header files.</div></div>
<div class="ttc" id="aclassAH_1_1Updatable_html_a44e05f733dace05adcf585b5a17be292"><div class="ttname"><a href="../../d1/d55/classAH_1_1Updatable.html#a44e05f733dace05adcf585b5a17be292">AH::Updatable&lt; MIDI_Interface &gt;::updateAll</a></div><div class="ttdeci">static void updateAll()</div><div class="ttdoc">Update all enabled instances of this class.</div><div class="ttdef"><b>Definition</b> <a href="../../d4/d93/Updatable_8hpp_source.html#l00186">Updatable.hpp:186</a></div></div>
<div class="ttc" id="aclassAH_1_1Updatable_html_a4f7077a56ec41a07f5a54dd8b3828984"><div class="ttname"><a href="../../d1/d55/classAH_1_1Updatable.html#a4f7077a56ec41a07f5a54dd8b3828984">AH::Updatable&lt; MIDI_Interface &gt;::beginAll</a></div><div class="ttdeci">static void beginAll()</div><div class="ttdoc">Begin all enabled instances of this class.</div><div class="ttdef"><b>Definition</b> <a href="../../d4/d93/Updatable_8hpp_source.html#l00182">Updatable.hpp:182</a></div></div>
<div class="ttc" id="aclassGenericBLEMIDI__Interface_html_a80178eafbc14f5434c65b0a8413c12c7"><div class="ttname"><a href="../../d0/dea/classGenericBLEMIDI__Interface.html#a80178eafbc14f5434c65b0a8413c12c7">GenericBLEMIDI_Interface::isConnected</a></div><div class="ttdeci">bool isConnected() const</div><div class="ttdoc">Returns true if a BLE central is currently connected.</div><div class="ttdef"><b>Definition</b> <a href="../../d5/d61/GenericBLEMIDI__Interface_8hpp_source.html#l00057">GenericBLEMIDI_Interface.hpp:57</a></div></div>
<div class="ttc" id="aclassGenericBLEMIDI__Interface_html_ab3a256e7d9fad73fa57de7c1fedf51c5"><div class="ttname"><a href="../../d0/dea/classGenericBLEMIDI__Interface.html#ab3a256e7d9fad73fa57de7c1fedf51c5">GenericBLEMIDI_Interface::setName</a></div><div class="ttdeci">void setName(const char *name)</div><div class="ttdoc">Set the BLE device name.</div></div>
<div class="ttc" id="aclassHardwareSerialMIDI__Interface_html"><div class="ttname"><a href="../../d9/d78/classHardwareSerialMIDI__Interface.html">HardwareSerialMIDI_Interface</a></div><div class="ttdoc">A class for MIDI interfaces sending and receiving MIDI messages over a Hardware Serial port.</div><div class="ttdef"><b>Definition</b> <a href="../../d1/d23/SerialMIDI__Interface_8hpp_source.html#l00106">SerialMIDI_Interface.hpp:107</a></div></div>
<div class="ttc" id="agroup__AH__ExtIO_html_gaff89e0a727f5b97e0618b8f2f65b3356"><div class="ttname"><a href="../../db/dd3/group__AH__ExtIO.html#gaff89e0a727f5b97e0618b8f2f65b3356">AH::ExtIO::digitalWrite</a></div><div class="ttdeci">void digitalWrite(pin_t pin, PinStatus_t val)</div><div class="ttdoc">An ExtIO version of the Arduino function.</div><div class="ttdef"><b>Definition</b> <a href="../../d6/d3c/ExtendedInputOutput_8cpp_source.html#l00043">ExtendedInputOutput.cpp:43</a></div></div>
<div class="ttc" id="agroup__MIDI__Routing_html_ga987286a8b6dfd1b157a8fde75c203627"><div class="ttname"><a href="../../df/ddc/group__MIDI__Routing.html#ga987286a8b6dfd1b157a8fde75c203627">BidirectionalMIDI_Pipe</a></div><div class="ttdeci">std::pair&lt; MIDI_Pipe, MIDI_Pipe &gt; BidirectionalMIDI_Pipe</div><div class="ttdoc">A bidirectional pipe consists of two unidirectional pipes.</div><div class="ttdef"><b>Definition</b> <a href="../../dd/ddf/MIDI__Pipes_8hpp_source.html#l00600">MIDI_Pipes.hpp:600</a></div></div>
<div class="ttc" id="astructBluetoothMIDI__Interface_html"><div class="ttname"><a href="../../df/d43/structBluetoothMIDI__Interface.html">BluetoothMIDI_Interface</a></div><div class="ttdoc">A class for MIDI interfaces sending MIDI messages over a Bluetooth Low Energy (BLE) connection.</div><div class="ttdef"><b>Definition</b> <a href="../../df/ded/BluetoothMIDI__Interface_8hpp_source.html#l00077">BluetoothMIDI_Interface.hpp:77</a></div></div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
