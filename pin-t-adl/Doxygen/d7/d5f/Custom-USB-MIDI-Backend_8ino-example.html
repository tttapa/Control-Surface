<!-- HTML header for doxygen 1.10.0-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Control Surface: Custom-USB-MIDI-Backend.ino</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../clipboard.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
window.MathJax = {
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  }
};
</script>
<script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300&family=Roboto:wght@400&family=Roboto:wght@500&display=swap" rel="stylesheet">
<link href="../../custom_stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Control Surface<span id="projectnumber">&#160;<code><a href="/Control-Surface/">pin-t-adl</a></code></span>
   </div>
   <div id="projectbrief">MIDI Control Surface library for Arduino</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">Custom-USB-MIDI-Backend.ino</div></div>
</div><!--header-->
<div class="contents">
<h1><a class="anchor" id="custom-usb-midi-backend"></a>
Custom-USB-MIDI-Backend</h1>
<p>This is an example that demonstrates how to extend the library using your own MIDI USB backend. It defines a class for sending and receiving raw MIDI USB packets that can be plugged into Control Surface's <a class="el" href="../../de/d05/classUSBMIDI__Interface.html" title="A class for MIDI interfaces sending MIDI messages over a USB MIDI connection.">USBMIDI_Interface</a> class.</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="../../d6/d0f/USBMIDI__Teensy3_8hpp.html">src/MIDI_Interfaces/USBMIDI/USBMIDI_Teensy3.hpp</a> </dd>
<dd>
<a class="el" href="../../d1/d7f/USBMIDI__MIDIUSB_8hpp.html">src/MIDI_Interfaces/USBMIDI/USBMIDI_MIDIUSB.hpp</a> </dd>
<dd>
<a class="el" href="../../dc/dc1/USBMIDI__Adafruit__TinyUSB_8hpp.html">src/MIDI_Interfaces/USBMIDI/USBMIDI_Adafruit_TinyUSB.hpp</a> </dd>
<dd>
<a class="el" href="../../df/d33/USBHostMIDI__Interface_8hpp.html">src/MIDI_Interfaces/USBHostMIDI_Interface.hpp</a></dd></dl>
<dl class="section user"><dt>Boards: <b class="boards-info" title="Control Surface&apos;s automated continuous integration workflows regularly verify that this example compiles successfully for the following boards. The list is not exhaustive, and the example will most likely work on other boards as well (perhaps requiring slight modifications).">ðŸ›ˆ</b> </dt><dd>AVR, AVR USB, Nano Every, Due, Nano 33 IoT, Nano 33 BLE, UNO R4, Pi Pico, Teensy 3.x, ESP32</dd></dl>
<h2><a class="anchor" id="connections-63"></a>
Connections</h2>
<p>None.</p>
<h2><a class="anchor" id="behavior-67"></a>
Behavior</h2>
<ul>
<li>Prints the raw MIDI USB packets to the Serial Monitor.</li>
<li>Receives no MIDI input.</li>
</ul>
<h2><a class="anchor" id="mapping-40"></a>
Mapping</h2>
<p>None.</p>
<p>Written by PieterP, 2022-05-28 <br  />
 <a href="https://github.com/tttapa/Control-Surface">https://github.com/tttapa/Control-Surface</a></p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../db/dbf/Control__Surface_8h.html">Control_Surface.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// This class defines how to send and receive MIDI data using your custom</span></div>
<div class="line"><span class="comment">// backend.</span></div>
<div class="line"><span class="keyword">struct </span>MyUSBMIDIBackend {</div>
<div class="line">  <span class="comment">// USB MIDI packages are 4 bytes.</span></div>
<div class="line">  <span class="keyword">using </span>MIDIUSBPacket_t = <a id="_a0" name="_a0"></a><a class="code hl_class" href="../../d5/d09/classAH_1_1SPIShiftRegisterOut.html">AH::Array&lt;uint8_t, 4&gt;</a>;</div>
<div class="line">  <span class="comment">// This method is optional. It is called once upon initialization.</span></div>
<div class="line">  <span class="keywordtype">void</span> begin() { Serial.<a id="a1" name="a1"></a><a class="code hl_function" href="../../d5/d09/classAH_1_1SPIShiftRegisterOut.html#a7c3e14d99bd3dc0e3670d6956dafcaf2">begin</a>(115200); }</div>
<div class="line">  <span class="comment">// Read a single packet. Return a packet of all zeros if there is no packet.</span></div>
<div class="line">  MIDIUSBPacket_t read() { <span class="keywordflow">return</span> MIDIUSBPacket_t {}; }</div>
<div class="line">  <span class="comment">// Write a single packet to the output buffer.</span></div>
<div class="line">  <span class="keywordtype">void</span> write(MIDIUSBPacket_t p) { Serial &lt;&lt; <a id="_a2" name="_a2"></a><a class="code hl_struct" href="../../d2/d57/structAH_1_1HexDump.html">AH::HexDump</a>(p.data) &lt;&lt; endl; }</div>
<div class="line">  <span class="comment">// Transmit the output buffer immediately.</span></div>
<div class="line">  <span class="keywordtype">void</span> sendNow() { Serial.flush(); }</div>
<div class="line">  <span class="comment">// Should the sendNow method be called after each message? Return false if</span></div>
<div class="line">  <span class="comment">// your backend can send the data in the output buffer asynchronously and</span></div>
<div class="line">  <span class="comment">// automatically. Return true if that&#39;s not the case, and an explicit call to</span></div>
<div class="line">  <span class="comment">// sendNow is required.</span></div>
<div class="line">  <span class="keywordtype">bool</span> preferImmediateSend() { <span class="keywordflow">return</span> <span class="keyword">false</span>; }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// This is the actual MIDI interface that makes use of the backend defined above.</span></div>
<div class="line"><span class="keyword">struct </span>MyUSBMIDI_Interface : <a id="_a3" name="_a3"></a><a class="code hl_class" href="../../dd/d0e/classGenericUSBMIDI__Interface.html">GenericUSBMIDI_Interface</a>&lt;MyUSBMIDIBackend&gt; {</div>
<div class="line">  MyUSBMIDI_Interface() = <span class="keywordflow">default</span>;</div>
<div class="line">  <span class="keyword">using </span>MIDIUSBPacket_t = MyUSBMIDIBackend::MIDIUSBPacket_t;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Instantiate the MIDI interface to use.</span></div>
<div class="line">MyUSBMIDI_Interface midi;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> setup() {</div>
<div class="line">  <a id="a4" name="a4"></a><a class="code hl_variable" href="../../d9/d38/Control__Surface__Class_8cpp.html#af7a5d250297d82b2b29605dd7ac250df">Control_Surface</a>.<a id="a5" name="a5"></a><a class="code hl_function" href="../../dc/d45/classControl__Surface__.html#ab0bdf5cca484fb2ba637c39384b27fb2">begin</a>();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> loop() {</div>
<div class="line">  <span class="keyword">static</span> Timer&lt;millis&gt; timer {1000};</div>
<div class="line">  <span class="keywordflow">if</span> (timer)</div>
<div class="line">    <span class="comment">// As an example, send a MIDI timing clock message every second.</span></div>
<div class="line">    <a class="code hl_variable" href="../../d9/d38/Control__Surface__Class_8cpp.html#af7a5d250297d82b2b29605dd7ac250df">Control_Surface</a>.<a id="a6" name="a6"></a><a class="code hl_function" href="../../d6/d72/classMIDI__Sender.html#af50be88ea5127b679e4ea7445dfad46b">sendRealTime</a>(<a id="a7" name="a7"></a><a class="code hl_enumvalue" href="../../dc/d40/MIDI__MessageTypes_8hpp.html#a0f3f6ac1a61700bdea6873fdfe9248f5a1ddcb3ed2c3d2c2db2300553751a0271">MIDIMessageType::TimingClock</a>);</div>
<div class="line">  <a class="code hl_variable" href="../../d9/d38/Control__Surface__Class_8cpp.html#af7a5d250297d82b2b29605dd7ac250df">Control_Surface</a>.<a id="a8" name="a8"></a><a class="code hl_function" href="../../dc/d45/classControl__Surface__.html#afe461d27b9c48d5921c00d521181f12f">loop</a>();</div>
<div class="line">}</div>
<div class="ttc" id="aControl__Surface_8h_html"><div class="ttname"><a href="../../db/dbf/Control__Surface_8h.html">Control_Surface.h</a></div><div class="ttdoc">The main header file that includes all Control-Surface header files.</div></div>
<div class="ttc" id="aControl__Surface__Class_8cpp_html_af7a5d250297d82b2b29605dd7ac250df"><div class="ttname"><a href="../../d9/d38/Control__Surface__Class_8cpp.html#af7a5d250297d82b2b29605dd7ac250df">Control_Surface</a></div><div class="ttdeci">Control_Surface_ &amp; Control_Surface</div><div class="ttdoc">A predefined instance of the Control Surface to use in the Arduino sketches.</div><div class="ttdef"><b>Definition</b> <a href="../../d9/d38/Control__Surface__Class_8cpp_source.html#l00338">Control_Surface_Class.cpp:338</a></div></div>
<div class="ttc" id="aMIDI__MessageTypes_8hpp_html_a0f3f6ac1a61700bdea6873fdfe9248f5a1ddcb3ed2c3d2c2db2300553751a0271"><div class="ttname"><a href="../../dc/d40/MIDI__MessageTypes_8hpp.html#a0f3f6ac1a61700bdea6873fdfe9248f5a1ddcb3ed2c3d2c2db2300553751a0271">MIDIMessageType::TimingClock</a></div><div class="ttdeci">@ TimingClock</div><div class="ttdoc">Timing Clock System Real-Time message.</div></div>
<div class="ttc" id="aclassAH_1_1SPIShiftRegisterOut_html"><div class="ttname"><a href="../../d5/d09/classAH_1_1SPIShiftRegisterOut.html">AH::SPIShiftRegisterOut</a></div><div class="ttdoc">A class for serial-in/parallel-out shift registers, like the 74HC595 that are connected to the SPI bu...</div><div class="ttdef"><b>Definition</b> <a href="../../d7/d88/SPIShiftRegisterOut_8hpp_source.html#l00028">SPIShiftRegisterOut.hpp:28</a></div></div>
<div class="ttc" id="aclassAH_1_1SPIShiftRegisterOut_html_a7c3e14d99bd3dc0e3670d6956dafcaf2"><div class="ttname"><a href="../../d5/d09/classAH_1_1SPIShiftRegisterOut.html#a7c3e14d99bd3dc0e3670d6956dafcaf2">AH::SPIShiftRegisterOut::begin</a></div><div class="ttdeci">void begin() override</div><div class="ttdoc">Initialize the shift register.</div></div>
<div class="ttc" id="aclassControl__Surface___html_ab0bdf5cca484fb2ba637c39384b27fb2"><div class="ttname"><a href="../../dc/d45/classControl__Surface__.html#ab0bdf5cca484fb2ba637c39384b27fb2">Control_Surface_::begin</a></div><div class="ttdeci">void begin()</div><div class="ttdoc">Initialize the Control_Surface.</div><div class="ttdef"><b>Definition</b> <a href="../../d9/d38/Control__Surface__Class_8cpp_source.html#l00022">Control_Surface_Class.cpp:22</a></div></div>
<div class="ttc" id="aclassControl__Surface___html_afe461d27b9c48d5921c00d521181f12f"><div class="ttname"><a href="../../dc/d45/classControl__Surface__.html#afe461d27b9c48d5921c00d521181f12f">Control_Surface_::loop</a></div><div class="ttdeci">void loop()</div><div class="ttdoc">Update all MIDI elements, send MIDI events and read MIDI input.</div><div class="ttdef"><b>Definition</b> <a href="../../d9/d38/Control__Surface__Class_8cpp_source.html#l00071">Control_Surface_Class.cpp:71</a></div></div>
<div class="ttc" id="aclassGenericUSBMIDI__Interface_html"><div class="ttname"><a href="../../dd/d0e/classGenericUSBMIDI__Interface.html">GenericUSBMIDI_Interface</a></div><div class="ttdoc">A class for MIDI interfaces sending MIDI messages over a USB MIDI connection.</div><div class="ttdef"><b>Definition</b> <a href="../../d1/d64/USBMIDI__Interface_8hpp_source.html#l00017">USBMIDI_Interface.hpp:17</a></div></div>
<div class="ttc" id="aclassMIDI__Sender_html_af50be88ea5127b679e4ea7445dfad46b"><div class="ttname"><a href="../../d6/d72/classMIDI__Sender.html#af50be88ea5127b679e4ea7445dfad46b">MIDI_Sender::sendRealTime</a></div><div class="ttdeci">void sendRealTime(MIDIMessageType rt, Cable cable=Cable_1)</div><div class="ttdoc">Send a MIDI Real-Time message.</div></div>
<div class="ttc" id="astructAH_1_1HexDump_html"><div class="ttname"><a href="../../d2/d57/structAH_1_1HexDump.html">AH::HexDump</a></div><div class="ttdef"><b>Definition</b> <a href="../../dd/d80/PrintStream_8hpp_source.html#l00070">PrintStream.hpp:70</a></div></div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
