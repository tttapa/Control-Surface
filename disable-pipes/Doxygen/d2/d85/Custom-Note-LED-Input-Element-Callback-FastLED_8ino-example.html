<!-- HTML header for doxygen 1.9.2-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Control Surface: Custom-Note-LED-Input-Element-Callback-FastLED.ino</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript">
window.MathJax = {
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  }
};
</script>
<script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300&family=Roboto:wght@400&family=Roboto:wght@500&display=swap" rel="stylesheet">
<link href="../../custom_stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
  <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Control Surface<span id="projectnumber">&#160;<code><a href="/Control-Surface/">disable-pipes</a></code></span>
   </div>
   <div id="projectbrief">MIDI Control Surface library for Arduino</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle"><div class="title">Custom-Note-LED-Input-Element-Callback-FastLED.ino</div></div>
</div><!--header-->
<div class="contents">
<h1><a class="anchor" id="autotoc_md274"></a>
Custom-Note-LED-Input-Element-Callback-FastLED</h1>
<p >This example demonstrates how to attach custom callbacks to Note or Control Change MIDI Input Elements.</p>
<dl class="section user"><dt>Boards:</dt><dd>AVR, AVR USB, Due, Nano 33 IoT, Teensy 3.x, ESP32</dd></dl>
<h2><a class="anchor" id="autotoc_md275"></a>
Connections</h2>
<ul>
<li>Pin 2: The data pin of a Neopixel LED strip with (at least) 8 LEDs</li>
</ul>
<h2><a class="anchor" id="autotoc_md276"></a>
Behavior</h2>
<p >If a MIDI Note On event for note 0x3C (C4 or middle C) is sent, its velocity value sets the red value of the first LED, note 0x3D controls the green value of the first LED, note 0x3E controls the blue value of the first LED, note 0x3F controls the red value of the second LED, 0x40 controls the green value of the second LED, etc.</p>
<h2><a class="anchor" id="autotoc_md277"></a>
Mapping</h2>
<p >Route the MIDI output of a MIDI keyboard to the Arduino's MIDI input. Then play some notes in the two octaves above middle C. <br  />
 Alternatively, map it in you DAW, for example, in VirtualDJ: <br  />
 <code>&lt;color notered="0x3C" notegreen="0x3D" noteblue="0x3E" ... /&gt;</code></p>
<p >Written by PieterP, 2020-03-12 <br  />
 <a href="https://github.com/tttapa/Control-Surface">https://github.com/tttapa/Control-Surface</a></p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;FastLED.h&gt;</span></div>
<div class="line"><span class="comment">// Include FastLED before Control Surface</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../db/dbf/Control__Surface_8h.html">Control_Surface.h</a>&gt;</span> <span class="comment">// Include the Control Surface library</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Instantiate a MIDI over USB interface.</span></div>
<div class="line"><a id="_a0" name="_a0"></a><a class="code hl_class" href="../../de/d05/classUSBMIDI__Interface.html">USBMIDI_Interface</a> midi;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Custom MIDI Input Element to handle incoming note events and control the LEDs.</span></div>
<div class="line"><span class="keyword">template</span> &lt;u<span class="keywordtype">int</span>8_t RangeLen&gt;</div>
<div class="line"><span class="keyword">class </span>CustomNoteLED : <span class="keyword">public</span> <a id="_a1" name="_a1"></a><a class="code hl_class" href="../../d5/dae/classMatchingMIDIInputElement.html">MatchingMIDIInputElement</a>&lt;MIDIMessageType::NOTE_ON,</div>
<div class="line">                                                      TwoByteRangeMIDIMatcher&gt; {</div>
<div class="line"> <span class="keyword">public</span>:</div>
<div class="line">  <span class="comment">// Constructor</span></div>
<div class="line">  CustomNoteLED(CRGB *ledcolors, <a id="_a2" name="_a2"></a><a class="code hl_class" href="../../d7/d0f/classMIDIAddress.html">MIDIAddress</a> address)</div>
<div class="line">    : <a class="code hl_class" href="../../d5/dae/classMatchingMIDIInputElement.html">MatchingMIDIInputElement</a>&lt;<a id="a3" name="a3"></a><a class="code hl_enumvalue" href="../../dc/d40/MIDI__MessageTypes_8hpp.html#a0f3f6ac1a61700bdea6873fdfe9248f5a42ab8d6057c68dc3ca7829a9173c24a4">MIDIMessageType::NOTE_ON</a>,</div>
<div class="line">                               <a id="_a4" name="_a4"></a><a class="code hl_struct" href="../../d1/d7a/structTwoByteRangeMIDIMatcher.html">TwoByteRangeMIDIMatcher</a>&gt;({address, RangeLen}),</div>
<div class="line">      ledcolors(ledcolors) {}</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Called once upon initialization.</span></div>
<div class="line">  <span class="keywordtype">void</span> <a id="a5" name="a5"></a><a class="code hl_function" href="../../d9/db1/classMIDIInputElement.html#a2d8ec6ac27419ce65e20d415ebfe1495">begin</a>()<span class="keyword"> override </span>{}</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Called when an incoming MIDI Note message matches this element&#39;s matcher</span></div>
<div class="line">  <span class="comment">// (i.e. it has the right MIDI address, channel and cable).</span></div>
<div class="line">  <span class="comment">// The match object that&#39;s passed as a parameter contains the velocity value</span></div>
<div class="line">  <span class="comment">// of the Note message that matched.</span></div>
<div class="line">  <span class="keywordtype">void</span> <a id="a6" name="a6"></a><a class="code hl_function" href="../../d5/dae/classMatchingMIDIInputElement.html#a7d8b3295e878d374fe9af277f6983204">handleUpdate</a>(<span class="keyword">typename</span> <a id="_a7" name="_a7"></a><a class="code hl_struct" href="../../d1/d7a/structTwoByteRangeMIDIMatcher.html#d6/d0e/structTwoByteRangeMIDIMatcher_1_1Result">TwoByteRangeMIDIMatcher::Result</a> match)<span class="keyword"> override </span>{</div>
<div class="line">    updateLED(match.<a id="a8" name="a8"></a><a class="code hl_variable" href="../../d1/d7a/structTwoByteRangeMIDIMatcher.html#aae5a12e607d0f782506d9e6ec6179c64">index</a>, match.<a id="a9" name="a9"></a><a class="code hl_variable" href="../../d1/d7a/structTwoByteRangeMIDIMatcher.html#a638e4503e0ae6ce655b7ad2e17e8f0ad">value</a>);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Called each time a MIDI message is received and an LED has to be updated.</span></div>
<div class="line">  <span class="keywordtype">void</span> updateLED(uint8_t index, uint8_t value) {</div>
<div class="line">    uint8_t ledIndex = index / 3;</div>
<div class="line">    uint8_t colorIndex = index % 3; <span class="comment">// 0 = R, 1 = G, 2 = B</span></div>
<div class="line">    <span class="comment">// Update the LED color</span></div>
<div class="line">    ledcolors[ledIndex][colorIndex] = value;</div>
<div class="line">    dirty = <span class="keyword">true</span>;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Check if the colors changed since the last time the dirty flag was cleared.</span></div>
<div class="line">  <span class="keywordtype">bool</span> getDirty()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> dirty; }</div>
<div class="line">  <span class="comment">// Clear the dirty flag.</span></div>
<div class="line">  <span class="keywordtype">void</span> clearDirty() { dirty = <span class="keyword">false</span>; }</div>
<div class="line"> </div>
<div class="line"> <span class="keyword">private</span>:</div>
<div class="line">  <span class="comment">// Pointer to array of FastLED color values for the LEDs</span></div>
<div class="line">  CRGB *ledcolors;</div>
<div class="line">  <span class="comment">// Should the LEDs be updated by FastLED?</span></div>
<div class="line">  <span class="keywordtype">bool</span> dirty = <span class="keyword">true</span>;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Define the array of leds.</span></div>
<div class="line">Array&lt;CRGB, 8&gt; leds {};</div>
<div class="line"><span class="comment">// The data pin with the strip connected.</span></div>
<div class="line"><span class="keyword">constexpr</span> uint8_t ledpin = 2;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create a MIDI input element that listens to all notes in the range C4 - B5</span></div>
<div class="line"><span class="comment">// (the range starts at C4 and has a length equal to `leds.length * 3` == 24).</span></div>
<div class="line"><span class="comment">// Note C4 is the red channel of the first LED,</span></div>
<div class="line"><span class="comment">// Note C#4 is the green channel of the first LED,</span></div>
<div class="line"><span class="comment">// Note D4 is the blue channel of the first LED,</span></div>
<div class="line"><span class="comment">// Note D#4 is the red channel of the second LED, etc.</span></div>
<div class="line">CustomNoteLED&lt;leds.length * 3&gt; midiled {leds.data, <a id="a10" name="a10"></a><a class="code hl_variable" href="../../d7/d78/namespaceMIDI__Notes.html#adc612a1e4e057463777480eabc3fb0ca">MIDI_Notes::C</a>(4)};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> setup() {</div>
<div class="line">  <span class="comment">// See FastLED examples and documentation for more information.</span></div>
<div class="line">  FastLED.addLeds&lt;NEOPIXEL, ledpin&gt;(leds.data, leds.length);</div>
<div class="line">  FastLED.setCorrection(TypicalPixelString);</div>
<div class="line">  FastLED.setBrightness(128);</div>
<div class="line">  <a id="a11" name="a11"></a><a class="code hl_variable" href="../../d9/d38/Control__Surface__Class_8cpp.html#af7a5d250297d82b2b29605dd7ac250df">Control_Surface</a>.<a id="a12" name="a12"></a><a class="code hl_function" href="../../dc/d45/classControl__Surface__.html#ab0bdf5cca484fb2ba637c39384b27fb2">begin</a>();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> loop() {</div>
<div class="line">  <a class="code hl_variable" href="../../d9/d38/Control__Surface__Class_8cpp.html#af7a5d250297d82b2b29605dd7ac250df">Control_Surface</a>.<a id="a13" name="a13"></a><a class="code hl_function" href="../../dc/d45/classControl__Surface__.html#afe461d27b9c48d5921c00d521181f12f">loop</a>();</div>
<div class="line">  <span class="keywordflow">if</span> (midiled.getDirty()) {</div>
<div class="line">    FastLED.show();</div>
<div class="line">    midiled.clearDirty();</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="ttc" id="aControl__Surface_8h_html"><div class="ttname"><a href="../../db/dbf/Control__Surface_8h.html">Control_Surface.h</a></div><div class="ttdoc">The main header file that includes all Control-Surface header files.</div></div>
<div class="ttc" id="aControl__Surface__Class_8cpp_html_af7a5d250297d82b2b29605dd7ac250df"><div class="ttname"><a href="../../d9/d38/Control__Surface__Class_8cpp.html#af7a5d250297d82b2b29605dd7ac250df">Control_Surface</a></div><div class="ttdeci">Control_Surface_ &amp; Control_Surface</div><div class="ttdoc">A predefined instance of the Control Surface to use in the Arduino sketches.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d38/Control__Surface__Class_8cpp_source.html#l00338">Control_Surface_Class.cpp:338</a></div></div>
<div class="ttc" id="aMIDI__MessageTypes_8hpp_html_a0f3f6ac1a61700bdea6873fdfe9248f5a42ab8d6057c68dc3ca7829a9173c24a4"><div class="ttname"><a href="../../dc/d40/MIDI__MessageTypes_8hpp.html#a0f3f6ac1a61700bdea6873fdfe9248f5a42ab8d6057c68dc3ca7829a9173c24a4">MIDIMessageType::NOTE_ON</a></div><div class="ttdeci">@ NOTE_ON</div></div>
<div class="ttc" id="aclassControl__Surface___html_ab0bdf5cca484fb2ba637c39384b27fb2"><div class="ttname"><a href="../../dc/d45/classControl__Surface__.html#ab0bdf5cca484fb2ba637c39384b27fb2">Control_Surface_::begin</a></div><div class="ttdeci">void begin()</div><div class="ttdoc">Initialize the Control_Surface.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d38/Control__Surface__Class_8cpp_source.html#l00022">Control_Surface_Class.cpp:22</a></div></div>
<div class="ttc" id="aclassControl__Surface___html_afe461d27b9c48d5921c00d521181f12f"><div class="ttname"><a href="../../dc/d45/classControl__Surface__.html#afe461d27b9c48d5921c00d521181f12f">Control_Surface_::loop</a></div><div class="ttdeci">void loop()</div><div class="ttdoc">Update all MIDI elements, send MIDI events and read MIDI input.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d38/Control__Surface__Class_8cpp_source.html#l00071">Control_Surface_Class.cpp:71</a></div></div>
<div class="ttc" id="aclassMIDIAddress_html"><div class="ttname"><a href="../../d7/d0f/classMIDIAddress.html">MIDIAddress</a></div><div class="ttdoc">A type-safe utility class for saving a MIDI address consisting of a 7-bit address,...</div><div class="ttdef"><b>Definition:</b> <a href="../../db/dd6/MIDIAddress_8hpp_source.html#l00141">MIDIAddress.hpp:141</a></div></div>
<div class="ttc" id="aclassMIDIInputElement_html_a2d8ec6ac27419ce65e20d415ebfe1495"><div class="ttname"><a href="../../d9/db1/classMIDIInputElement.html#a2d8ec6ac27419ce65e20d415ebfe1495">MIDIInputElement::begin</a></div><div class="ttdeci">virtual void begin()</div><div class="ttdoc">Initialize the input element.</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d90/MIDIInputElement_8hpp_source.html#l00034">MIDIInputElement.hpp:34</a></div></div>
<div class="ttc" id="aclassMatchingMIDIInputElement_html"><div class="ttname"><a href="../../d5/dae/classMatchingMIDIInputElement.html">MatchingMIDIInputElement</a></div><div class="ttdoc">The MIDIInputElement base class is very general: you give it a MIDI message, and it calls the updateW...</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d90/MIDIInputElement_8hpp_source.html#l00088">MIDIInputElement.hpp:88</a></div></div>
<div class="ttc" id="aclassMatchingMIDIInputElement_html_a7d8b3295e878d374fe9af277f6983204"><div class="ttname"><a href="../../d5/dae/classMatchingMIDIInputElement.html#a7d8b3295e878d374fe9af277f6983204">MatchingMIDIInputElement::handleUpdate</a></div><div class="ttdeci">virtual void handleUpdate(typename Matcher::Result match)=0</div></div>
<div class="ttc" id="aclassUSBMIDI__Interface_html"><div class="ttname"><a href="../../de/d05/classUSBMIDI__Interface.html">USBMIDI_Interface</a></div><div class="ttdoc">A class for MIDI interfaces sending MIDI messages over a USB MIDI connection.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d64/USBMIDI__Interface_8hpp_source.html#l00148">USBMIDI_Interface.hpp:149</a></div></div>
<div class="ttc" id="anamespaceMIDI__Notes_html_adc612a1e4e057463777480eabc3fb0ca"><div class="ttname"><a href="../../d7/d78/namespaceMIDI__Notes.html#adc612a1e4e057463777480eabc3fb0ca">MIDI_Notes::C</a></div><div class="ttdeci">constexpr Note C</div><div class="ttdoc">C (Do)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dc5/Notes_8hpp_source.html#l00040">Notes.hpp:40</a></div></div>
<div class="ttc" id="astructTwoByteRangeMIDIMatcher_html"><div class="ttname"><a href="../../d1/d7a/structTwoByteRangeMIDIMatcher.html">TwoByteRangeMIDIMatcher</a></div><div class="ttdoc">Matcher for MIDI messages with 2 data bytes, such as Note On/Off, Control Change, Key Pressure (but n...</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d9e/MIDIInputElementMatchers_8hpp_source.html#l00082">MIDIInputElementMatchers.hpp:82</a></div></div>
<div class="ttc" id="astructTwoByteRangeMIDIMatcher_html_a638e4503e0ae6ce655b7ad2e17e8f0ad"><div class="ttname"><a href="../../d1/d7a/structTwoByteRangeMIDIMatcher.html#a638e4503e0ae6ce655b7ad2e17e8f0ad">TwoByteRangeMIDIMatcher::Result::value</a></div><div class="ttdeci">uint8_t value</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d9e/MIDIInputElementMatchers_8hpp_source.html#l00088">MIDIInputElementMatchers.hpp:88</a></div></div>
<div class="ttc" id="astructTwoByteRangeMIDIMatcher_html_aae5a12e607d0f782506d9e6ec6179c64"><div class="ttname"><a href="../../d1/d7a/structTwoByteRangeMIDIMatcher.html#aae5a12e607d0f782506d9e6ec6179c64">TwoByteRangeMIDIMatcher::Result::index</a></div><div class="ttdeci">uint8_t index</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d9e/MIDIInputElementMatchers_8hpp_source.html#l00089">MIDIInputElementMatchers.hpp:89</a></div></div>
<div class="ttc" id="astructTwoByteRangeMIDIMatcher_html_d6/d0e/structTwoByteRangeMIDIMatcher_1_1Result"><div class="ttname"><a href="../../d1/d7a/structTwoByteRangeMIDIMatcher.html#d6/d0e/structTwoByteRangeMIDIMatcher_1_1Result">TwoByteRangeMIDIMatcher::Result</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d9e/MIDIInputElementMatchers_8hpp_source.html#l00086">MIDIInputElementMatchers.hpp:86</a></div></div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4
</small></address>
</body>
</html>
