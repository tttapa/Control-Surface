<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Control Surface: MIDI over USB</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/SVG"],
});
</script><script type="text/javascript" async="async" src="/MathJax/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../custom_stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Control Surface
   <span id="projectnumber">&#160;<code><a href="/Control-Surface/">1.1.0</a></code></span>
   </div>
   <div id="projectbrief">MIDI Control Surface library for Arduino</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">MIDI over USB </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>There are some differences in MIDI over USB implementation between different types of Arduino-compatible boards.</p>
<h1><a class="anchor" id="autotoc_md155"></a>
Arduino boards with native USB support</h1>
<p><em>Arduino Due, Arduino Zero, Arduino Leonardo, Arduino Micro, Arduino LilyPad USB ...</em> <br  />
</p>
<hr  />
<p> Some of the newer boards have native USB support (i.e. the USB connection goes directly to the main <a class="el" href="../../d7/dc7/namespaceMCU.html" title="Names and note and controller numbers for the Mackie Control Universal (MCU) protocol.">MCU</a>) this means that they can pretend to be a USB MIDI device. This is based on PluggableUSB, using the <a href="https://github.com/arduino-libraries/MIDIUSB">MIDIUSB</a> library. <br  />
 All you have to do to get it working, is installing the library, and upload a sketch. <br  />
 The computer will then automatically detect the Arduino as a MIDI device.</p>
<h1><a class="anchor" id="autotoc_md156"></a>
Teensy</h1>
<p><em>Teensy 2.0, Teensy++ 2.0, Teensy LC, Teensy 3.0, Teensy 3.1, Teensy 3.2, Teensy 3.5, Teensy 3.6</em> <br  />
</p>
<hr  />
<p> Teensy boards have native USB support as well. You don't even need to install anything, because MIDI over USB is implemented in the Teensy Core. <br  />
 You just need to select the 'MIDI' USB type from Tools &gt; USB Type &gt; MIDI.</p>
<h1><a class="anchor" id="autotoc_md157"></a>
Arduino boards with an ATmega16U2 (ATmega8U2)</h1>
<p><em>Arduino Uno, Arduino Mega</em></p>
<hr  />
<p> Some Arduino's that don't have native USB support can still be used as a USB MIDI device. <br  />
 This is because they have a second, smaller microcontroller on board, an ATmega16U2 (ATmega8U2 on older boards), that communicates with the main <a class="el" href="../../d7/dc7/namespaceMCU.html" title="Names and note and controller numbers for the Mackie Control Universal (MCU) protocol.">MCU</a> over TTL UART (serial, TX and RX on pins 0 and 1), and also acts as a USB COM port, to communicate with the computer (for programming and for using the Serial Monitor). During normal operation, the ATmega16U2 is just a USB-to-Serial bridge, but you can also program it to be a USB MIDI-to-Serial bridge. <br  />
 You can flash the <a href="https://github.com/ddiakopoulos/hiduino">HIDUINO</a> firmware by <a href="http://www.dimitridiakopoulos.com/hiduino">Dimitri Diakopoulos</a>. This flashing process is called a DFU, or Device Firmware Upgrade. You can use the Atmel Flip tool on Windows, or dfu-programmer on Linux and Mac. Everything is explained in the <a href="https://github.com/tttapa/MIDI_controller#arduino-uno-or-mega">here</a>. <br  />
 Because you need the ATmega16U2 for uploading new programs to the Arduino, you have to upload your program first, and then flash the MIDI firmware. If you want to change your program, you have to flash the default Serial firmware again, then upload your new program, and finally flash the MIDI firmware. <br  />
 That's quite a cumbersome process, especially if you're just trying different settings, tweaking some values or trying to debug your code. <br  />
 </p><h3>Debug mode</h3>
<p>To make this process a little easier, the MIDI Controller library has a debug MIDI interface, that prints the MIDI events to the serial monitor (or other Stream outputs). This means that you don't need the MIDI firmware to see if it's sending the right MIDI messages. <br  />
 You can enable the debug mode by instantiating a DebugMIDI_Interface: <br  />
 <code><a class="el" href="../../d8/d0b/classStreamDebugMIDI__Interface.html" title="A class for MIDI interfaces sending and receiving human-readable MIDI messages over a Stream.">StreamDebugMIDI_Interface(Stream &amp;stream)</a></code> <br  />
 <code><a class="el" href="../../db/dc4/classSerialDebugMIDI__Interface.html" title="A wrapper class for debug MIDI interfaces sending and receiving human-readable MIDI messages over a S...">SerialDebugMIDI_Interface(Serial_t &amp;serial, unsigned long baud)</a></code> <br  />
 <code><a class="el" href="../../d8/d29/classHardwareSerialDebugMIDI__Interface.html" title="A class for debug MIDI interfaces sending and receiving human-readable MIDI messages over a HardwareS...">HardwareSerialDebugMIDI_Interface(HardwareSerial &amp;serial, unsigned long baud)</a></code> <br  />
 <code><a class="el" href="../../de/d2d/classUSBDebugMIDI__Interface.html" title="A class for debug MIDI interfaces sending and receiving human-readable MIDI messages over the USB CDC...">USBDebugMIDI_Interface(unsigned long baud)</a></code> <br  />
 <code><a class="el" href="../../d3/d54/classSoftwareSerialDebugMIDI__Interface.html" title="A class for debug MIDI interfaces sending and receiving human-readable MIDI messages over a SoftwareS...">SoftwareSerialDebugMIDI_Interface(SoftwareSerial &amp;serial, unsigned long baud)</a></code> </p><h3>Hairless MIDI</h3>
<p>Once that's working, you can try it out with real MIDI messages, by using a software tool called <a href="http://projectgus.github.io/hairless-midiserial/">Hairless MIDI&lt;-&gt;Serial bridge</a>. This application takes MIDI messages from the serial port, and sends them to a virtual MIDI port on your computer, so you can access it in your DAW or DJ program. <br  />
 To use the MIDI Controller library, instantiate a <code><a class="el" href="../../dc/dff/classHairlessMIDI__Interface.html" title="A class for MIDI Interfaces sending and receiving data over the USB Serial CDC connection for the use...">HairlessMIDI_Interface</a></code> at the top of your sketch. <br  />
 </p><h3>HIDUINO MIDI over USB</h3>
<p>Finally, when you know that everything is working fine, you can change the baud rate to the official MIDI baud rate of 31250, by using the default <code><a class="el" href="../../de/d05/classUSBMIDI__Interface.html" title="A class for MIDI interfaces sending MIDI messages over a USB MIDI connection.">USBMIDI_Interface</a></code> (don't explicitly instantiate any interfaces) uploading the sketch, and flashing the HIDUINO MIDI firmware using Flip or dfu-programmer. <br  />
 You can now just plug it into your computer, and it will be recognized as a MIDI device, you don't need to run Hairless anymore. <br  />
</p>
<h1><a class="anchor" id="autotoc_md158"></a>
Boards with a single-purpose USB-to-TTL chip</h1>
<p><em>Arduino Nano, Arduino Duemilanove, Chinese Uno &amp; Mega clones ...</em></p>
<hr  />
<p> Whereas the ATmega16U2 chip is programmable, most other USB-to-TTL chips are single-purpose, so you can't flash them with the HIDUINO MIDI firmware. <br  />
 These chips include FTDI chips (Nano and Duemilanove) and the CH340G or CP2102 (both very popular on Chinese "Arduino" clones). <br  />
 While MIDI over USB is not supported on these boards, you can still use Hairless. Just instantiate a <code><a class="el" href="../../dc/dff/classHairlessMIDI__Interface.html" title="A class for MIDI Interfaces sending and receiving data over the USB Serial CDC connection for the use...">HairlessMIDI_Interface</a></code> at the top of your sketch. <br  />
</p>
<hr  />
<h1><a class="anchor" id="autotoc_md159"></a>
Conclusion</h1>
<p>I strongly recommend getting a Teensy 3.x for building a Control Surface. MIDI over USB is supported right of the box, and it's the only platform that currently supports USB audio output. On top of that, it has plenty of memory to create large MIDI Controllers, and drive lots of displays.</p>
<p>If you just want a very small MIDI Controller, the Arduino Leonardo/Micro are good choices as well, just keep in mind that they don't have a lot of RAM.</p>
<p>The Arduino UNO and MEGA boards are just not fit for MIDI over USB, and I wouldn't recommend them at all for this application.</p>
<p>You don't have to worry too much about the number of IO pins a board has, since you can use multiplexers and GPIO expanders, using the ExtendedIO classes of the library. Memory can be a much bigger problem, especially if you add a display. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.16
</small></address>
</body>
</html>
