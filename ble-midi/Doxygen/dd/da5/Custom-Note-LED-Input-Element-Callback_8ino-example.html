<!-- HTML header for doxygen 1.10.0-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Control Surface: Custom-Note-LED-Input-Element-Callback.ino</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../clipboard.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
window.MathJax = {
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  }
};
</script>
<script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
<script type="text/javascript" src="../../darkmode_toggle.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300&family=Roboto:wght@400&family=Roboto:wght@500&display=swap" rel="stylesheet">
<link href="../../custom_stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Control Surface<span id="projectnumber">&#160;<code><a href="/Control-Surface/">ble-midi</a></code></span>
   </div>
   <div id="projectbrief">MIDI Control Surface library for Arduino</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">Custom-Note-LED-Input-Element-Callback.ino</div></div>
</div><!--header-->
<div class="contents">
<h1><a class="anchor" id="custom-note-led-input-element-callback"></a>
Custom-Note-LED-Input-Element-Callback</h1>
<p>This example demonstrates how to attach custom actions to incoming Note or Control Change MIDI events.</p>
<dl class="section user"><dt>Boards: <b class="boards-info" title="Control Surface&apos;s automated continuous integration workflows regularly verify that this example compiles successfully for the following boards. The list is not exhaustive, and the example will most likely work on other boards as well (perhaps requiring slight modifications).">ðŸ›ˆ</b> </dt><dd>AVR, AVR USB, Due, Nano 33 IoT, Nano 33 BLE, UNO R4, Pi Pico, Teensy 3.x</dd></dl>
<h2><a class="anchor" id="connections-63"></a>
Connections</h2>
<ul>
<li>Pin 3 (PWM pin): An LED (with current-limiting resistor) to ground.</li>
</ul>
<h2><a class="anchor" id="behavior-67"></a>
Behavior</h2>
<p>If a MIDI Note On event for note 0x3C (C4 or middle C) is sent, the built-in LED will light up at full brightness, if a Note Off event for that note is sent, the LED will light dimly. <br  />
 (A Note On event with a velocity of zero also counts as a Note Off event.)</p>
<h2><a class="anchor" id="mapping-40"></a>
Mapping</h2>
<p>Route the MIDI output of a MIDI keyboard to the Arduino's MIDI input. Then play a middle C on the keyboard.</p>
<p>Written by PieterP, 2020-03-10 <br  />
 <a href="https://github.com/tttapa/Control-Surface">https://github.com/tttapa/Control-Surface</a></p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../db/dbf/Control__Surface_8h.html">Control_Surface.h</a>&gt;</span> <span class="comment">// Include the Control Surface library</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Instantiate a MIDI over USB interface.</span></div>
<div class="line"><a id="_a0" name="_a0"></a><a class="code hl_class" href="../../de/d05/classUSBMIDI__Interface.html">USBMIDI_Interface</a> midi;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// MIDI Input Element that listens for MIDI Note events that turns on the LED at</span></div>
<div class="line"><span class="comment">// full brightness if the note value (velocity) is above the threshold,</span></div>
<div class="line"><span class="comment">// and turns on the LED at a lower brightness if the value is below the</span></div>
<div class="line"><span class="comment">// threshold.</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>CustomNoteLED</div>
<div class="line">  <span class="comment">// First, inherit from the MatchingMIDIInputElement base class. Indicate that</span></div>
<div class="line">  <span class="comment">// you want to listen to MIDI Note events by specifying the MIDI message type,</span></div>
<div class="line">  <span class="comment">// and use a simple 2-byte message matcher, since MIDI Note events have two</span></div>
<div class="line">  <span class="comment">// data bytes.</span></div>
<div class="line">  : <span class="keyword">public</span> <a id="_a1" name="_a1"></a><a class="code hl_class" href="../../d5/dae/classMatchingMIDIInputElement.html">MatchingMIDIInputElement</a>&lt;MIDIMessageType::NoteOn,</div>
<div class="line">                                    TwoByteMIDIMatcher&gt; {</div>
<div class="line"> <span class="keyword">public</span>:</div>
<div class="line">  <span class="comment">// Constructor</span></div>
<div class="line">  CustomNoteLED(pin_t ledPin, <a id="_a2" name="_a2"></a><a class="code hl_class" href="../../d7/d0f/classMIDIAddress.html">MIDIAddress</a> address, uint8_t lowBrightness)</div>
<div class="line">    : <a id="a3" name="a3"></a><a class="code hl_function" href="../../d5/dae/classMatchingMIDIInputElement.html#a08ddf904fdf20dada2f49a9f7f00aeb0">MatchingMIDIInputElement</a>(address), ledPin(ledPin),</div>
<div class="line">      lowBrightness(lowBrightness) {}</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Called once upon initialization, set up the pin mode for the LED,</span></div>
<div class="line">  <span class="comment">// and output the initial value.</span></div>
<div class="line">  <span class="keywordtype">void</span> <a id="a4" name="a4"></a><a class="code hl_function" href="../../d9/db1/classMIDIInputElement.html#a2d8ec6ac27419ce65e20d415ebfe1495">begin</a>()<span class="keyword"> override </span>{</div>
<div class="line">    ExtIO::pinMode(ledPin, <a id="a5" name="a5"></a><a class="code hl_variable" href="../../d2/d3c/Arduino-Hardware-Types_8hpp.html#ad01d99486fd89841afe767b337b8dc92">OUTPUT</a>);</div>
<div class="line">    ExtIO::analogWrite(ledPin, lowBrightness);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Called when an incoming MIDI Note message matches this element&#39;s matcher</span></div>
<div class="line">  <span class="comment">// (i.e. it has the right MIDI address, channel and cable).</span></div>
<div class="line">  <span class="comment">// The match object that&#39;s passed as a parameter contains the velocity value</span></div>
<div class="line">  <span class="comment">// of the Note message that matched.</span></div>
<div class="line">  <span class="keywordtype">void</span> <a id="a6" name="a6"></a><a class="code hl_function" href="../../d5/dae/classMatchingMIDIInputElement.html#a7d8b3295e878d374fe9af277f6983204">handleUpdate</a>(<a id="_a7" name="_a7"></a><a class="code hl_struct" href="../../d5/d5c/structTwoByteMIDIMatcher_1_1Result.html">TwoByteMIDIMatcher::Result</a> match)<span class="keyword"> override </span>{</div>
<div class="line">    <span class="keywordflow">if</span> (match.<a id="a8" name="a8"></a><a class="code hl_variable" href="../../d5/d5c/structTwoByteMIDIMatcher_1_1Result.html#a638e4503e0ae6ce655b7ad2e17e8f0ad">value</a> &gt;= threshold)</div>
<div class="line">      ExtIO::digitalWrite(ledPin, <a id="a9" name="a9"></a><a class="code hl_variable" href="../../d2/d3c/Arduino-Hardware-Types_8hpp.html#a4b2f87da16a1a26dce6e6ba3fbe5f572">HIGH</a>);</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">      ExtIO::analogWrite(ledPin, lowBrightness);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Called when the input element is reset (e.g. by an &quot;All notes off&quot; MIDI</span></div>
<div class="line">  <span class="comment">// event).</span></div>
<div class="line">  <span class="keywordtype">void</span> <a id="a10" name="a10"></a><a class="code hl_function" href="../../d9/db1/classMIDIInputElement.html#a7b0e029102ad38f4b814c6523aedb53d">reset</a>()<span class="keyword"> override </span>{ ExtIO::analogWrite(ledPin, lowBrightness); }</div>
<div class="line"> </div>
<div class="line"> <span class="keyword">private</span>:</div>
<div class="line">  pin_t ledPin;</div>
<div class="line">  uint8_t lowBrightness;</div>
<div class="line">  <span class="keyword">const</span> <span class="keyword">static</span> uint8_t threshold = 0x01;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Instantiate the LED that will light up when middle C is playing.</span></div>
<div class="line">CustomNoteLED led {</div>
<div class="line">  3,                             <span class="comment">// Pin with the LED connected (PWM capable)</span></div>
<div class="line">  {<a id="a11" name="a11"></a><a class="code hl_variable" href="../../d7/d78/namespaceMIDI__Notes.html#adc612a1e4e057463777480eabc3fb0ca">MIDI_Notes::C</a>(4), <a id="a12" name="a12"></a><a class="code hl_variable" href="../../d7/d42/Channel_8hpp.html#a40d189f24e13a7304f2c9094038588ae">Channel_1</a>}, <span class="comment">// Note C4 on MIDI channel 1</span></div>
<div class="line">  10,                            <span class="comment">// Intensity when off</span></div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> setup() {</div>
<div class="line">  <a id="a13" name="a13"></a><a class="code hl_variable" href="../../d9/d38/Control__Surface__Class_8cpp.html#af7a5d250297d82b2b29605dd7ac250df">Control_Surface</a>.<a id="a14" name="a14"></a><a class="code hl_function" href="../../dc/d45/classControl__Surface__.html#ab0bdf5cca484fb2ba637c39384b27fb2">begin</a>(); <span class="comment">// Initialize Control Surface</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> loop() {</div>
<div class="line">  <a class="code hl_variable" href="../../d9/d38/Control__Surface__Class_8cpp.html#af7a5d250297d82b2b29605dd7ac250df">Control_Surface</a>.<a id="a15" name="a15"></a><a class="code hl_function" href="../../dc/d45/classControl__Surface__.html#afe461d27b9c48d5921c00d521181f12f">loop</a>(); <span class="comment">// Update the Control Surface</span></div>
<div class="line">}</div>
<div class="ttc" id="aArduino-Hardware-Types_8hpp_html_a4b2f87da16a1a26dce6e6ba3fbe5f572"><div class="ttname"><a href="../../d2/d3c/Arduino-Hardware-Types_8hpp.html#a4b2f87da16a1a26dce6e6ba3fbe5f572">HIGH</a></div><div class="ttdeci">constexpr PinStatus_t HIGH</div><div class="ttdef"><b>Definition</b> <a href="../../d2/d3c/Arduino-Hardware-Types_8hpp_source.html#l00062">Arduino-Hardware-Types.hpp:62</a></div></div>
<div class="ttc" id="aArduino-Hardware-Types_8hpp_html_ad01d99486fd89841afe767b337b8dc92"><div class="ttname"><a href="../../d2/d3c/Arduino-Hardware-Types_8hpp.html#ad01d99486fd89841afe767b337b8dc92">OUTPUT</a></div><div class="ttdeci">constexpr PinMode_t OUTPUT</div><div class="ttdef"><b>Definition</b> <a href="../../d2/d3c/Arduino-Hardware-Types_8hpp_source.html#l00065">Arduino-Hardware-Types.hpp:65</a></div></div>
<div class="ttc" id="aChannel_8hpp_html_a40d189f24e13a7304f2c9094038588ae"><div class="ttname"><a href="../../d7/d42/Channel_8hpp.html#a40d189f24e13a7304f2c9094038588ae">Channel_1</a></div><div class="ttdeci">constexpr Channel Channel_1</div><div class="ttdef"><b>Definition</b> <a href="../../d7/d42/Channel_8hpp_source.html#l00118">Channel.hpp:118</a></div></div>
<div class="ttc" id="aControl__Surface_8h_html"><div class="ttname"><a href="../../db/dbf/Control__Surface_8h.html">Control_Surface.h</a></div><div class="ttdoc">The main header file that includes all Control-Surface header files.</div></div>
<div class="ttc" id="aControl__Surface__Class_8cpp_html_af7a5d250297d82b2b29605dd7ac250df"><div class="ttname"><a href="../../d9/d38/Control__Surface__Class_8cpp.html#af7a5d250297d82b2b29605dd7ac250df">Control_Surface</a></div><div class="ttdeci">Control_Surface_ &amp; Control_Surface</div><div class="ttdoc">A predefined instance of the Control Surface to use in the Arduino sketches.</div><div class="ttdef"><b>Definition</b> <a href="../../d9/d38/Control__Surface__Class_8cpp_source.html#l00338">Control_Surface_Class.cpp:338</a></div></div>
<div class="ttc" id="aclassControl__Surface___html_ab0bdf5cca484fb2ba637c39384b27fb2"><div class="ttname"><a href="../../dc/d45/classControl__Surface__.html#ab0bdf5cca484fb2ba637c39384b27fb2">Control_Surface_::begin</a></div><div class="ttdeci">void begin()</div><div class="ttdoc">Initialize the Control_Surface.</div><div class="ttdef"><b>Definition</b> <a href="../../d9/d38/Control__Surface__Class_8cpp_source.html#l00022">Control_Surface_Class.cpp:22</a></div></div>
<div class="ttc" id="aclassControl__Surface___html_afe461d27b9c48d5921c00d521181f12f"><div class="ttname"><a href="../../dc/d45/classControl__Surface__.html#afe461d27b9c48d5921c00d521181f12f">Control_Surface_::loop</a></div><div class="ttdeci">void loop()</div><div class="ttdoc">Update all MIDI elements, send MIDI events and read MIDI input.</div><div class="ttdef"><b>Definition</b> <a href="../../d9/d38/Control__Surface__Class_8cpp_source.html#l00071">Control_Surface_Class.cpp:71</a></div></div>
<div class="ttc" id="aclassMIDIAddress_html"><div class="ttname"><a href="../../d7/d0f/classMIDIAddress.html">MIDIAddress</a></div><div class="ttdoc">A type-safe utility class for saving a MIDI address consisting of a 7-bit address,...</div><div class="ttdef"><b>Definition</b> <a href="../../db/dd6/MIDIAddress_8hpp_source.html#l00145">MIDIAddress.hpp:145</a></div></div>
<div class="ttc" id="aclassMIDIInputElement_html_a2d8ec6ac27419ce65e20d415ebfe1495"><div class="ttname"><a href="../../d9/db1/classMIDIInputElement.html#a2d8ec6ac27419ce65e20d415ebfe1495">MIDIInputElement::begin</a></div><div class="ttdeci">virtual void begin()</div><div class="ttdoc">Initialize the input element.</div><div class="ttdef"><b>Definition</b> <a href="../../dc/d90/MIDIInputElement_8hpp_source.html#l00038">MIDIInputElement.hpp:38</a></div></div>
<div class="ttc" id="aclassMIDIInputElement_html_a7b0e029102ad38f4b814c6523aedb53d"><div class="ttname"><a href="../../d9/db1/classMIDIInputElement.html#a7b0e029102ad38f4b814c6523aedb53d">MIDIInputElement::reset</a></div><div class="ttdeci">virtual void reset()</div><div class="ttdoc">Reset the input element to its initial state.</div><div class="ttdef"><b>Definition</b> <a href="../../dc/d90/MIDIInputElement_8hpp_source.html#l00041">MIDIInputElement.hpp:41</a></div></div>
<div class="ttc" id="aclassMatchingMIDIInputElement_html"><div class="ttname"><a href="../../d5/dae/classMatchingMIDIInputElement.html">MatchingMIDIInputElement</a></div><div class="ttdoc">The MIDIInputElement base class is very general: you give it a MIDI message, and it calls the updateW...</div><div class="ttdef"><b>Definition</b> <a href="../../dc/d90/MIDIInputElement_8hpp_source.html#l00092">MIDIInputElement.hpp:92</a></div></div>
<div class="ttc" id="aclassMatchingMIDIInputElement_html_a08ddf904fdf20dada2f49a9f7f00aeb0"><div class="ttname"><a href="../../d5/dae/classMatchingMIDIInputElement.html#a08ddf904fdf20dada2f49a9f7f00aeb0">MatchingMIDIInputElement::MatchingMIDIInputElement</a></div><div class="ttdeci">MatchingMIDIInputElement(const Matcher &amp;matcher)</div><div class="ttdef"><b>Definition</b> <a href="../../dc/d90/MIDIInputElement_8hpp_source.html#l00094">MIDIInputElement.hpp:94</a></div></div>
<div class="ttc" id="aclassMatchingMIDIInputElement_html_a7d8b3295e878d374fe9af277f6983204"><div class="ttname"><a href="../../d5/dae/classMatchingMIDIInputElement.html#a7d8b3295e878d374fe9af277f6983204">MatchingMIDIInputElement::handleUpdate</a></div><div class="ttdeci">virtual void handleUpdate(typename Matcher::Result match)=0</div></div>
<div class="ttc" id="aclassUSBMIDI__Interface_html"><div class="ttname"><a href="../../de/d05/classUSBMIDI__Interface.html">USBMIDI_Interface</a></div><div class="ttdoc">A class for MIDI interfaces sending MIDI messages over a USB MIDI connection.</div><div class="ttdef"><b>Definition</b> <a href="../../d1/d64/USBMIDI__Interface_8hpp_source.html#l00157">USBMIDI_Interface.hpp:158</a></div></div>
<div class="ttc" id="anamespaceMIDI__Notes_html_adc612a1e4e057463777480eabc3fb0ca"><div class="ttname"><a href="../../d7/d78/namespaceMIDI__Notes.html#adc612a1e4e057463777480eabc3fb0ca">MIDI_Notes::C</a></div><div class="ttdeci">constexpr Note C</div><div class="ttdoc">C (Do)</div><div class="ttdef"><b>Definition</b> <a href="../../d9/dc5/Notes_8hpp_source.html#l00055">Notes.hpp:55</a></div></div>
<div class="ttc" id="astructTwoByteMIDIMatcher_1_1Result_html"><div class="ttname"><a href="../../d5/d5c/structTwoByteMIDIMatcher_1_1Result.html">TwoByteMIDIMatcher::Result</a></div><div class="ttdef"><b>Definition</b> <a href="../../d4/d9e/MIDIInputElementMatchers_8hpp_source.html#l00040">MIDIInputElementMatchers.hpp:40</a></div></div>
<div class="ttc" id="astructTwoByteMIDIMatcher_1_1Result_html_a638e4503e0ae6ce655b7ad2e17e8f0ad"><div class="ttname"><a href="../../d5/d5c/structTwoByteMIDIMatcher_1_1Result.html#a638e4503e0ae6ce655b7ad2e17e8f0ad">TwoByteMIDIMatcher::Result::value</a></div><div class="ttdeci">uint8_t value</div><div class="ttdef"><b>Definition</b> <a href="../../d4/d9e/MIDIInputElementMatchers_8hpp_source.html#l00042">MIDIInputElementMatchers.hpp:42</a></div></div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
