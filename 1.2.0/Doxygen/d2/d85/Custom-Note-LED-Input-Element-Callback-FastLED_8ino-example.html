<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.19"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Control Surface: Custom-Note-LED-Input-Element-Callback-FastLED.ino</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/SVG"],
});
</script>
<script type="text/javascript" async="async" src="/MathJax/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../custom_stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Control Surface
   <span id="projectnumber">&#160;<code><a href="/Control-Surface/">1.2.0</a></code></span>
   </div>
   <div id="projectbrief">MIDI Control Surface library for Arduino</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.19 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Custom-Note-LED-Input-Element-Callback-FastLED.ino</div>  </div>
</div><!--header-->
<div class="contents">
<h1><a class="anchor" id="autotoc_md183"></a>
Custom-Note-LED-Input-Element-Callback-FastLED</h1>
<p>This example demonstrates how to attach custom callbacks to Note or Control Change MIDI Input Elements.</p>
<dl class="section user"><dt>Boards:</dt><dd>AVR, AVR USB, Due, Nano 33, Teensy 3.x, ESP32</dd></dl>
<h2><a class="anchor" id="autotoc_md184"></a>
Connections</h2>
<ul>
<li>Pin 2: The data pin of a Neopixel LED strip with (at least) 8 LEDs</li>
</ul>
<h2><a class="anchor" id="autotoc_md185"></a>
Behavior</h2>
<p>If a MIDI Note On event for note 0x3C (C4 or middle C) is sent, its velocity value sets the red value of the first LED, note 0x3D controls the green value of the first LED, note 0x3E controls the blue value of the first LED, note 0x3F controls the red value of the second LED, 0x40 controls the green value of the second LED, etc.</p>
<h2><a class="anchor" id="autotoc_md186"></a>
Mapping</h2>
<p>Route the MIDI output of a MIDI keyboard to the Arduino's MIDI input. Then play some notes in the two octaves above middle C. <br  />
 Alternatively, map it in you DAW, for example, in VirtualDJ: <br  />
 <code>&lt;color notered="0x3C" notegreen="0x3D" noteblue="0x3E" ... /&gt;</code></p>
<p>Written by PieterP, 2020-03-12 <br  />
 <a href="https://github.com/tttapa/Control-Surface">https://github.com/tttapa/Control-Surface</a></p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;FastLED.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../db/dbf/Control__Surface_8h.html">Control_Surface.h</a>&gt;</span> <span class="comment">// Include the Control Surface library</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Instantiate a MIDI over USB interface.</span></div>
<div class="line"><a name="_a0"></a><a class="code" href="../../de/d05/classUSBMIDI__Interface.html">USBMIDI_Interface</a> midi;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="../../d7/d78/namespaceMIDI__Notes.html">MIDI_Notes</a>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Custom callback to handle incoming note events and control the LEDs</span></div>
<div class="line"><span class="keyword">class </span>NoteCCFastLEDCallbackRGB : <span class="keyword">public</span> <a name="_a1"></a><a class="code" href="../../de/d07/structSimpleNoteCCValueCallback.html">SimpleNoteCCValueCallback</a> {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">    NoteCCFastLEDCallbackRGB(CRGB *ledcolors)</div>
<div class="line">        : ledcolors(ledcolors) {}</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Called once upon initialization.</span></div>
<div class="line">    <span class="keywordtype">void</span> begin(<span class="keyword">const</span> <a name="_a2"></a><a class="code" href="../../d7/dab/classINoteCCValue.html">INoteCCValue</a> &amp;input)<span class="keyword"> override </span>{ updateAll(input); }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Called each time a MIDI message is received and an LED has to be updated.</span></div>
<div class="line">    <span class="comment">// @param   input</span></div>
<div class="line">    <span class="comment">//          The NoteCCRange or NoteCCValue object this callback belongs to.</span></div>
<div class="line">    <span class="comment">//          This is the object that actually receives and stores the MIDI</span></div>
<div class="line">    <span class="comment">//          values.</span></div>
<div class="line">    <span class="comment">// @param   index</span></div>
<div class="line">    <span class="comment">//          The index of the value that changed. (zero-based)</span></div>
<div class="line">    <span class="keywordtype">void</span> update(<span class="keyword">const</span> <a class="code" href="../../d7/dab/classINoteCCValue.html">INoteCCValue</a> &amp;input, uint8_t index)<span class="keyword"> override </span>{</div>
<div class="line">        <span class="comment">// Get the MIDI value that changed [0, 127]</span></div>
<div class="line">        uint8_t value      = input.<a name="a3"></a><a class="code" href="../../d7/dab/classINoteCCValue.html#a805eafdff6dc784b13d1cb60318d1e28">getValue</a>(index);</div>
<div class="line">        uint8_t ledIndex   = index / 3;</div>
<div class="line">        uint8_t colorIndex = index % 3;</div>
<div class="line">        <span class="comment">// Update the LED color</span></div>
<div class="line">        ledcolors[ledIndex][colorIndex] = value;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">private</span>:</div>
<div class="line">    <span class="comment">// Pointer to array of FastLED color values for the LEDs</span></div>
<div class="line">    CRGB *ledcolors;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create a type alias for the MIDI Note Input Element that uses</span></div>
<div class="line"><span class="comment">// the custom callback defined above.</span></div>
<div class="line"><span class="keyword">template</span> &lt;u<span class="keywordtype">int</span>8_t RangeLen&gt;</div>
<div class="line"><span class="keyword">using</span> CustomNoteValueLED = <a name="_a4"></a><a class="code" href="../../d5/d80/classGenericNoteCCRange.html">GenericNoteCCRange</a>&lt;<a name="_a5"></a><a class="code" href="../../db/d4b/classMIDIInputElementNote.html">MIDIInputElementNote</a>, </div>
<div class="line">                                              RangeLen, </div>
<div class="line">                                              NoteCCFastLEDCallbackRGB&gt;;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Define the array of leds.</span></div>
<div class="line">Array&lt;CRGB, 8&gt; leds = {};</div>
<div class="line"><span class="comment">// The data pin with the strip connected.</span></div>
<div class="line">constexpr uint8_t ledpin = 2;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create a MIDI input element that listens to all notes in the range C4 - B5</span></div>
<div class="line"><span class="comment">// (the range starts at C4 and has a length equal to `leds.length * 3` == 24).</span></div>
<div class="line"><span class="comment">// Note C4 is the red channel of the first LED,</span></div>
<div class="line"><span class="comment">// Note C#4 is the green channel of the first LED,</span></div>
<div class="line"><span class="comment">// Note D4 is the blue channel of the first LED,</span></div>
<div class="line"><span class="comment">// Note D#4 is the red channel of the second LED, etc.</span></div>
<div class="line">CustomNoteValueLED&lt;leds.length * 3&gt; midiled = {<a name="a6"></a><a class="code" href="../../d7/d78/namespaceMIDI__Notes.html#a559f01ec7251fdc9c5a5bc0e26b97372">note</a>(<a name="a7"></a><a class="code" href="../../d7/d78/namespaceMIDI__Notes.html#aa62045215ec21ab7da02f2f1868ea7b0">C</a>, 4), leds.data};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> setup() {</div>
<div class="line">  <span class="comment">// See FastLED examples and documentation for more information.</span></div>
<div class="line">  FastLED.addLeds&lt;NEOPIXEL, ledpin&gt;(leds.data, leds.length);</div>
<div class="line">  FastLED.setCorrection(TypicalPixelString);</div>
<div class="line">  FastLED.setBrightness(128);</div>
<div class="line">  <a name="a8"></a><a class="code" href="../../d9/d38/Control__Surface__Class_8cpp.html#af7a5d250297d82b2b29605dd7ac250df">Control_Surface</a>.<a name="a9"></a><a class="code" href="../../dc/d45/classControl__Surface__.html#ab0bdf5cca484fb2ba637c39384b27fb2">begin</a>();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> loop() {</div>
<div class="line">  <a class="code" href="../../d9/d38/Control__Surface__Class_8cpp.html#af7a5d250297d82b2b29605dd7ac250df">Control_Surface</a>.<a name="a10"></a><a class="code" href="../../dc/d45/classControl__Surface__.html#afe461d27b9c48d5921c00d521181f12f">loop</a>();</div>
<div class="line">  FastLED.show();</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
<div class="ttc" id="aclassUSBMIDI__Interface_html"><div class="ttname"><a href="../../de/d05/classUSBMIDI__Interface.html">USBMIDI_Interface</a></div><div class="ttdoc">A class for MIDI interfaces sending MIDI messages over a USB MIDI connection.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d64/USBMIDI__Interface_8hpp_source.html#l00041">USBMIDI_Interface.hpp:41</a></div></div>
<div class="ttc" id="aclassMIDIInputElementNote_html"><div class="ttname"><a href="../../db/d4b/classMIDIInputElementNote.html">MIDIInputElementNote</a></div><div class="ttdoc">Class for objects that listen for incoming MIDI Note events.</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d5f/MIDIInputElementNote_8hpp_source.html#l00020">MIDIInputElementNote.hpp:21</a></div></div>
<div class="ttc" id="aclassGenericNoteCCRange_html"><div class="ttname"><a href="../../d5/d80/classGenericNoteCCRange.html">GenericNoteCCRange</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dbb/NoteCCRange_8hpp_source.html#l00155">NoteCCRange.hpp:156</a></div></div>
<div class="ttc" id="aclassINoteCCValue_html"><div class="ttname"><a href="../../d7/dab/classINoteCCValue.html">INoteCCValue</a></div><div class="ttdoc">Interface for NoteCCValue objects: provides getters for the velocity or controller values.</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dbb/NoteCCRange_8hpp_source.html#l00013">NoteCCRange.hpp:13</a></div></div>
<div class="ttc" id="astructSimpleNoteCCValueCallback_html"><div class="ttname"><a href="../../de/d07/structSimpleNoteCCValueCallback.html">SimpleNoteCCValueCallback</a></div><div class="ttdoc">A callback for NoteCCRange with an action that can be implemented by the user.</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dbb/NoteCCRange_8hpp_source.html#l00046">NoteCCRange.hpp:46</a></div></div>
<div class="ttc" id="aControl__Surface_8h_html"><div class="ttname"><a href="../../db/dbf/Control__Surface_8h.html">Control_Surface.h</a></div><div class="ttdoc">The main header file that includes all Control-Surface header files.</div></div>
<div class="ttc" id="aclassControl__Surface___html_afe461d27b9c48d5921c00d521181f12f"><div class="ttname"><a href="../../dc/d45/classControl__Surface__.html#afe461d27b9c48d5921c00d521181f12f">Control_Surface_::loop</a></div><div class="ttdeci">void loop()</div><div class="ttdoc">Update all MIDI elements, send MIDI events and read MIDI input.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d38/Control__Surface__Class_8cpp_source.html#l00068">Control_Surface_Class.cpp:68</a></div></div>
<div class="ttc" id="aControl__Surface__Class_8cpp_html_af7a5d250297d82b2b29605dd7ac250df"><div class="ttname"><a href="../../d9/d38/Control__Surface__Class_8cpp.html#af7a5d250297d82b2b29605dd7ac250df">Control_Surface</a></div><div class="ttdeci">Control_Surface_ &amp; Control_Surface</div><div class="ttdoc">A predefined instance of the Control Surface to use in the Arduino sketches.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d38/Control__Surface__Class_8cpp_source.html#l00203">Control_Surface_Class.cpp:203</a></div></div>
<div class="ttc" id="anamespaceMIDI__Notes_html_a559f01ec7251fdc9c5a5bc0e26b97372"><div class="ttname"><a href="../../d7/d78/namespaceMIDI__Notes.html#a559f01ec7251fdc9c5a5bc0e26b97372">MIDI_Notes::note</a></div><div class="ttdeci">constexpr int8_t note(int8_t note, int8_t numOctave)</div><div class="ttdoc">Get the MIDI note in the given octave.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dc5/Notes_8hpp_source.html#l00035">Notes.hpp:35</a></div></div>
<div class="ttc" id="aclassINoteCCValue_html_a805eafdff6dc784b13d1cb60318d1e28"><div class="ttname"><a href="../../d7/dab/classINoteCCValue.html#a805eafdff6dc784b13d1cb60318d1e28">INoteCCValue::getValue</a></div><div class="ttdeci">virtual uint8_t getValue(uint8_t index) const =0</div><div class="ttdoc">Get the velocity or controller value for the given index in the range.</div></div>
<div class="ttc" id="anamespaceMIDI__Notes_html"><div class="ttname"><a href="../../d7/d78/namespaceMIDI__Notes.html">MIDI_Notes</a></div><div class="ttdoc">MIDI note names.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dc5/Notes_8hpp_source.html#l00016">Notes.hpp:16</a></div></div>
<div class="ttc" id="anamespaceMIDI__Notes_html_aa62045215ec21ab7da02f2f1868ea7b0"><div class="ttname"><a href="../../d7/d78/namespaceMIDI__Notes.html#aa62045215ec21ab7da02f2f1868ea7b0">MIDI_Notes::C</a></div><div class="ttdeci">constexpr int8_t C</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dc5/Notes_8hpp_source.html#l00018">Notes.hpp:18</a></div></div>
<div class="ttc" id="aclassControl__Surface___html_ab0bdf5cca484fb2ba637c39384b27fb2"><div class="ttname"><a href="../../dc/d45/classControl__Surface__.html#ab0bdf5cca484fb2ba637c39384b27fb2">Control_Surface_::begin</a></div><div class="ttdeci">void begin()</div><div class="ttdoc">Initialize the Control_Surface.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d38/Control__Surface__Class_8cpp_source.html#l00025">Control_Surface_Class.cpp:25</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.19
</small></address>
</body>
</html>
