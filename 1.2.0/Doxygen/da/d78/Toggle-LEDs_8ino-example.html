<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.19"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Control Surface: Toggle-LEDs.ino</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/SVG"],
});
</script>
<script type="text/javascript" async="async" src="/MathJax/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../custom_stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Control Surface
   <span id="projectnumber">&#160;<code><a href="/Control-Surface/">1.2.0</a></code></span>
   </div>
   <div id="projectbrief">MIDI Control Surface library for Arduino</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.19 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Toggle-LEDs.ino</div>  </div>
</div><!--header-->
<div class="contents">
<h1><a class="anchor" id="autotoc_md204"></a>
Toggle-LEDs</h1>
<p>This example demonstrates the use of push buttons and LEDs and how to use shift registers and analog multiplexers to save pins.</p>
<dl class="section user"><dt>Boards:</dt><dd>AVR, AVR USB, Nano Every, Nano 33, Due, Teensy 3.x, ESP8266, ESP32</dd></dl>
<h2><a class="anchor" id="autotoc_md205"></a>
Connections</h2>
<ul>
<li>SS: 74HC595 ST_CP</li>
<li>MOSI: 74HC595 DS</li>
<li>SCK: 74HC595 SH_CP</li>
<li>2: 74HC4067 A (COM OUT/IN)</li>
<li>3: 74HC4067 S0</li>
<li>4: 74HC4067 S1</li>
<li>5: 74HC4067 S2</li>
<li>6: 74HC4067 S3</li>
</ul>
<p>Connect 16 momentary push buttons between the input pins of the multiplexer and ground. <br  />
 The internal pull-up resistor for the buttons will be enabled automatically, so no external resistors are necessary.</p>
<p>Connect 16 LEDs (and series resistors) between the eight outputs of the two shift registers and ground.</p>
<p>Remember to connect the enable pins of both the multiplexer and the shift registers to ground in order to enable them. Also connect the master reset pin of the shift registers to Vcc. <br  />
 Connect the serial data output of the first shift register (QH' or Q7S) to the serial input of the second shift register.</p>
<h2><a class="anchor" id="autotoc_md206"></a>
Behavior</h2>
<p>Pressing the first button will turn on the first LED. Pressing it again will turn it off again. Pressing the second button will turn on the second LED. Pressing it again will turn it off again, and so on.</p>
<p>Written by PieterP, 2018-08-28 <br  />
 <a href="https://github.com/tttapa/Arduino-Helpers">https://github.com/tttapa/Arduino-Helpers</a></p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../dc/de6/Arduino__Helpers_8h.html">Arduino_Helpers.h</a>&gt;</span> <span class="comment">// Include the Arduino Helpers library.</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d5/db6/ArrayHelpers_8hpp.html">AH/Containers/ArrayHelpers.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d4/db3/Button_8hpp.html">AH/Hardware/Button.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d7/def/AnalogMultiplex_8hpp.html">AH/Hardware/ExtendedInputOutput/AnalogMultiplex.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d7/d88/SPIShiftRegisterOut_8hpp.html">AH/Hardware/ExtendedInputOutput/SPIShiftRegisterOut.hpp</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Instantiate a multiplexer</span></div>
<div class="line"><a name="a0"></a><a class="code" href="../../db/dd3/group__AH__ExtIO.html#ga76abe1cbb481b44875fb5e08da186ad0">CD74HC4067</a> mux = {</div>
<div class="line">  2,            <span class="comment">// input pin</span></div>
<div class="line">  {3, 4, 5, 6}, <span class="comment">// Address pins S0, S1, S2, S3</span></div>
<div class="line">  <span class="comment">// 7, // Optionally, specify the enable pin</span></div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Alternatively, if you have a 3-bit mux:</span></div>
<div class="line"><span class="comment">// CD74HC4051 mux = {</span></div>
<div class="line"><span class="comment">//   2,</span></div>
<div class="line"><span class="comment">//   {3, 4, 5},</span></div>
<div class="line"><span class="comment">//   // 7, // Optional</span></div>
<div class="line"><span class="comment">// };</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Instantiate a shift register with the SPI slave select pin as latch pin, most</span></div>
<div class="line"><span class="comment">// significant bit first, and a total of 16 outputs.</span></div>
<div class="line">SPIShiftRegisterOut&lt;mux.length()&gt; sreg = {SS, MSBFIRST};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Instantiate an array of momentary push buttons.</span></div>
<div class="line"><span class="comment">// It generates an array of Buttons on pins:</span></div>
<div class="line"><span class="comment">// { mux.pin(0), mux.pin(1) ... mux.pin(15) }</span></div>
<div class="line"><span class="comment">// For each button it creates, it increments the pin number by 1,</span></div>
<div class="line"><span class="comment">// and it starts counting from mux.pin(0)</span></div>
<div class="line"><span class="keyword">auto</span> buttons = <a name="a1"></a><a class="code" href="../../dc/d69/namespaceAH.html#ab7b9dc6793f9c9c808f62617550e1472">generateIncrementalArray</a>&lt;Button, mux.length()&gt;(mux.pin(0));</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> setup() { <span class="comment">// Initialize everything</span></div>
<div class="line">  mux.begin();</div>
<div class="line">  sreg.begin();</div>
<div class="line">  <span class="keywordflow">for</span> (Button &amp;button : buttons)</div>
<div class="line">    button.begin();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> loop() { <span class="comment">// Check if a button is pressed, if so toggle the LED</span></div>
<div class="line">  <span class="keywordflow">for</span> (uint8_t i = 0; i &lt; mux.length(); ++i)</div>
<div class="line">    <span class="keywordflow">if</span> (buttons[i].update() == Button::Falling)</div>
<div class="line">      sreg.digitalWrite(i, sreg.digitalRead(i) ? <a name="a2"></a><a class="code" href="../../dd/ddf/ExtendedInputOutput_8hpp.html#ad294464395ca0655395db09e768fdc1d">LOW</a> : <a name="a3"></a><a class="code" href="../../dd/ddf/ExtendedInputOutput_8hpp.html#a1a23a9c76c68c1dab0655f95291a75af">HIGH</a>);</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
<div class="ttc" id="aExtendedInputOutput_8hpp_html_ad294464395ca0655395db09e768fdc1d"><div class="ttname"><a href="../../dd/ddf/ExtendedInputOutput_8hpp.html#ad294464395ca0655395db09e768fdc1d">LOW</a></div><div class="ttdeci">const PinStatus_t LOW</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/ddf/ExtendedInputOutput_8hpp_source.html#l00057">ExtendedInputOutput.hpp:57</a></div></div>
<div class="ttc" id="aButton_8hpp_html"><div class="ttname"><a href="../../d4/db3/Button_8hpp.html">Button.hpp</a></div></div>
<div class="ttc" id="aSPIShiftRegisterOut_8hpp_html"><div class="ttname"><a href="../../d7/d88/SPIShiftRegisterOut_8hpp.html">SPIShiftRegisterOut.hpp</a></div></div>
<div class="ttc" id="anamespaceAH_html_ab7b9dc6793f9c9c808f62617550e1472"><div class="ttname"><a href="../../dc/d69/namespaceAH.html#ab7b9dc6793f9c9c808f62617550e1472">AH::generateIncrementalArray</a></div><div class="ttdeci">Array&lt; T, N &gt; generateIncrementalArray(U start=0, V increment=V(1))</div><div class="ttdoc">Generate an array where the first value is given, and the subsequent values are calculated as the pre...</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/db6/ArrayHelpers_8hpp_source.html#l00183">ArrayHelpers.hpp:183</a></div></div>
<div class="ttc" id="aExtendedInputOutput_8hpp_html_a1a23a9c76c68c1dab0655f95291a75af"><div class="ttname"><a href="../../dd/ddf/ExtendedInputOutput_8hpp.html#a1a23a9c76c68c1dab0655f95291a75af">HIGH</a></div><div class="ttdeci">const PinStatus_t HIGH</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/ddf/ExtendedInputOutput_8hpp_source.html#l00056">ExtendedInputOutput.hpp:56</a></div></div>
<div class="ttc" id="aAnalogMultiplex_8hpp_html"><div class="ttname"><a href="../../d7/def/AnalogMultiplex_8hpp.html">AnalogMultiplex.hpp</a></div></div>
<div class="ttc" id="aArrayHelpers_8hpp_html"><div class="ttname"><a href="../../d5/db6/ArrayHelpers_8hpp.html">ArrayHelpers.hpp</a></div></div>
<div class="ttc" id="aArduino__Helpers_8h_html"><div class="ttname"><a href="../../dc/de6/Arduino__Helpers_8h.html">Arduino_Helpers.h</a></div><div class="ttdoc">Dummy header file for Arduino builder.</div></div>
<div class="ttc" id="agroup__AH__ExtIO_html_ga76abe1cbb481b44875fb5e08da186ad0"><div class="ttname"><a href="../../db/dd3/group__AH__ExtIO.html#ga76abe1cbb481b44875fb5e08da186ad0">AH::CD74HC4067</a></div><div class="ttdeci">AnalogMultiplex&lt; 4 &gt; CD74HC4067</div><div class="ttdoc">An alias for AnalogMultiplex&lt;4&gt; to use with CD74HC4067 analog multiplexers.</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/def/AnalogMultiplex_8hpp_source.html#l00179">AnalogMultiplex.hpp:179</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.19
</small></address>
</body>
</html>
