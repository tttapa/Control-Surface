<!-- HTML header for doxygen 1.9.2-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Control Surface: MIDI Tutorial</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript">
window.MathJax = {
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  }
};
</script>
<script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300&family=Roboto:wght@400&family=Roboto:wght@500&display=swap" rel="stylesheet">
<link href="../../custom_stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
  <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Control Surface<span id="projectnumber">&#160;<code><a href="/Control-Surface/">develop</a></code></span>
   </div>
   <div id="projectbrief">MIDI Control Surface library for Arduino</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">MIDI Tutorial </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md311">The MIDI protocol</a></li>
<li class="level1"><a href="#midi_md-midi-interfaces">MIDI interfaces</a><ul><li class="level2"><a href="#midi_md-interfaces-supported-boards">Supported Arduino-compatible boards</a></li>
<li class="level2"><a href="#midi_md-interfaces-functionality">Functionality</a></li>
<li class="level2"><a href="#midi_md-instantiate-a-midi-interface">Instantiating a MIDI interface</a></li>
</ul>
</li>
<li class="level1"><a href="#midi_md-sending">Sending MIDI messages</a><ul><li class="level2"><a href="#midi_md-sending-simple-example">Simple example</a></li>
<li class="level2"><a href="#midi_md-midi-addresses">MIDI addresses</a><ul><li class="level3"><a href="#midi_md-creating-a-midi-address-variable">Creating a MIDI address variable</a></li>
<li class="level3"><a href="#midi_md-midi-note-names">MIDI Note names</a></li>
<li class="level3"><a href="#midi_md-midi-control-change-names">MIDI Control Change names</a></li>
<li class="level3"><a href="#midi_md-midi-program-change-names">MIDI Program Change names</a></li>
</ul>
</li>
<li class="level2"><a href="#midi_md-sending-more-examples">More examples</a></li>
</ul>
</li>
<li class="level1"><a href="#midi_md-receiving">Receiving MIDI messages</a><ul><li class="level2"><a href="#midi_md-receiving-simple-example">Simple example</a></li>
<li class="level2"><a href="#midi_md-receiving-customizable-callbacks">Customizable callbacks</a></li>
<li class="level2"><a href="#midi_md-accessing-the-contents-of-the-message">Accessing the contents of the message</a></li>
<li class="level2"><a href="#midi_md-listening-for-specific-messages">Listening for specific messages</a></li>
<li class="level2"><a href="#midi_md-receiving-more-examples">More examples</a></li>
</ul>
</li>
<li class="level1"><a href="#midi_md-routing">Routing MIDI messages</a><ul><li class="level2"><a href="#midi_md-default-routing">Default routing</a></li>
<li class="level2"><a href="#midi_md-manual-routing">Manual routing</a></li>
<li class="level2"><a href="#midi_md-bidir-pipes">Bidirectional MIDI pipes</a></li>
<li class="level2"><a href="#midi_md-multiple-interfaces-routing">Multiple MIDI interfaces</a></li>
<li class="level2"><a href="#midi_md-pipe-factories">MIDI pipe factories</a></li>
<li class="level2"><a href="#midi_md-routing-between-interfaces">Routing between MIDI interfaces</a></li>
<li class="level2"><a href="#midi_md-routing-more-examples">More examples</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p ><a class="anchor" id="md_pages_MIDI"></a></p>
<h1><a class="anchor" id="autotoc_md311"></a>
The MIDI protocol</h1>
<p >This guide expects basic familiarity with the MIDI protocol and the different types of MIDI messages. You can find more information about MIDI on <a href="https://www.midi.org/">https://www.midi.org/</a>, the <a href="https://www.midi.org/specifications-old/item/table-1-summary-of-midi-message">summary of MIDI messages</a> can be especially handy.</p>
<h1><a class="anchor" id="midi_md-midi-interfaces"></a>
MIDI interfaces</h1>
<p >Control Surface supports sending and receiving MIDI messages in many different ways: over a standard 5-pin DIN MIDI cable, over USB, over Bluetooth, over WiFi ... <br  />
 Each of those methods is available as a “MIDI Interface” class in the code, you can find a full overview in the <a class="el" href="../../dc/df0/group__MIDIInterfaces.html">MIDI Interfaces</a> module.</p>
<p >The interfaces you're most likely to use are:</p><ul>
<li><a class="el" href="../../de/d05/classUSBMIDI__Interface.html">USBMIDI_Interface</a> : the Arduino will be recognized as a MIDI USB device when you plug it into your computer, and this interface allows you to send and receive MIDI messages to and from applications running on the computer.</li>
<li><a class="el" href="../../de/d2d/classUSBDebugMIDI__Interface.html">USBDebugMIDI_Interface</a> : prints all messages to the Arduino Serial Monitor in a human-readable format, and allows you to easily check that your code sends the correct messages. Also allows you to send messages to the Arduino from the Serial Monitor.</li>
<li><a class="el" href="../../d9/d78/classHardwareSerialMIDI__Interface.html">HardwareSerialMIDI_Interface</a> : sends and receives MIDI over the TX and RX pins of the Arduino, can be used with standard 5-pin DIN MIDI.</li>
</ul>
<p >Other available interfaces are <a class="el" href="../../d0/d89/classBluetoothMIDI__Interface.html">BluetoothMIDI_Interface</a>, <a class="el" href="../../dc/dff/classHairlessMIDI__Interface.html">HairlessMIDI_Interface</a>, <a class="el" href="../../d6/d6d/classSoftwareSerialMIDI__Interface.html">SoftwareSerialMIDI_Interface</a>, <a class="el" href="../../d3/d56/classUSBHostMIDI__Interface.html">USBHostMIDI_Interface</a> ...</p>
<h2><a class="anchor" id="midi_md-interfaces-supported-boards"></a>
Supported Arduino-compatible boards</h2>
<p >Not all MIDI interfaces are supported on all Arduino boards. For example, not all Arduino boards support MIDI over USB natively. You can find an overview of boards that do support it on the <a class="el" href="../../d8/d4a/md_pages_MIDI-over-USB.html">MIDI over USB</a> page.</p>
<p >MIDI over BLE is currently only supported on the ESP32. <br  />
 USB Host MIDI is only supported on the Teensy 3.6 and 4.1 boards.</p>
<h2><a class="anchor" id="midi_md-interfaces-functionality"></a>
Functionality</h2>
<p >The MIDI interfaces provide the following functionality:</p><ul>
<li><b>Sending MIDI</b>: You can send MIDI messages from your Arduino code to whatever device is connected on the other side of the interface.</li>
<li><b>Receiving MIDI</b>: MIDI messages sent by the device on the other side can be read and inspected in your code, or you can register a callback that gets called whenever a message arrives through the interface.</li>
<li><b>Routing MIDI</b>: Interfaces can be set up such that MIDI messages that arrive on one interface are automatically routed to other interfaces, and you can filter or modify the messages in between.</li>
</ul>
<p >In the remainder of this tutorial, one section will be devoted to each of these functions.</p>
<h2><a class="anchor" id="midi_md-instantiate-a-midi-interface"></a>
Instantiating a MIDI interface</h2>
<p >The following code snippet demonstrates how to instantiate, initialize, and update a MIDI over USB interface. By “instantiate”, we mean that a variable is created that is an <em>instance</em> of the <code><a class="el" href="../../de/d05/classUSBMIDI__Interface.html" title="A class for MIDI interfaces sending MIDI messages over a USB MIDI connection.">USBMIDI_Interface</a></code> type.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../db/dbf/Control__Surface_8h.html">Control_Surface.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Instantiate a MIDI over USB interface with the name `midi`</span></div>
<div class="line"><a class="code hl_class" href="../../de/d05/classUSBMIDI__Interface.html">USBMIDI_Interface</a> midi;</div>
<div class="line"><span class="comment">// `midi` is the name of a variable of type `USBMIDI_Interface`</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> setup() {</div>
<div class="line">    <span class="comment">// Initialize the MIDI interface so it&#39;s ready to be used</span></div>
<div class="line">    midi.<a class="code hl_function" href="../../dd/d0e/classGenericUSBMIDI__Interface.html#a7c3e14d99bd3dc0e3670d6956dafcaf2">begin</a>();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> loop() {</div>
<div class="line">    <span class="comment">// Continuously listen for incoming MIDI messages</span></div>
<div class="line">    midi.<a class="code hl_function" href="../../dd/d0e/classGenericUSBMIDI__Interface.html#a44137bb65de2396875934e48a6ee5099">update</a>();</div>
<div class="line">}</div>
<div class="ttc" id="aControl__Surface_8h_html"><div class="ttname"><a href="../../db/dbf/Control__Surface_8h.html">Control_Surface.h</a></div><div class="ttdoc">The main header file that includes all Control-Surface header files.</div></div>
<div class="ttc" id="aclassGenericUSBMIDI__Interface_html_a44137bb65de2396875934e48a6ee5099"><div class="ttname"><a href="../../dd/d0e/classGenericUSBMIDI__Interface.html#a44137bb65de2396875934e48a6ee5099">GenericUSBMIDI_Interface::update</a></div><div class="ttdeci">void update() override</div><div class="ttdoc">Read the MIDI interface and call the callback if a message was received.</div></div>
<div class="ttc" id="aclassGenericUSBMIDI__Interface_html_a7c3e14d99bd3dc0e3670d6956dafcaf2"><div class="ttname"><a href="../../dd/d0e/classGenericUSBMIDI__Interface.html#a7c3e14d99bd3dc0e3670d6956dafcaf2">GenericUSBMIDI_Interface::begin</a></div><div class="ttdeci">void begin() override</div><div class="ttdoc">Initialize the MIDI Interface.</div></div>
<div class="ttc" id="aclassUSBMIDI__Interface_html"><div class="ttname"><a href="../../de/d05/classUSBMIDI__Interface.html">USBMIDI_Interface</a></div><div class="ttdoc">A class for MIDI interfaces sending MIDI messages over a USB MIDI connection.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d64/USBMIDI__Interface_8hpp_source.html#l00148">USBMIDI_Interface.hpp:149</a></div></div>
</div><!-- fragment --><p> Note how the words <code>USBMIDI_Interface</code>, <code>begin</code> and <code>update</code> in the previous snippet are shown in blue and brown: these are links to the documentation for the relevant classes and functions. If you hover over them with your mouse pointer, you'll see a short description, and if you click on the link, it will take you to the detailed documentation.</p>
<p >The code above doesn't really anything useful yet, it just sets up everything so we can start sending and receiving MIDI messages in the following sections.</p>
<p >You can of course replace <code>USBMIDI_Interface</code> by a different type, such as <code>USBDebugMIDI_Interface</code> if that's the MIDI interface you need for your application. </p><div class="fragment"><div class="line"><a class="code hl_class" href="../../de/d2d/classUSBDebugMIDI__Interface.html">USBDebugMIDI_Interface</a> midi;</div>
<div class="ttc" id="aclassUSBDebugMIDI__Interface_html"><div class="ttname"><a href="../../de/d2d/classUSBDebugMIDI__Interface.html">USBDebugMIDI_Interface</a></div><div class="ttdoc">A class for debug MIDI interfaces sending and receiving human-readable MIDI messages over the USB CDC...</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d55/DebugMIDI__Interface_8hpp_source.html#l00314">DebugMIDI_Interface.hpp:315</a></div></div>
</div><!-- fragment --><p> Some classes allow you to specify extra parameters: for example, <code>USBDebugMIDI_Interface</code> accepts an optional argument that specifies the baud rate to use when communicating with the Serial Monitor. The possible parameters can be found in the documentation for the <em>constructor</em> of the class in question, for example, see <a class="el" href="../../de/d2d/classUSBDebugMIDI__Interface.html#a8cefbc3dc0153b5b6c39984e10d5e2a5">USBDebugMIDI_Interface::USBDebugMIDI_Interface()</a>, it lists <code>baud</code> as an optional parameter. You can see that it's an optional parameter, because its name is followed by an equal sign (<code>=</code>) and a default value in the function signature.</p>
<p >To specify the baud rate using this parameter, you can replace the declaration of the <code>midi</code> variable in the previous snippet by the following: </p><div class="fragment"><div class="line"><span class="comment">// Instantiate a debug MIDI interface with a baud rate of 9600</span></div>
<div class="line"><a class="code hl_class" href="../../de/d2d/classUSBDebugMIDI__Interface.html">USBDebugMIDI_Interface</a> midi {9600};</div>
</div><!-- fragment --><p> Other interfaces might require multiple parameters. Consider <code>HardwareSerialMIDI_Interface</code> as an example. Have a look at the documentation of its constructor <a class="el" href="../../d9/d78/classHardwareSerialMIDI__Interface.html#a416807fb29a9771ff2e5ac528582fc78">HardwareSerialMIDI_Interface::HardwareSerialMIDI_Interface()</a>, you'll see that the first required parameter is the serial port to use, and the second (optional) parameter is the baud rate.</p>
<p >For example: </p><div class="fragment"><div class="line"><span class="comment">// Instantiate a hardware MIDI interface with Serial1 as its UART,</span></div>
<div class="line"><span class="comment">// using the default baud rate</span></div>
<div class="line"><a class="code hl_class" href="../../d9/d78/classHardwareSerialMIDI__Interface.html">HardwareSerialMIDI_Interface</a> midi {Serial1};</div>
<div class="ttc" id="aclassHardwareSerialMIDI__Interface_html"><div class="ttname"><a href="../../d9/d78/classHardwareSerialMIDI__Interface.html">HardwareSerialMIDI_Interface</a></div><div class="ttdoc">A class for MIDI interfaces sending and receiving MIDI messages over a Hardware Serial port.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d23/SerialMIDI__Interface_8hpp_source.html#l00103">SerialMIDI_Interface.hpp:104</a></div></div>
</div><!-- fragment --> <div class="fragment"><div class="line"><span class="comment">// Instantiate a hardware MIDI interface with Serial1 as its UART,</span></div>
<div class="line"><span class="comment">// using a baud rate of 115200</span></div>
<div class="line"><a class="code hl_class" href="../../d9/d78/classHardwareSerialMIDI__Interface.html">HardwareSerialMIDI_Interface</a> midi {Serial1, 115200};</div>
</div><!-- fragment --><h1><a class="anchor" id="midi_md-sending"></a>
Sending MIDI messages</h1>
<p >The functions for sending MIDI messages are all listed in the <a class="el" href="../../d6/d72/classMIDI__Sender.html">MIDI_Sender</a> class. These functions are available for all MIDI interfaces.</p>
<h2><a class="anchor" id="midi_md-sending-simple-example"></a>
Simple example</h2>
<p >First, we'll give a simple example that just triggers a MIDI note every second:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../db/dbf/Control__Surface_8h.html">Control_Surface.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Instantiate a MIDI over USB interface</span></div>
<div class="line"><a class="code hl_class" href="../../de/d05/classUSBMIDI__Interface.html">USBMIDI_Interface</a> midi;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> setup() {</div>
<div class="line">    midi.<a class="code hl_function" href="../../db/dc4/classSerialDebugMIDI__Interface.html#a7c3e14d99bd3dc0e3670d6956dafcaf2">begin</a>(); <span class="comment">// Initialize the MIDI interface</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Specify the MIDI note number to trigger, and the velocity with which to </span></div>
<div class="line"><span class="comment">// trigger it</span></div>
<div class="line"><span class="keyword">const</span> <a class="code hl_class" href="../../d7/d0f/classMIDIAddress.html">MIDIAddress</a> <a class="code hl_function" href="../../d7/d78/namespaceMIDI__Notes.html#a2e24f539c8d167db46ebd2ee6514ecec">note</a> = <a class="code hl_variable" href="../../d7/d78/namespaceMIDI__Notes.html#adc612a1e4e057463777480eabc3fb0ca">MIDI_Notes::C</a>(4); <span class="comment">// C(4) is middle C</span></div>
<div class="line"><span class="keyword">const</span> uint8_t velocity = 127;              <span class="comment">// 127 is maximum velocity</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> loop() {</div>
<div class="line">    <span class="comment">// Send a MIDI Note On message for the given note to trigger it</span></div>
<div class="line">    midi.<a class="code hl_function" href="../../d6/d72/classMIDI__Sender.html#ad487d041b8e9d10d58aba470a15e1fc6">sendNoteOn</a>(<a class="code hl_function" href="../../d7/d78/namespaceMIDI__Notes.html#a2e24f539c8d167db46ebd2ee6514ecec">note</a>, velocity);  </div>
<div class="line">    delay(500);</div>
<div class="line">    <span class="comment">// Send a MIDI Note Off message to turn it off again</span></div>
<div class="line">    midi.<a class="code hl_function" href="../../d6/d72/classMIDI__Sender.html#ae5438982b69a41d7b4565328f5fd73c8">sendNoteOff</a>(<a class="code hl_function" href="../../d7/d78/namespaceMIDI__Notes.html#a2e24f539c8d167db46ebd2ee6514ecec">note</a>, velocity);</div>
<div class="line">    delay(500);</div>
<div class="line">    </div>
<div class="line">    midi.<a class="code hl_function" href="../../d8/d0b/classStreamDebugMIDI__Interface.html#a44137bb65de2396875934e48a6ee5099">update</a>();</div>
<div class="line">}</div>
<div class="ttc" id="aclassMIDIAddress_html"><div class="ttname"><a href="../../d7/d0f/classMIDIAddress.html">MIDIAddress</a></div><div class="ttdoc">A type-safe utility class for saving a MIDI address consisting of a 7-bit address,...</div><div class="ttdef"><b>Definition:</b> <a href="../../db/dd6/MIDIAddress_8hpp_source.html#l00145">MIDIAddress.hpp:145</a></div></div>
<div class="ttc" id="aclassMIDI__Sender_html_ad487d041b8e9d10d58aba470a15e1fc6"><div class="ttname"><a href="../../d6/d72/classMIDI__Sender.html#ad487d041b8e9d10d58aba470a15e1fc6">MIDI_Sender::sendNoteOn</a></div><div class="ttdeci">void sendNoteOn(MIDIAddress address, uint8_t velocity)</div><div class="ttdoc">Send a MIDI Note On event.</div></div>
<div class="ttc" id="aclassMIDI__Sender_html_ae5438982b69a41d7b4565328f5fd73c8"><div class="ttname"><a href="../../d6/d72/classMIDI__Sender.html#ae5438982b69a41d7b4565328f5fd73c8">MIDI_Sender::sendNoteOff</a></div><div class="ttdeci">void sendNoteOff(MIDIAddress address, uint8_t velocity)</div><div class="ttdoc">Send a MIDI Note Off event.</div></div>
<div class="ttc" id="aclassSerialDebugMIDI__Interface_html_a7c3e14d99bd3dc0e3670d6956dafcaf2"><div class="ttname"><a href="../../db/dc4/classSerialDebugMIDI__Interface.html#a7c3e14d99bd3dc0e3670d6956dafcaf2">SerialDebugMIDI_Interface::begin</a></div><div class="ttdeci">void begin() override</div><div class="ttdoc">Start the Serial interface at the predefined baud rate.</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d55/DebugMIDI__Interface_8hpp_source.html#l00269">DebugMIDI_Interface.hpp:269</a></div></div>
<div class="ttc" id="aclassStreamDebugMIDI__Interface_html_a44137bb65de2396875934e48a6ee5099"><div class="ttname"><a href="../../d8/d0b/classStreamDebugMIDI__Interface.html#a44137bb65de2396875934e48a6ee5099">StreamDebugMIDI_Interface::update</a></div><div class="ttdeci">void update() override</div><div class="ttdoc">Read the MIDI interface and call the callback if a message was received.</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d40/DebugMIDI__Interface_8cpp_source.html#l00044">DebugMIDI_Interface.cpp:44</a></div></div>
<div class="ttc" id="anamespaceMIDI__Notes_html_a2e24f539c8d167db46ebd2ee6514ecec"><div class="ttname"><a href="../../d7/d78/namespaceMIDI__Notes.html#a2e24f539c8d167db46ebd2ee6514ecec">MIDI_Notes::note</a></div><div class="ttdeci">constexpr int8_t note(Note note, int8_t numOctave)</div><div class="ttdoc">Get the MIDI note in the given octave.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dc5/Notes_8hpp_source.html#l00056">Notes.hpp:56</a></div></div>
<div class="ttc" id="anamespaceMIDI__Notes_html_adc612a1e4e057463777480eabc3fb0ca"><div class="ttname"><a href="../../d7/d78/namespaceMIDI__Notes.html#adc612a1e4e057463777480eabc3fb0ca">MIDI_Notes::C</a></div><div class="ttdeci">constexpr Note C</div><div class="ttdoc">C (Do)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dc5/Notes_8hpp_source.html#l00040">Notes.hpp:40</a></div></div>
</div><!-- fragment --><p >First of all, compare this example to the code under <a class="el" href="../../d3/df7/midi-tutorial.html#midi_md-instantiate-a-midi-interface">Instantiating a MIDI interface</a> : you'll see that the instantiation, initialization and updating of the MIDI interface are exactly the same.</p>
<p >The second thing you'll notice are the two constants, <code>note</code> and <code>velocity</code>: these define the MIDI note number and the velocity (how hard the key is struck) to be used when sending the MIDI messages later. <br  />
 The function <code>MIDI_Notes::C(4)</code> gives you the note C in the fourth octave, or middle C. The velocity is a value between 1 and 127, with higher values being louder and harder.</p>
<p >The <code><a class="el" href="../../d7/d0f/classMIDIAddress.html" title="A type-safe utility class for saving a MIDI address consisting of a 7-bit address,...">MIDIAddress</a></code> data type is one of the most important types in the library, it specifies the destination of each MIDI message: in this case, it specifies the note we want to trigger. In a following section, we'll look into <code>MIDIAddress</code> in a bit more detail.</p>
<p >In the loop function, the <code>note</code> and <code>velocity</code> constants are then used to actually send the MIDI messages. This is done by calling the <code>sendNoteOn()</code> and <code>sendNoteOff()</code> member functions of the MIDI interface. You can find the documentation in the <a class="el" href="../../d6/d72/classMIDI__Sender.html">MIDI_Sender</a> class mentioned earlier, or you can click the brown links in the code snippet.</p>
<h2><a class="anchor" id="midi_md-midi-addresses"></a>
MIDI addresses</h2>
<p >To send a MIDI note message, you need to know the MIDI note number of the note you want to trigger, the MIDI channel to send it to, and the virtual cable to send it over. These three pieces of information are stored by the <code><a class="el" href="../../d7/d0f/classMIDIAddress.html" title="A type-safe utility class for saving a MIDI address consisting of a 7-bit address,...">MIDIAddress</a></code> type.</p>
<p >For MIDI messages other than Note On/Off, the note number might be replaced by a different type of address, such as the controller number for Control Change messages, or the patch/program number for Program Change messages, but the format remains the same:</p>
<ul>
<li>The actual address, like the MIDI note number or the MIDI Control Change controller number, a number between 0 and 127</li>
<li>The MIDI <a class="el" href="../../d2/d48/classChannel.html" title="A type-safe class for MIDI channels.">Channel</a>, between channel 1 and channel 16</li>
<li>The MIDI USB Virtual <a class="el" href="../../d2/d75/classCable.html" title="A type-safe class for MIDI USB Cable numbers.">Cable</a> Number, between cable 1 and cable 16</li>
</ul>
<p >The MIDI USB <a class="el" href="../../d2/d75/classCable.html" title="A type-safe class for MIDI USB Cable numbers.">Cable</a> Number is only used on boards that have support for multiple virtual MIDI cables over a single USB connection. As far as I know, only Teensies support this. USB-capable boards that use the MIDIUSB library do not support multiple MIDI cables. <br  />
 Serial (5-pin DIN) MIDI and MIDI over Bluetooth LE have no notion of cables.</p>
<h3><a class="anchor" id="midi_md-creating-a-midi-address-variable"></a>
Creating a MIDI address variable</h3>
<p >Have a look at the documentation of <a class="el" href="../../d7/d0f/classMIDIAddress.html">MIDIAddress</a>. (You can click the link in the previous sentence). If you scroll down to the <em>Constructors</em> section, you'll see that there are different ways to create a <a class="el" href="../../d7/d0f/classMIDIAddress.html">MIDIAddress</a>. <br  />
 This is the most important one: <a class="el" href="../../d7/d0f/classMIDIAddress.html#a21dbe9301484bbecc26f7898268f7ec3">MIDIAddress::MIDIAddress(int, Channel, Cable)</a></p>
<div class="fragment"><div class="line"><a class="code hl_class" href="../../d7/d0f/classMIDIAddress.html">MIDIAddress</a>(<span class="keywordtype">int</span> address, </div>
<div class="line">            <a class="code hl_class" href="../../d2/d48/classChannel.html">Channel</a> channel = <a class="code hl_variable" href="../../d7/d42/Channel_8hpp.html#a40d189f24e13a7304f2c9094038588ae">Channel_1</a>,</div>
<div class="line">            <a class="code hl_class" href="../../d2/d75/classCable.html">Cable</a> cableNumber = <a class="code hl_variable" href="../../d2/dbc/Cable_8hpp.html#af5cfabc9ecb43e686ae0c1d0aac10497">Cable_1</a>)</div>
<div class="ttc" id="aCable_8hpp_html_af5cfabc9ecb43e686ae0c1d0aac10497"><div class="ttname"><a href="../../d2/dbc/Cable_8hpp.html#af5cfabc9ecb43e686ae0c1d0aac10497">Cable_1</a></div><div class="ttdeci">constexpr Cable Cable_1</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dbc/Cable_8hpp_source.html#l00118">Cable.hpp:118</a></div></div>
<div class="ttc" id="aChannel_8hpp_html_a40d189f24e13a7304f2c9094038588ae"><div class="ttname"><a href="../../d7/d42/Channel_8hpp.html#a40d189f24e13a7304f2c9094038588ae">Channel_1</a></div><div class="ttdeci">constexpr Channel Channel_1</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/Channel_8hpp_source.html#l00118">Channel.hpp:118</a></div></div>
<div class="ttc" id="aclassCable_html"><div class="ttname"><a href="../../d2/d75/classCable.html">Cable</a></div><div class="ttdoc">A type-safe class for MIDI USB Cable numbers.</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dbc/Cable_8hpp_source.html#l00013">Cable.hpp:13</a></div></div>
<div class="ttc" id="aclassChannel_html"><div class="ttname"><a href="../../d2/d48/classChannel.html">Channel</a></div><div class="ttdoc">A type-safe class for MIDI channels.</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/Channel_8hpp_source.html#l00013">Channel.hpp:13</a></div></div>
</div><!-- fragment --><p >It allows you to specify all three of the fields explained above. The channel and the cable number have default values, so these parameters are optional. If you don't specify the channel and the cable number, it will use the first channel on the first cable.</p>
<p >For example: </p><div class="fragment"><div class="line"><span class="comment">// Address 16 on channel 1 and cable 1:</span></div>
<div class="line"><a class="code hl_class" href="../../d7/d0f/classMIDIAddress.html">MIDIAddress</a> myAddress = 16;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Address 42 on channel 2 and cable 1:</span></div>
<div class="line"><a class="code hl_class" href="../../d7/d0f/classMIDIAddress.html">MIDIAddress</a> myAddress = {42, <a class="code hl_variable" href="../../d7/d42/Channel_8hpp.html#a6002e13e1e175446065a3eb90373fcfd">Channel_2</a>};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Address 111 on channel 2 and cable 3:</span></div>
<div class="line"><a class="code hl_class" href="../../d7/d0f/classMIDIAddress.html">MIDIAddress</a> myAddress = {111, <a class="code hl_variable" href="../../d7/d42/Channel_8hpp.html#a6002e13e1e175446065a3eb90373fcfd">Channel_2</a>, <a class="code hl_variable" href="../../d2/dbc/Cable_8hpp.html#a0ace4d5a060dfd6b51df50458221e3b0">Cable_3</a>};</div>
<div class="ttc" id="aCable_8hpp_html_a0ace4d5a060dfd6b51df50458221e3b0"><div class="ttname"><a href="../../d2/dbc/Cable_8hpp.html#a0ace4d5a060dfd6b51df50458221e3b0">Cable_3</a></div><div class="ttdeci">constexpr Cable Cable_3</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dbc/Cable_8hpp_source.html#l00120">Cable.hpp:120</a></div></div>
<div class="ttc" id="aChannel_8hpp_html_a6002e13e1e175446065a3eb90373fcfd"><div class="ttname"><a href="../../d7/d42/Channel_8hpp.html#a6002e13e1e175446065a3eb90373fcfd">Channel_2</a></div><div class="ttdeci">constexpr Channel Channel_2</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/Channel_8hpp_source.html#l00119">Channel.hpp:119</a></div></div>
</div><!-- fragment --><p >If you specify just a single argument, as in the first example, you don't have to use curly braces (<code>{}</code>). If you specify more than one argument, you need curly braces.</p>
<h3><a class="anchor" id="midi_md-midi-note-names"></a>
MIDI Note names</h3>
<p >For entering MIDI note numbers, you can use the note names in the <a class="el" href="../../d7/d78/namespaceMIDI__Notes.html">MIDI_Notes</a> namespace: </p><div class="fragment"><div class="line"><span class="comment">// MIDI Note middle C (C in the fourth octave) on MIDI Channel 16:</span></div>
<div class="line"><a class="code hl_class" href="../../d7/d0f/classMIDIAddress.html">MIDIAddress</a> myAddress = {<a class="code hl_variable" href="../../d7/d78/namespaceMIDI__Notes.html#adc612a1e4e057463777480eabc3fb0ca">MIDI_Notes::C</a>(4), <a class="code hl_variable" href="../../d7/d42/Channel_8hpp.html#a6531b6a78ab220e27918d0587f66db09">Channel_16</a>};</div>
<div class="ttc" id="aChannel_8hpp_html_a6531b6a78ab220e27918d0587f66db09"><div class="ttname"><a href="../../d7/d42/Channel_8hpp.html#a6531b6a78ab220e27918d0587f66db09">Channel_16</a></div><div class="ttdeci">constexpr Channel Channel_16</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/Channel_8hpp_source.html#l00133">Channel.hpp:133</a></div></div>
</div><!-- fragment --><p >For reasons explained <a class="el" href="../../da/dc1/FAQ.html#faq-midi-note-f">here</a>, the note F is an exception, you have to add a trailing underscore to avoid conflicts with Arduino's <code>F(...)</code> macro: </p><div class="fragment"><div class="line"><span class="comment">// MIDI Note F in the fourth octave on MIDI Channel 16:</span></div>
<div class="line"><a class="code hl_class" href="../../d7/d0f/classMIDIAddress.html">MIDIAddress</a> myAddress = {<a class="code hl_variable" href="../../d7/d78/namespaceMIDI__Notes.html#a14636a71c9387b851a68d9519b490b37">MIDI_Notes::F_</a>(4), <a class="code hl_variable" href="../../d7/d42/Channel_8hpp.html#a6531b6a78ab220e27918d0587f66db09">Channel_16</a>};</div>
<div class="line"><span class="comment">//          note the underscore here  ^</span></div>
<div class="ttc" id="anamespaceMIDI__Notes_html_a14636a71c9387b851a68d9519b490b37"><div class="ttname"><a href="../../d7/d78/namespaceMIDI__Notes.html#a14636a71c9387b851a68d9519b490b37">MIDI_Notes::F_</a></div><div class="ttdeci">constexpr Note F_</div><div class="ttdoc">F (Fa)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dc5/Notes_8hpp_source.html#l00045">Notes.hpp:45</a></div></div>
</div><!-- fragment --><p> If you look at the full list of note names in the <a class="el" href="../../d7/d78/namespaceMIDI__Notes.html">MIDI_Notes</a> namespace, you'll see that the sharps are missing: you can simply use the flats instead (e.g. instead of using G♯, you can use A♭).</p>
<h3><a class="anchor" id="midi_md-midi-control-change-names"></a>
MIDI Control Change names</h3>
<p >Instead of specifying the controller number (address) as a number, you can also use the predefined constants in the <a class="el" href="../../d4/dbe/namespaceMIDI__CC.html">MIDI_CC</a> namespace: </p><div class="fragment"><div class="line"><span class="comment">// Control Change General Purpose Controller #1 on MIDI Channel 2:</span></div>
<div class="line"><a class="code hl_class" href="../../d7/d0f/classMIDIAddress.html">MIDIAddress</a> myAddress = {<a class="code hl_variable" href="../../d4/dbe/namespaceMIDI__CC.html#a6eb9900d522be13f07efce201817046d">MIDI_CC::General_Purpose_Controller_1</a>, <a class="code hl_variable" href="../../d7/d42/Channel_8hpp.html#a6002e13e1e175446065a3eb90373fcfd">Channel_2</a>};</div>
<div class="ttc" id="anamespaceMIDI__CC_html_a6eb9900d522be13f07efce201817046d"><div class="ttname"><a href="../../d4/dbe/namespaceMIDI__CC.html#a6eb9900d522be13f07efce201817046d">MIDI_CC::General_Purpose_Controller_1</a></div><div class="ttdeci">constexpr uint8_t General_Purpose_Controller_1</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d43/Control__Change_8hpp_source.html#l00032">Control_Change.hpp:32</a></div></div>
</div><!-- fragment --><h3><a class="anchor" id="midi_md-midi-program-change-names"></a>
MIDI Program Change names</h3>
<p >Similar to the constants for controller numbers, you can find the constants for all General MIDI program numbers in the <a class="el" href="../../da/da6/namespaceMIDI__PC.html">MIDI_PC</a> namespace: </p><div class="fragment"><div class="line"><span class="comment">// Harpsichord voice on MIDI Channel 9.</span></div>
<div class="line"><a class="code hl_class" href="../../d7/d0f/classMIDIAddress.html">MIDIAddress</a> myAddress = {<a class="code hl_variable" href="../../da/da6/namespaceMIDI__PC.html#a585088b446e465a70d12c8db85e9ded4">MIDI_PC::Harpsichord</a>, <a class="code hl_variable" href="../../d7/d42/Channel_8hpp.html#a9b9740bab6ce97ab3f60896754d667c6">Channel_9</a>};</div>
<div class="ttc" id="aChannel_8hpp_html_a9b9740bab6ce97ab3f60896754d667c6"><div class="ttname"><a href="../../d7/d42/Channel_8hpp.html#a9b9740bab6ce97ab3f60896754d667c6">Channel_9</a></div><div class="ttdeci">constexpr Channel Channel_9</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d42/Channel_8hpp_source.html#l00126">Channel.hpp:126</a></div></div>
<div class="ttc" id="anamespaceMIDI__PC_html_a585088b446e465a70d12c8db85e9ded4"><div class="ttname"><a href="../../da/da6/namespaceMIDI__PC.html#a585088b446e465a70d12c8db85e9ded4">MIDI_PC::Harpsichord</a></div><div class="ttdeci">constexpr uint8_t Harpsichord</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/df3/Program__Change_8hpp_source.html#l00022">Program_Change.hpp:22</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="midi_md-sending-more-examples"></a>
More examples</h2>
<ul>
<li><a class="el" href="../../d8/d9b/MIDI-Output_8ino-example.html">MIDI-Output.ino</a></li>
<li><a class="el" href="../../d7/d8d/Send-MIDI-Notes_8ino-example.html">Send-MIDI-Notes.ino</a></li>
<li><a class="el" href="../../d5/d35/Send-All-MIDI-Messages_8ino-example.html">Send-All-MIDI-Messages.ino</a></li>
<li><a class="el" href="../../d2/d93/SysEx-Send-Receive_8ino-example.html">SysEx-Send-Receive.ino</a></li>
</ul>
<h1><a class="anchor" id="midi_md-receiving"></a>
Receiving MIDI messages</h1>
<p >MIDI input is usually handled using callback functions. Whenever the MIDI interface receives a MIDI message, it calls the respective callback function that was specified by the user.</p>
<p >You can either use a callback for each specific message type (Note On, Note Off, Control Change ...), or a callback for each category of messages (Channel messages, System Exclusive message, System Common messages, Real-Time messages).</p>
<p >A third way is to poll the MIDI input manually, but this is not covered in this guide.</p>
<h2><a class="anchor" id="midi_md-receiving-simple-example"></a>
Simple example</h2>
<p >The <a class="el" href="../../d3/d0d/classFineGrainedMIDI__Callbacks.html">FineGrainedMIDI_Callbacks</a> class allows you to associate a callback function with each specific MIDI message type. The contents of the MIDI message (such as the channel, note number, velocity, etc.) are passed to the callback as arguments. For example: </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../db/dbf/Control__Surface_8h.html">Control_Surface.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Instantiate a MIDI over USB interface</span></div>
<div class="line"><a class="code hl_class" href="../../de/d05/classUSBMIDI__Interface.html">USBMIDI_Interface</a> midi;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Custom MIDI callback that prints incoming MIDI note messages.</span></div>
<div class="line"><span class="keyword">struct </span>MyMIDI_Callbacks : <a class="code hl_class" href="../../d3/d0d/classFineGrainedMIDI__Callbacks.html">FineGrainedMIDI_Callbacks</a>&lt;MyMIDI_Callbacks&gt; {</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Function that is called whenever a MIDI Note Off message is received.</span></div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="../../d3/d0d/classFineGrainedMIDI__Callbacks.html#a7387943eaeb17e3083ecba28f5b03f09">onNoteOff</a>(<a class="code hl_class" href="../../d2/d48/classChannel.html">Channel</a> channel, uint8_t <a class="code hl_function" href="../../d7/d78/namespaceMIDI__Notes.html#a2e24f539c8d167db46ebd2ee6514ecec">note</a>, uint8_t velocity, <a class="code hl_class" href="../../d2/d75/classCable.html">Cable</a> cable) {</div>
<div class="line">        Serial &lt;&lt; <span class="stringliteral">&quot;Note Off: &quot;</span> &lt;&lt; channel &lt;&lt; <span class="stringliteral">&quot;, note &quot;</span> &lt;&lt; <a class="code hl_function" href="../../d7/d78/namespaceMIDI__Notes.html#a2e24f539c8d167db46ebd2ee6514ecec">note</a> &lt;&lt; <span class="stringliteral">&quot;, velocity &quot;</span></div>
<div class="line">               &lt;&lt; velocity &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; cable &lt;&lt; <a class="code hl_function" href="../../d8/d4b/group__AH__PrintStream.html#ga439f453f806df7d97e736ff0e7151344">endl</a>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Function that is called whenever a MIDI Note On message is received.</span></div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="../../d3/d0d/classFineGrainedMIDI__Callbacks.html#aa34fb352809bfaaf6754e11f267dc113">onNoteOn</a>(<a class="code hl_class" href="../../d2/d48/classChannel.html">Channel</a> channel, uint8_t <a class="code hl_function" href="../../d7/d78/namespaceMIDI__Notes.html#a2e24f539c8d167db46ebd2ee6514ecec">note</a>, uint8_t velocity, <a class="code hl_class" href="../../d2/d75/classCable.html">Cable</a> cable) {</div>
<div class="line">        Serial &lt;&lt; <span class="stringliteral">&quot;Note On: &quot;</span> &lt;&lt; channel &lt;&lt; <span class="stringliteral">&quot;, note &quot;</span> &lt;&lt; <a class="code hl_function" href="../../d7/d78/namespaceMIDI__Notes.html#a2e24f539c8d167db46ebd2ee6514ecec">note</a> &lt;&lt; <span class="stringliteral">&quot;, velocity &quot;</span></div>
<div class="line">               &lt;&lt; velocity &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; cable &lt;&lt; <a class="code hl_function" href="../../d8/d4b/group__AH__PrintStream.html#ga439f453f806df7d97e736ff0e7151344">endl</a>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">} callback; <span class="comment">// Instantiate a callback</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> setup() {</div>
<div class="line">    Serial.begin(115200);        <span class="comment">// For printing the messages</span></div>
<div class="line">    midi.<a class="code hl_function" href="../../dd/d0e/classGenericUSBMIDI__Interface.html#a7c3e14d99bd3dc0e3670d6956dafcaf2">begin</a>();                <span class="comment">// Initialize the MIDI interface</span></div>
<div class="line">    midi.<a class="code hl_function" href="../../d9/d73/classMIDI__Interface.html#ad38edab932c8860dfe3f907697d09e2b">setCallbacks</a>(callback); <span class="comment">// Attach the custom callback</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> loop() {</div>
<div class="line">    midi.<a class="code hl_function" href="../../dd/d0e/classGenericUSBMIDI__Interface.html#a44137bb65de2396875934e48a6ee5099">update</a>(); <span class="comment">// Continuously dispatch incoming MIDI input to the callbacks</span></div>
<div class="line">}</div>
<div class="ttc" id="aclassFineGrainedMIDI__Callbacks_html"><div class="ttname"><a href="../../d3/d0d/classFineGrainedMIDI__Callbacks.html">FineGrainedMIDI_Callbacks</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dde/MIDI__Callbacks_8hpp_source.html#l00034">MIDI_Callbacks.hpp:34</a></div></div>
<div class="ttc" id="aclassFineGrainedMIDI__Callbacks_html_a7387943eaeb17e3083ecba28f5b03f09"><div class="ttname"><a href="../../d3/d0d/classFineGrainedMIDI__Callbacks.html#a7387943eaeb17e3083ecba28f5b03f09">FineGrainedMIDI_Callbacks::onNoteOff</a></div><div class="ttdeci">void onNoteOff(Channel channel, uint8_t note, uint8_t velocity, Cable cable)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dde/MIDI__Callbacks_8hpp_source.html#l00234">MIDI_Callbacks.hpp:234</a></div></div>
<div class="ttc" id="aclassFineGrainedMIDI__Callbacks_html_aa34fb352809bfaaf6754e11f267dc113"><div class="ttname"><a href="../../d3/d0d/classFineGrainedMIDI__Callbacks.html#aa34fb352809bfaaf6754e11f267dc113">FineGrainedMIDI_Callbacks::onNoteOn</a></div><div class="ttdeci">void onNoteOn(Channel channel, uint8_t note, uint8_t velocity, Cable cable)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dde/MIDI__Callbacks_8hpp_source.html#l00235">MIDI_Callbacks.hpp:235</a></div></div>
<div class="ttc" id="aclassMIDI__Interface_html_ad38edab932c8860dfe3f907697d09e2b"><div class="ttname"><a href="../../d9/d73/classMIDI__Interface.html#ad38edab932c8860dfe3f907697d09e2b">MIDI_Interface::setCallbacks</a></div><div class="ttdeci">void setCallbacks(MIDI_Callbacks *cb)</div><div class="ttdoc">Set the callbacks that will be called when a MIDI message is received.</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d04/MIDI__Interface_8hpp_source.html#l00058">MIDI_Interface.hpp:58</a></div></div>
<div class="ttc" id="agroup__AH__PrintStream_html_ga439f453f806df7d97e736ff0e7151344"><div class="ttname"><a href="../../d8/d4b/group__AH__PrintStream.html#ga439f453f806df7d97e736ff0e7151344">AH::endl</a></div><div class="ttdeci">Print &amp; endl(Print &amp;printer)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d69/PrintStream_8cpp_source.html#l00027">PrintStream.cpp:27</a></div></div>
</div><!-- fragment --><p >The instantiation, initialization, and updating of the MIDI interface is the same as before. The first new component is the <code>MyMIDI_Callbacks</code> class: this class inherits from the <a class="el" href="../../d3/d0d/classFineGrainedMIDI__Callbacks.html">FineGrainedMIDI_Callbacks</a> class that is provided by the library, and implements two of the callback functions, <a class="el" href="../../d3/d0d/classFineGrainedMIDI__Callbacks.html#a7387943eaeb17e3083ecba28f5b03f09">FineGrainedMIDI_Callbacks::onNoteOff()</a> and <a class="el" href="../../d3/d0d/classFineGrainedMIDI__Callbacks.html#aa34fb352809bfaaf6754e11f267dc113">FineGrainedMIDI_Callbacks::onNoteOn()</a>. <br  />
 An instance of the <code>MyMIDI_Callbacks</code> class is created, and then this callback is attached to the MIDI interface in the <code>setup</code> function using <a class="el" href="../../d9/d73/classMIDI__Interface.html#ad38edab932c8860dfe3f907697d09e2b">MIDI_Interface::setCallbacks()</a>.</p>
<p >After the callback has been attached, every time you call <code>midi.update()</code> in the <code>loop</code>, the MIDI interface will check if any new messages have arrived, and if that's the case, it will call the corresponding callback function. For example, whenever a MIDI Note On message arrives, the <code>onNoteOn()</code> function of the callback object is called.</p>
<p >The example above is similar to the <a class="el" href="../../d4/d2b/MIDI-Input-Fine-Grained_8ino-example.html">MIDI-Input-Fine-Grained.ino</a> example. You can find the full list of available callbacks and their arguments in the documentation for <a class="el" href="../../d3/d0d/classFineGrainedMIDI__Callbacks.html">FineGrainedMIDI_Callbacks</a>, under <a class="el" href="../../d3/d0d/classFineGrainedMIDI__Callbacks.html#FineGrainedMIDI_Callbacks_MIDI_Callback_Functions">MIDI Callback Functions</a>, and in the <a class="el" href="../../da/d27/MIDI-Input-Fine-Grained-All-Callbacks_8ino-example.html">MIDI-Input-Fine-Grained-All-Callbacks.ino</a> example.</p>
<h2><a class="anchor" id="midi_md-receiving-customizable-callbacks"></a>
Customizable callbacks</h2>
<p >While the fine-grained callbacks can be useful to easily handle most incoming MIDI messages, sometimes you need more flexibility. It's not always desirable to have an individual callback for each message type. The <a class="el" href="../../de/d55/classMIDI__Callbacks.html">MIDI_Callbacks</a> class allows you to specify a callback for each category of MIDI messages: Channel messages, System Exclusive messages, System Common messages and Real-Time messages. For example:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../db/dbf/Control__Surface_8h.html">Control_Surface.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Instantiate a MIDI over USB interface</span></div>
<div class="line"><a class="code hl_class" href="../../de/d05/classUSBMIDI__Interface.html">USBMIDI_Interface</a> midi;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Custom MIDI callback that prints a simple message</span></div>
<div class="line"><span class="keyword">struct </span>MyMIDI_Callbacks : <a class="code hl_class" href="../../de/d55/classMIDI__Callbacks.html">MIDI_Callbacks</a> {</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Callback for channel messages (notes, control change, pitch bend, etc.).</span></div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="../../d3/d0d/classFineGrainedMIDI__Callbacks.html#a010d25a222c6d9c6f1931bed0c3a7bd0">onChannelMessage</a>(<a class="code hl_class" href="../../d9/d73/classMIDI__Interface.html">MIDI_Interface</a> &amp;, <a class="code hl_struct" href="../../d7/d3f/structChannelMessage.html">ChannelMessage</a>)<span class="keyword"> override </span>{</div>
<div class="line">        Serial.println(<span class="stringliteral">&quot;Channel message received&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">} callback; <span class="comment">// Instantiate a callback</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> setup() {</div>
<div class="line">    Serial.begin(115200);        <span class="comment">// For printing the messages</span></div>
<div class="line">    midi.<a class="code hl_function" href="../../dd/d0e/classGenericUSBMIDI__Interface.html#a7c3e14d99bd3dc0e3670d6956dafcaf2">begin</a>();                <span class="comment">// Initialize the MIDI interface</span></div>
<div class="line">    midi.<a class="code hl_function" href="../../d9/d73/classMIDI__Interface.html#ad38edab932c8860dfe3f907697d09e2b">setCallbacks</a>(callback); <span class="comment">// Attach the custom callback</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> loop() {</div>
<div class="line">    midi.<a class="code hl_function" href="../../dd/d0e/classGenericUSBMIDI__Interface.html#a44137bb65de2396875934e48a6ee5099">update</a>(); <span class="comment">// Continuously dispatch incoming MIDI input to the callbacks</span></div>
<div class="line">}</div>
<div class="ttc" id="aclassFineGrainedMIDI__Callbacks_html_a010d25a222c6d9c6f1931bed0c3a7bd0"><div class="ttname"><a href="../../d3/d0d/classFineGrainedMIDI__Callbacks.html#a010d25a222c6d9c6f1931bed0c3a7bd0">FineGrainedMIDI_Callbacks::onChannelMessage</a></div><div class="ttdeci">void onChannelMessage(MIDI_Interface &amp;, ChannelMessage msg) override</div><div class="ttdoc">Callback for incoming MIDI Channel Messages (notes, control change, pitch bend, etc....</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dde/MIDI__Callbacks_8hpp_source.html#l00061">MIDI_Callbacks.hpp:61</a></div></div>
<div class="ttc" id="aclassMIDI__Callbacks_html"><div class="ttname"><a href="../../de/d55/classMIDI__Callbacks.html">MIDI_Callbacks</a></div><div class="ttdoc">A class for callbacks from MIDI input.</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dde/MIDI__Callbacks_8hpp_source.html#l00015">MIDI_Callbacks.hpp:15</a></div></div>
<div class="ttc" id="aclassMIDI__Interface_html"><div class="ttname"><a href="../../d9/d73/classMIDI__Interface.html">MIDI_Interface</a></div><div class="ttdoc">An abstract class for MIDI interfaces.</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d04/MIDI__Interface_8hpp_source.html#l00020">MIDI_Interface.hpp:23</a></div></div>
<div class="ttc" id="astructChannelMessage_html"><div class="ttname"><a href="../../d7/d3f/structChannelMessage.html">ChannelMessage</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d40/MIDI__MessageTypes_8hpp_source.html#l00175">MIDI_MessageTypes.hpp:175</a></div></div>
</div><!-- fragment --><p >The first argument of the callback function is a reference to the MIDI interface that received the message (this is not used in this simple example), and the second argument is the message itself.</p>
<h2><a class="anchor" id="midi_md-accessing-the-contents-of-the-message"></a>
Accessing the contents of the message</h2>
<p >The previous example simply printed “Channel message received” whenever it received a channel message. This is not really that useful, so in this section we'll improve upon it by inspecting the contents of the messages and extracting the different components such as the channel, note number, velocity, and so on.</p>
<p >Have a look at the documentation for <a class="el" href="../../d7/d3f/structChannelMessage.html">ChannelMessage</a>. You'll notice that the message contains four fields: <code>header</code>, <code>data1</code>, <code>data2</code> and <code>cable</code>. These correspond to the contents of channel messages as specified by the MIDI standard. Apart from these fields, there are also many utility functions to access different parts of the message, such as <code>getMessageType()</code> which will tell you what type of message it is (e.g. Note On, Note Off, Control Change), <code>getChannel()</code> which extracts the MIDI channel number from the header, <code>hasTwoDataBytes()</code> which tells you whether the message contains two data bytes (such as Note and Control Change messages) or just a single data byte (such as Program Change).</p>
<p >The following callback example simply checks how many bytes the message has, and then prints the contents to the serial port in hexadecimal.</p>
<div class="fragment"><div class="line"><span class="comment">// Custom MIDI callback that prints incoming MIDI channel messages.</span></div>
<div class="line"><span class="keyword">struct </span>MyMIDI_Callbacks : <a class="code hl_class" href="../../de/d55/classMIDI__Callbacks.html">MIDI_Callbacks</a> {</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Callback for channel messages (notes, control change, pitch bend, etc.).</span></div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="../../d3/d0d/classFineGrainedMIDI__Callbacks.html#a010d25a222c6d9c6f1931bed0c3a7bd0">onChannelMessage</a>(<a class="code hl_class" href="../../d9/d73/classMIDI__Interface.html">MIDI_Interface</a> &amp;, <a class="code hl_struct" href="../../d7/d3f/structChannelMessage.html">ChannelMessage</a> msg)<span class="keyword"> override </span>{</div>
<div class="line">        <span class="comment">// Print the message</span></div>
<div class="line">        Serial &lt;&lt; F(<span class="stringliteral">&quot;Received: &quot;</span>) &lt;&lt; <a class="code hl_function" href="../../d8/d4b/group__AH__PrintStream.html#ga173884f5f11dfa9d228c36522d207e28">hex</a> &lt;&lt; msg.<a class="code hl_variable" href="../../d4/d61/structMIDIMessage.html#a3707517cb22eb26bf33bbb859fb010d2">header</a> &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; msg.<a class="code hl_variable" href="../../d4/d61/structMIDIMessage.html#a834ae4387b1eb95fa926d466f254e468">data1</a>;</div>
<div class="line">        <span class="keywordflow">if</span> (msg.<a class="code hl_function" href="../../d7/d3f/structChannelMessage.html#afd23dd74db590cb5061ccc90da4d2291">hasTwoDataBytes</a>()) </div>
<div class="line">            Serial &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; msg.<a class="code hl_variable" href="../../d4/d61/structMIDIMessage.html#a147e14d13d9459cedff4ee049f231abf">data2</a>;</div>
<div class="line">        Serial &lt;&lt; <a class="code hl_function" href="../../d8/d4b/group__AH__PrintStream.html#gabe27efcfa5b971f354c562b1fdf14db9">dec</a> &lt;&lt; <a class="code hl_function" href="../../d8/d4b/group__AH__PrintStream.html#ga439f453f806df7d97e736ff0e7151344">endl</a>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">} callback; <span class="comment">// Instantiate a callback</span></div>
<div class="ttc" id="agroup__AH__PrintStream_html_ga173884f5f11dfa9d228c36522d207e28"><div class="ttname"><a href="../../d8/d4b/group__AH__PrintStream.html#ga173884f5f11dfa9d228c36522d207e28">AH::hex</a></div><div class="ttdeci">Print &amp; hex(Print &amp;printer)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d69/PrintStream_8cpp_source.html#l00062">PrintStream.cpp:62</a></div></div>
<div class="ttc" id="agroup__AH__PrintStream_html_gabe27efcfa5b971f354c562b1fdf14db9"><div class="ttname"><a href="../../d8/d4b/group__AH__PrintStream.html#gabe27efcfa5b971f354c562b1fdf14db9">AH::dec</a></div><div class="ttdeci">Print &amp; dec(Print &amp;printer)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d69/PrintStream_8cpp_source.html#l00077">PrintStream.cpp:77</a></div></div>
<div class="ttc" id="astructChannelMessage_html_afd23dd74db590cb5061ccc90da4d2291"><div class="ttname"><a href="../../d7/d3f/structChannelMessage.html#afd23dd74db590cb5061ccc90da4d2291">ChannelMessage::hasTwoDataBytes</a></div><div class="ttdeci">bool hasTwoDataBytes() const</div><div class="ttdoc">Check whether this message has one or two data bytes.</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d40/MIDI__MessageTypes_8hpp_source.html#l00218">MIDI_MessageTypes.hpp:218</a></div></div>
<div class="ttc" id="astructMIDIMessage_html_a147e14d13d9459cedff4ee049f231abf"><div class="ttname"><a href="../../d4/d61/structMIDIMessage.html#a147e14d13d9459cedff4ee049f231abf">MIDIMessage::data2</a></div><div class="ttdeci">uint8_t data2</div><div class="ttdoc">First MIDI data byte.</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d40/MIDI__MessageTypes_8hpp_source.html#l00098">MIDI_MessageTypes.hpp:98</a></div></div>
<div class="ttc" id="astructMIDIMessage_html_a3707517cb22eb26bf33bbb859fb010d2"><div class="ttname"><a href="../../d4/d61/structMIDIMessage.html#a3707517cb22eb26bf33bbb859fb010d2">MIDIMessage::header</a></div><div class="ttdeci">uint8_t header</div><div class="ttdoc">MIDI status byte (message type and channel).</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d40/MIDI__MessageTypes_8hpp_source.html#l00096">MIDI_MessageTypes.hpp:96</a></div></div>
<div class="ttc" id="astructMIDIMessage_html_a834ae4387b1eb95fa926d466f254e468"><div class="ttname"><a href="../../d4/d61/structMIDIMessage.html#a834ae4387b1eb95fa926d466f254e468">MIDIMessage::data1</a></div><div class="ttdeci">uint8_t data1</div><div class="ttdoc">First MIDI data byte.</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d40/MIDI__MessageTypes_8hpp_source.html#l00097">MIDI_MessageTypes.hpp:97</a></div></div>
</div><!-- fragment --><p >If you send a Note On message on MIDI Channel 4 for note number 60 = 0x3C (middle C) with a velocity of 127 = 0x7F to the Arduino, you should see the following in the Serial monitor: </p><div class="fragment"><div class="line">Received: 93 3c 7f</div>
</div><!-- fragment --><h2><a class="anchor" id="midi_md-listening-for-specific-messages"></a>
Listening for specific messages</h2>
<p >In the following example, we'll create a callback that listens for MIDI Note On and Note Off messages specifically.</p>
<div class="fragment"><div class="line"><span class="comment">// Custom MIDI callback that prints incoming MIDI note messages.</span></div>
<div class="line"><span class="keyword">struct </span>MyMIDI_Callbacks : <a class="code hl_class" href="../../de/d55/classMIDI__Callbacks.html">MIDI_Callbacks</a> {</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Callback for channel messages (notes, control change, pitch bend, etc.).</span></div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="../../d3/d0d/classFineGrainedMIDI__Callbacks.html#a010d25a222c6d9c6f1931bed0c3a7bd0">onChannelMessage</a>(<a class="code hl_class" href="../../d9/d73/classMIDI__Interface.html">MIDI_Interface</a> &amp;, <a class="code hl_struct" href="../../d7/d3f/structChannelMessage.html">ChannelMessage</a> msg)<span class="keyword"> override </span>{</div>
<div class="line">        <span class="keyword">auto</span> type = msg.<a class="code hl_function" href="../../d7/d3f/structChannelMessage.html#a95534104458cd91231457447faeaee1e">getMessageType</a>();</div>
<div class="line">        <span class="keywordflow">if</span> (type == msg.<a class="code hl_variable" href="../../d7/d3f/structChannelMessage.html#a8b24d6949e37c0be586db51d6f9fb501">NOTE_ON</a> || type == msg.<a class="code hl_variable" href="../../d7/d3f/structChannelMessage.html#ae7903965cca03ac0c6447854bf3da3a9">NOTE_OFF</a>)</div>
<div class="line">            onNoteMessage(msg);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Our own callback specifically for Note On and Note Off messages</span></div>
<div class="line">    <span class="keywordtype">void</span> onNoteMessage(<a class="code hl_struct" href="../../d7/d3f/structChannelMessage.html">ChannelMessage</a> msg) {</div>
<div class="line">        <span class="keyword">auto</span> type     = msg.<a class="code hl_function" href="../../d7/d3f/structChannelMessage.html#a95534104458cd91231457447faeaee1e">getMessageType</a>(); </div>
<div class="line">        <span class="keyword">auto</span> channel  = msg.<a class="code hl_function" href="../../d7/d3f/structChannelMessage.html#aa7e3dc9ba1b6a1277d4686ad1b976ce5">getChannel</a>();</div>
<div class="line">        <span class="keyword">auto</span> <a class="code hl_function" href="../../d7/d78/namespaceMIDI__Notes.html#a2e24f539c8d167db46ebd2ee6514ecec">note</a>     = msg.<a class="code hl_function" href="../../d4/d61/structMIDIMessage.html#a7b9f6fa0ca19427d315fa1151952f88f">getData1</a>();</div>
<div class="line">        <span class="keyword">auto</span> velocity = msg.<a class="code hl_function" href="../../d4/d61/structMIDIMessage.html#ac2d3511e2bca554658e218e5b321e33e">getData2</a>();</div>
<div class="line">        Serial &lt;&lt; type &lt;&lt; <span class="stringliteral">&quot;: &quot;</span></div>
<div class="line">               &lt;&lt; channel &lt;&lt; <span class="stringliteral">&quot;, Note &quot;</span> &lt;&lt; <a class="code hl_function" href="../../d7/d78/namespaceMIDI__Notes.html#a2e24f539c8d167db46ebd2ee6514ecec">note</a> &lt;&lt; <span class="stringliteral">&quot;, Velocity &quot;</span> &lt;&lt; velocity </div>
<div class="line">               &lt;&lt; <a class="code hl_function" href="../../d8/d4b/group__AH__PrintStream.html#ga439f453f806df7d97e736ff0e7151344">endl</a>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">} callback; <span class="comment">// Instantiate a callback</span></div>
<div class="ttc" id="astructChannelMessage_html_a8b24d6949e37c0be586db51d6f9fb501"><div class="ttname"><a href="../../d7/d3f/structChannelMessage.html#a8b24d6949e37c0be586db51d6f9fb501">ChannelMessage::NOTE_ON</a></div><div class="ttdeci">static constexpr auto NOTE_ON</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d40/MIDI__MessageTypes_8hpp_source.html#l00225">MIDI_MessageTypes.hpp:225</a></div></div>
<div class="ttc" id="astructChannelMessage_html_a95534104458cd91231457447faeaee1e"><div class="ttname"><a href="../../d7/d3f/structChannelMessage.html#a95534104458cd91231457447faeaee1e">ChannelMessage::getMessageType</a></div><div class="ttdeci">MIDIMessageType getMessageType() const</div><div class="ttdoc">Get the MIDI message type.</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d40/MIDI__MessageTypes_8hpp_source.html#l00186">MIDI_MessageTypes.hpp:186</a></div></div>
<div class="ttc" id="astructChannelMessage_html_aa7e3dc9ba1b6a1277d4686ad1b976ce5"><div class="ttname"><a href="../../d7/d3f/structChannelMessage.html#aa7e3dc9ba1b6a1277d4686ad1b976ce5">ChannelMessage::getChannel</a></div><div class="ttdeci">Channel getChannel() const</div><div class="ttdoc">Get the MIDI channel of the message.</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d40/MIDI__MessageTypes_8hpp_source.html#l00196">MIDI_MessageTypes.hpp:196</a></div></div>
<div class="ttc" id="astructChannelMessage_html_ae7903965cca03ac0c6447854bf3da3a9"><div class="ttname"><a href="../../d7/d3f/structChannelMessage.html#ae7903965cca03ac0c6447854bf3da3a9">ChannelMessage::NOTE_OFF</a></div><div class="ttdeci">static constexpr auto NOTE_OFF</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d40/MIDI__MessageTypes_8hpp_source.html#l00224">MIDI_MessageTypes.hpp:224</a></div></div>
<div class="ttc" id="astructMIDIMessage_html_a7b9f6fa0ca19427d315fa1151952f88f"><div class="ttname"><a href="../../d4/d61/structMIDIMessage.html#a7b9f6fa0ca19427d315fa1151952f88f">MIDIMessage::getData1</a></div><div class="ttdeci">uint8_t getData1() const</div><div class="ttdoc">Get the first data byte.</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d40/MIDI__MessageTypes_8hpp_source.html#l00126">MIDI_MessageTypes.hpp:126</a></div></div>
<div class="ttc" id="astructMIDIMessage_html_ac2d3511e2bca554658e218e5b321e33e"><div class="ttname"><a href="../../d4/d61/structMIDIMessage.html#ac2d3511e2bca554658e218e5b321e33e">MIDIMessage::getData2</a></div><div class="ttdeci">uint8_t getData2() const</div><div class="ttdoc">Get the second data byte.</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d40/MIDI__MessageTypes_8hpp_source.html#l00128">MIDI_MessageTypes.hpp:128</a></div></div>
</div><!-- fragment --><p >If you send MIDI note messages to the Arduino, you should see output like this in the Serial monitor: </p><div class="fragment"><div class="line">NOTE_ON: Channel 1, Note 18, Velocity 112</div>
<div class="line">NOTE_OFF: Channel 1, Note 18, Velocity 127</div>
</div><!-- fragment --><p >You can go even further, for example, matching only a specific note on a specific MIDI channel: </p><div class="fragment"><div class="line"><span class="comment">// Custom MIDI callback that prints incoming MIDI note messages.</span></div>
<div class="line"><span class="keyword">struct </span>MyMIDI_Callbacks : <a class="code hl_class" href="../../de/d55/classMIDI__Callbacks.html">MIDI_Callbacks</a> {</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Callback for channel messages (notes, control change, pitch bend, etc.).</span></div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="../../d3/d0d/classFineGrainedMIDI__Callbacks.html#a010d25a222c6d9c6f1931bed0c3a7bd0">onChannelMessage</a>(<a class="code hl_class" href="../../d9/d73/classMIDI__Interface.html">MIDI_Interface</a> &amp;, <a class="code hl_struct" href="../../d7/d3f/structChannelMessage.html">ChannelMessage</a> msg)<span class="keyword"> override </span>{</div>
<div class="line">        <span class="keyword">auto</span> type     = msg.<a class="code hl_function" href="../../d7/d3f/structChannelMessage.html#a95534104458cd91231457447faeaee1e">getMessageType</a>(); </div>
<div class="line">        <span class="keyword">auto</span> channel  = msg.<a class="code hl_function" href="../../d7/d3f/structChannelMessage.html#aa7e3dc9ba1b6a1277d4686ad1b976ce5">getChannel</a>();</div>
<div class="line">        <span class="keyword">auto</span> <a class="code hl_function" href="../../d7/d78/namespaceMIDI__Notes.html#a2e24f539c8d167db46ebd2ee6514ecec">note</a>     = msg.<a class="code hl_function" href="../../d4/d61/structMIDIMessage.html#a7b9f6fa0ca19427d315fa1151952f88f">getData1</a>();</div>
<div class="line">        <span class="keyword">auto</span> velocity = msg.<a class="code hl_function" href="../../d4/d61/structMIDIMessage.html#ac2d3511e2bca554658e218e5b321e33e">getData2</a>();</div>
<div class="line">        <span class="comment">// Check if it&#39;s a note message:</span></div>
<div class="line">        <span class="keywordtype">bool</span> note_msg = type == msg.<a class="code hl_variable" href="../../d7/d3f/structChannelMessage.html#a8b24d6949e37c0be586db51d6f9fb501">NOTE_ON</a> || type == msg.<a class="code hl_variable" href="../../d7/d3f/structChannelMessage.html#ae7903965cca03ac0c6447854bf3da3a9">NOTE_OFF</a>;</div>
<div class="line">        <span class="comment">// Check if it&#39;s the specific note and channel we&#39;re looking for</span></div>
<div class="line">        <span class="keywordtype">bool</span> our_note = channel == <a class="code hl_variable" href="../../d7/d42/Channel_8hpp.html#a40d189f24e13a7304f2c9094038588ae">Channel_1</a> &amp;&amp; <a class="code hl_function" href="../../d7/d78/namespaceMIDI__Notes.html#a2e24f539c8d167db46ebd2ee6514ecec">note</a> == <a class="code hl_variable" href="../../d7/d78/namespaceMIDI__Notes.html#adc612a1e4e057463777480eabc3fb0ca">MIDI_Notes::C</a>(4);</div>
<div class="line">        <span class="comment">// If both conditions are satisfies, print the message</span></div>
<div class="line">        <span class="keywordflow">if</span> (note_msg &amp;&amp; our_note)</div>
<div class="line">            Serial &lt;&lt; type &lt;&lt; <span class="stringliteral">&quot; middle C on Channel 1 with velocity &quot;</span></div>
<div class="line">                   &lt;&lt; velocity &lt;&lt; <a class="code hl_function" href="../../d8/d4b/group__AH__PrintStream.html#ga439f453f806df7d97e736ff0e7151344">endl</a>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">} callback; <span class="comment">// Instantiate a callback</span></div>
</div><!-- fragment --><p> The snippet above only prints output if it receives a Note On/Off event for middle C on MIDI channel 1. All other incoming MIDI messages are ignored. Possible output in the Serial monitor could be: </p><div class="fragment"><div class="line">NOTE_ON middle C with velocity 120</div>
<div class="line">NOTE_OFF middle C with velocity 127</div>
</div><!-- fragment --><p >The previous example can be simplified by using the <code><a class="el" href="../../d7/d0f/classMIDIAddress.html" title="A type-safe utility class for saving a MIDI address consisting of a 7-bit address,...">MIDIAddress</a></code> type like in the previous section, and extracting the address from the incoming note message using the <a class="el" href="../../d7/d3f/structChannelMessage.html#a9046dc3d1e9082fbcf2ed48be187a3da">ChannelMessage::getAddress()</a> function: </p><div class="fragment"><div class="line"><span class="comment">// Custom MIDI callback that prints incoming MIDI note messages.</span></div>
<div class="line"><span class="keyword">struct </span>MyMIDI_Callbacks : <a class="code hl_class" href="../../de/d55/classMIDI__Callbacks.html">MIDI_Callbacks</a> {</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Callback for channel messages (notes, control change, pitch bend, etc.).</span></div>
<div class="line">    <span class="keywordtype">void</span> <a class="code hl_function" href="../../d3/d0d/classFineGrainedMIDI__Callbacks.html#a010d25a222c6d9c6f1931bed0c3a7bd0">onChannelMessage</a>(<a class="code hl_class" href="../../d9/d73/classMIDI__Interface.html">MIDI_Interface</a> &amp;, <a class="code hl_struct" href="../../d7/d3f/structChannelMessage.html">ChannelMessage</a> msg)<span class="keyword"> override </span>{</div>
<div class="line">        <span class="keyword">auto</span> type     = msg.<a class="code hl_function" href="../../d7/d3f/structChannelMessage.html#a95534104458cd91231457447faeaee1e">getMessageType</a>(); </div>
<div class="line">        <span class="keyword">auto</span> velocity = msg.<a class="code hl_function" href="../../d4/d61/structMIDIMessage.html#ac2d3511e2bca554658e218e5b321e33e">getData2</a>();</div>
<div class="line">        <span class="comment">// Check if it&#39;s a note message:</span></div>
<div class="line">        <span class="keywordtype">bool</span> note_msg = type == msg.<a class="code hl_variable" href="../../d7/d3f/structChannelMessage.html#a8b24d6949e37c0be586db51d6f9fb501">NOTE_ON</a> || type == msg.<a class="code hl_variable" href="../../d7/d3f/structChannelMessage.html#ae7903965cca03ac0c6447854bf3da3a9">NOTE_OFF</a>;</div>
<div class="line">        <span class="comment">// Define the address we&#39;re interested in</span></div>
<div class="line">        <span class="keyword">const</span> <a class="code hl_class" href="../../d7/d0f/classMIDIAddress.html">MIDIAddress</a> our_special_note = {<a class="code hl_variable" href="../../d7/d78/namespaceMIDI__Notes.html#adc612a1e4e057463777480eabc3fb0ca">MIDI_Notes::C</a>(4), <a class="code hl_variable" href="../../d7/d42/Channel_8hpp.html#a40d189f24e13a7304f2c9094038588ae">Channel_1</a>};</div>
<div class="line">        <span class="comment">// If it&#39;s a note message that matches our specific address, print it</span></div>
<div class="line">        <span class="keywordflow">if</span> (note_msg &amp;&amp; msg.<a class="code hl_function" href="../../d7/d3f/structChannelMessage.html#a9046dc3d1e9082fbcf2ed48be187a3da">getAddress</a>() == our_special_note)</div>
<div class="line">            Serial &lt;&lt; type &lt;&lt; <span class="stringliteral">&quot; middle C on Channel 1 with velocity &quot;</span></div>
<div class="line">                   &lt;&lt; velocity &lt;&lt; <a class="code hl_function" href="../../d8/d4b/group__AH__PrintStream.html#ga439f453f806df7d97e736ff0e7151344">endl</a>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">} callback; <span class="comment">// Instantiate a callback</span></div>
<div class="ttc" id="astructChannelMessage_html_a9046dc3d1e9082fbcf2ed48be187a3da"><div class="ttname"><a href="../../d7/d3f/structChannelMessage.html#a9046dc3d1e9082fbcf2ed48be187a3da">ChannelMessage::getAddress</a></div><div class="ttdeci">MIDIAddress getAddress() const</div><div class="ttdoc">Get the MIDI address of this message, using data1 as the address.</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d40/MIDI__MessageTypes_8hpp_source.html#l00210">MIDI_MessageTypes.hpp:210</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="midi_md-receiving-more-examples"></a>
More examples</h2>
<ul>
<li><a class="el" href="../../d1/d5d/MIDI-Input_8ino-example.html">MIDI-Input.ino</a></li>
<li><a class="el" href="../../d4/d2b/MIDI-Input-Fine-Grained_8ino-example.html">MIDI-Input-Fine-Grained.ino</a></li>
<li><a class="el" href="../../da/d27/MIDI-Input-Fine-Grained-All-Callbacks_8ino-example.html">MIDI-Input-Fine-Grained-All-Callbacks.ino</a></li>
<li><a class="el" href="../../d2/d93/SysEx-Send-Receive_8ino-example.html">SysEx-Send-Receive.ino</a></li>
</ul>
<h1><a class="anchor" id="midi_md-routing"></a>
Routing MIDI messages</h1>
<h2><a class="anchor" id="midi_md-default-routing"></a>
Default routing</h2>
<p >Let's start with a very simple example:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../db/dbf/Control__Surface_8h.html">Control_Surface.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Instantiate a MIDI over USB interface with the name `midi_usb`</span></div>
<div class="line"><a class="code hl_class" href="../../de/d05/classUSBMIDI__Interface.html">USBMIDI_Interface</a> midi_usb;</div>
<div class="line"> </div>
<div class="line"><a class="code hl_class" href="../../d1/d9f/classNoteButton.html">NoteButton</a> button {2, <a class="code hl_variable" href="../../d7/d78/namespaceMIDI__Notes.html#adc612a1e4e057463777480eabc3fb0ca">MIDI_Notes::C</a>(4)};</div>
<div class="line"><a class="code hl_class" href="../../d9/d55/classNoteCCKPLED.html">NoteLED</a> led {13, <a class="code hl_variable" href="../../d7/d78/namespaceMIDI__Notes.html#adc612a1e4e057463777480eabc3fb0ca">MIDI_Notes::C</a>(4)};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> setup() {</div>
<div class="line">    <span class="comment">// Initialize everything, including MIDI interfaces and default routes</span></div>
<div class="line">    <a class="code hl_variable" href="../../d9/d38/Control__Surface__Class_8cpp.html#af7a5d250297d82b2b29605dd7ac250df">Control_Surface</a>.<a class="code hl_function" href="../../dc/d45/classControl__Surface__.html#ab0bdf5cca484fb2ba637c39384b27fb2">begin</a>(); </div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> loop() {</div>
<div class="line">    <a class="code hl_variable" href="../../d9/d38/Control__Surface__Class_8cpp.html#af7a5d250297d82b2b29605dd7ac250df">Control_Surface</a>.<a class="code hl_function" href="../../dc/d45/classControl__Surface__.html#afe461d27b9c48d5921c00d521181f12f">loop</a>();</div>
<div class="line">}</div>
<div class="ttc" id="aControl__Surface__Class_8cpp_html_af7a5d250297d82b2b29605dd7ac250df"><div class="ttname"><a href="../../d9/d38/Control__Surface__Class_8cpp.html#af7a5d250297d82b2b29605dd7ac250df">Control_Surface</a></div><div class="ttdeci">Control_Surface_ &amp; Control_Surface</div><div class="ttdoc">A predefined instance of the Control Surface to use in the Arduino sketches.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d38/Control__Surface__Class_8cpp_source.html#l00338">Control_Surface_Class.cpp:338</a></div></div>
<div class="ttc" id="aclassControl__Surface___html_ab0bdf5cca484fb2ba637c39384b27fb2"><div class="ttname"><a href="../../dc/d45/classControl__Surface__.html#ab0bdf5cca484fb2ba637c39384b27fb2">Control_Surface_::begin</a></div><div class="ttdeci">void begin()</div><div class="ttdoc">Initialize the Control_Surface.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d38/Control__Surface__Class_8cpp_source.html#l00022">Control_Surface_Class.cpp:22</a></div></div>
<div class="ttc" id="aclassControl__Surface___html_afe461d27b9c48d5921c00d521181f12f"><div class="ttname"><a href="../../dc/d45/classControl__Surface__.html#afe461d27b9c48d5921c00d521181f12f">Control_Surface_::loop</a></div><div class="ttdeci">void loop()</div><div class="ttdoc">Update all MIDI elements, send MIDI events and read MIDI input.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d38/Control__Surface__Class_8cpp_source.html#l00071">Control_Surface_Class.cpp:71</a></div></div>
<div class="ttc" id="aclassNoteButton_html"><div class="ttname"><a href="../../d1/d9f/classNoteButton.html">NoteButton</a></div><div class="ttdoc">A class of MIDIOutputElements that read the input of a momentary push button or switch,...</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d80/NoteButton_8hpp_source.html#l00019">NoteButton.hpp:19</a></div></div>
<div class="ttc" id="aclassNoteCCKPLED_html"><div class="ttname"><a href="../../d9/d55/classNoteCCKPLED.html">NoteCCKPLED</a></div><div class="ttdoc">Generic base class for classes that listen for MIDI Note, Control Change and Key Pressure events on a...</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/df7/NoteCCKPLED_8hpp_source.html#l00020">NoteCCKPLED.hpp:20</a></div></div>
</div><!-- fragment --><p> When you call <code>Control_Surface.begin()</code>, it will automatically create a default route for you, which is shown in the following figure.</p>
<p ><img src="../../midi-pipes-default.svg" alt="" style="pointer-events: none; margin: 0 auto; display: block; width: 38em" class="inline"/></p>
<p >Two pipes are created, one for MIDI output (<code>pipe_tx</code> in the figure), and one for MIDI input (<code>pipe_rx</code>). These pipes are used to connect the <code>Control_Surface</code> part of the code to the MIDI interface defined on line 4 (<code>midi_usb</code>).</p>
<p >In the main loop of the program, <code>Control_Surface</code> checks if the button was pressed, and if that's the case, a MIDI message is sent by <code>Control_Surface</code>: The message travels over the MIDI output pipe (<code>pipe_tx</code>) to the MIDI interface (<code>midi_usb</code>), which will then send it to the computer over the USB connection.</p>
<p >Similarly, when a MIDI message from the computer arrives on the USB connection, the MIDI interface (<code>midi_usb</code>) will send it over the MIDI input pipe (<code>pipe_rx</code>) to the <code>Control_Surface</code> code, which will then check whether it's a MIDI Note On/Off message that matches the address of the LED, and turn on/off the LED accordingly.</p>
<h2><a class="anchor" id="midi_md-manual-routing"></a>
Manual routing</h2>
<p >As a first exercise, we'll define the same pipes and routing ourselves, without relying on <code>Control_Surface.begin()</code> to do it automagically.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../db/dbf/Control__Surface_8h.html">Control_Surface.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Instantiate a MIDI over USB interface</span></div>
<div class="line"><a class="code hl_class" href="../../de/d05/classUSBMIDI__Interface.html">USBMIDI_Interface</a> midi_usb;</div>
<div class="line"><span class="comment">// Instantiate the two pipes to connect the interface to Control_Surface</span></div>
<div class="line"><a class="code hl_class" href="../../df/d72/classMIDI__Pipe.html">MIDI_Pipe</a> pipe_tx, pipe_rx;</div>
<div class="line"> </div>
<div class="line"><a class="code hl_class" href="../../d1/d9f/classNoteButton.html">NoteButton</a> button {2, <a class="code hl_variable" href="../../d7/d78/namespaceMIDI__Notes.html#adc612a1e4e057463777480eabc3fb0ca">MIDI_Notes::C</a>(4)};</div>
<div class="line"><a class="code hl_class" href="../../d9/d55/classNoteCCKPLED.html">NoteLED</a> led {13, <a class="code hl_variable" href="../../d7/d78/namespaceMIDI__Notes.html#adc612a1e4e057463777480eabc3fb0ca">MIDI_Notes::C</a>(4)};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> setup() {</div>
<div class="line">    <span class="comment">// Manually route MIDI output from Control_Surface to the MIDI interface</span></div>
<div class="line">    <a class="code hl_variable" href="../../d9/d38/Control__Surface__Class_8cpp.html#af7a5d250297d82b2b29605dd7ac250df">Control_Surface</a> &gt;&gt; pipe_tx &gt;&gt; midi_usb;</div>
<div class="line">    <span class="comment">// Manually route MIDI output from the MIDI interface to Control_Surface</span></div>
<div class="line">    <a class="code hl_variable" href="../../d9/d38/Control__Surface__Class_8cpp.html#af7a5d250297d82b2b29605dd7ac250df">Control_Surface</a> &lt;&lt; pipe_rx &lt;&lt; midi_usb;</div>
<div class="line">    <span class="comment">// Initialize everything</span></div>
<div class="line">    <a class="code hl_variable" href="../../d9/d38/Control__Surface__Class_8cpp.html#af7a5d250297d82b2b29605dd7ac250df">Control_Surface</a>.<a class="code hl_function" href="../../dc/d45/classControl__Surface__.html#ab0bdf5cca484fb2ba637c39384b27fb2">begin</a>();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> loop() {</div>
<div class="line">    <a class="code hl_variable" href="../../d9/d38/Control__Surface__Class_8cpp.html#af7a5d250297d82b2b29605dd7ac250df">Control_Surface</a>.<a class="code hl_function" href="../../dc/d45/classControl__Surface__.html#afe461d27b9c48d5921c00d521181f12f">loop</a>();</div>
<div class="line">}</div>
<div class="ttc" id="aclassMIDI__Pipe_html"><div class="ttname"><a href="../../df/d72/classMIDI__Pipe.html">MIDI_Pipe</a></div><div class="ttdoc">Class that routes MIDI messages from a MIDI_Source to a MIDI_Sink.</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/ddf/MIDI__Pipes_8hpp_source.html#l00329">MIDI_Pipes.hpp:329</a></div></div>
</div><!-- fragment --><p> As you can see, the shift operators <code>&gt;&gt;</code> and <code>&lt;&lt;</code> are used to define the routes between Control Surface and the MIDI interface. Note how they correspond to the arrows in the figure above.</p>
<p >You can specify the two endpoints in any order you like (left-to-right or right-to-left). For example, the following two lines of code are equivalent and define the same connection: </p><div class="fragment"><div class="line"><a class="code hl_variable" href="../../d9/d38/Control__Surface__Class_8cpp.html#af7a5d250297d82b2b29605dd7ac250df">Control_Surface</a> &lt;&lt; pipe_rx &lt;&lt; midi_usb;</div>
<div class="line">midi_usb &gt;&gt; pipe_rx &gt;&gt; <a class="code hl_variable" href="../../d9/d38/Control__Surface__Class_8cpp.html#af7a5d250297d82b2b29605dd7ac250df">Control_Surface</a>;</div>
</div><!-- fragment --><p >It is important to specify the routing <em>before</em> you call <code>Control_Surface.begin()</code>. In that case, Control Surface detects that it is already connected to a MIDI interface, so it won't change anything to the manual routing we specified earlier. <br  />
 If you call <code>Control_Surface.begin()</code> first, it will create its default routing as discussed earlier, and if you then later add your manual connections on top of that, your code might not work as expected.</p>
<h2><a class="anchor" id="midi_md-bidir-pipes"></a>
Bidirectional MIDI pipes</h2>
<p >There are many situations where you want to connect both the MIDI input and output of two endpoints together. It's a bit cumbersome to have to define a separate connection for each of the two directions. Luckily, the library includes bidirectional MIDI pipes, which makes this process a bit more terse.</p>
<p >The following sketch does exactly the same as the previous two, just using a bidirectional pipe as a shorthand.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../db/dbf/Control__Surface_8h.html">Control_Surface.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Instantiate a MIDI over USB interface</span></div>
<div class="line"><a class="code hl_class" href="../../de/d05/classUSBMIDI__Interface.html">USBMIDI_Interface</a> midi_usb;</div>
<div class="line"><span class="comment">// Instantiate the pipe to connect the interface to Control_Surface</span></div>
<div class="line"><a class="code hl_typedef" href="../../df/ddc/group__MIDI__Routing.html#ga987286a8b6dfd1b157a8fde75c203627">BidirectionalMIDI_Pipe</a> pipe_txrx;</div>
<div class="line"> </div>
<div class="line"><a class="code hl_class" href="../../d1/d9f/classNoteButton.html">NoteButton</a> button {2, <a class="code hl_variable" href="../../d7/d78/namespaceMIDI__Notes.html#adc612a1e4e057463777480eabc3fb0ca">MIDI_Notes::C</a>(4)};</div>
<div class="line"><a class="code hl_class" href="../../d9/d55/classNoteCCKPLED.html">NoteLED</a> led {13, <a class="code hl_variable" href="../../d7/d78/namespaceMIDI__Notes.html#adc612a1e4e057463777480eabc3fb0ca">MIDI_Notes::C</a>(4)};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> setup() {</div>
<div class="line">    <span class="comment">// Manually route MIDI output from Control_Surface to the MIDI interface,</span></div>
<div class="line">    <span class="comment">// and the MIDI output from the MIDI interface to Control_Surface</span></div>
<div class="line">    <a class="code hl_variable" href="../../d9/d38/Control__Surface__Class_8cpp.html#af7a5d250297d82b2b29605dd7ac250df">Control_Surface</a> | pipe_txrx | midi_usb;</div>
<div class="line">    <span class="comment">// Initialize everything</span></div>
<div class="line">    <a class="code hl_variable" href="../../d9/d38/Control__Surface__Class_8cpp.html#af7a5d250297d82b2b29605dd7ac250df">Control_Surface</a>.<a class="code hl_function" href="../../dc/d45/classControl__Surface__.html#ab0bdf5cca484fb2ba637c39384b27fb2">begin</a>();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> loop() {</div>
<div class="line">    <a class="code hl_variable" href="../../d9/d38/Control__Surface__Class_8cpp.html#af7a5d250297d82b2b29605dd7ac250df">Control_Surface</a>.<a class="code hl_function" href="../../dc/d45/classControl__Surface__.html#afe461d27b9c48d5921c00d521181f12f">loop</a>();</div>
<div class="line">}</div>
<div class="ttc" id="agroup__MIDI__Routing_html_ga987286a8b6dfd1b157a8fde75c203627"><div class="ttname"><a href="../../df/ddc/group__MIDI__Routing.html#ga987286a8b6dfd1b157a8fde75c203627">BidirectionalMIDI_Pipe</a></div><div class="ttdeci">std::pair&lt; MIDI_Pipe, MIDI_Pipe &gt; BidirectionalMIDI_Pipe</div><div class="ttdoc">A bidirectional pipe consists of two unidirectional pipes.</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/ddf/MIDI__Pipes_8hpp_source.html#l00592">MIDI_Pipes.hpp:592</a></div></div>
</div><!-- fragment --><p> Connections to bidirectional pipes are made using the “vertical pipe” operator (<code>|</code>).</p>
<h2><a class="anchor" id="midi_md-multiple-interfaces-routing"></a>
Multiple MIDI interfaces</h2>
<p >If you only have a single MIDI interface, you don't really need to worry about pipes, as you saw in the <a class="el" href="../../d3/df7/midi-tutorial.html#midi_md-default-routing">Default routing</a> section, you can just call <code>Control_Surface.begin()</code> and it will automatically set everything up for you.</p>
<p >MIDI pipes really shine in scenarios where you have multiple MIDI interfaces in a single program, they allow you to fully customize the routes between them. In the following example, we'll add an extra serial MIDI interface, and route it as follows:</p>
<p ><img src="../../midi-pipes-2.svg" alt="" style="pointer-events: none; margin: 0 auto; display: block; width: 38em" class="inline"/></p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../db/dbf/Control__Surface_8h.html">Control_Surface.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Instantiate a MIDI over USB interface</span></div>
<div class="line"><a class="code hl_class" href="../../de/d05/classUSBMIDI__Interface.html">USBMIDI_Interface</a> midi_usb;</div>
<div class="line"><span class="comment">// Instantiate a MIDI over Serial interface using `Serial1`</span></div>
<div class="line"><a class="code hl_class" href="../../d9/d78/classHardwareSerialMIDI__Interface.html">HardwareSerialMIDI_Interface</a> midi_ser = Serial1;</div>
<div class="line"><span class="comment">// Instantiate the three pipes to connect the interfaces to Control_Surface</span></div>
<div class="line"><a class="code hl_class" href="../../df/d72/classMIDI__Pipe.html">MIDI_Pipe</a> pipe_tx_u, pipe_rx_u, pipe_tx_s;</div>
<div class="line"> </div>
<div class="line"><a class="code hl_class" href="../../d1/d9f/classNoteButton.html">NoteButton</a> button {2, <a class="code hl_variable" href="../../d7/d78/namespaceMIDI__Notes.html#adc612a1e4e057463777480eabc3fb0ca">MIDI_Notes::C</a>(4)};</div>
<div class="line"><a class="code hl_class" href="../../d9/d55/classNoteCCKPLED.html">NoteLED</a> led {13, <a class="code hl_variable" href="../../d7/d78/namespaceMIDI__Notes.html#adc612a1e4e057463777480eabc3fb0ca">MIDI_Notes::C</a>(4)};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> setup() {</div>
<div class="line">    <span class="comment">// Manually route MIDI output from Control_Surface to the USB MIDI interface</span></div>
<div class="line">    <a class="code hl_variable" href="../../d9/d38/Control__Surface__Class_8cpp.html#af7a5d250297d82b2b29605dd7ac250df">Control_Surface</a> &gt;&gt; pipe_tx_u &gt;&gt; midi_usb;</div>
<div class="line">    <span class="comment">// Manually route MIDI output from the USB MIDI interface to Control_Surface</span></div>
<div class="line">    <a class="code hl_variable" href="../../d9/d38/Control__Surface__Class_8cpp.html#af7a5d250297d82b2b29605dd7ac250df">Control_Surface</a> &lt;&lt; pipe_rx_u &lt;&lt; midi_usb;</div>
<div class="line">    <span class="comment">// Manually route MIDI output from Control_Surface to the Serial MIDI interface</span></div>
<div class="line">    <a class="code hl_variable" href="../../d9/d38/Control__Surface__Class_8cpp.html#af7a5d250297d82b2b29605dd7ac250df">Control_Surface</a> &gt;&gt; pipe_tx_s &gt;&gt; midi_ser;</div>
<div class="line">    <span class="comment">// Initialize everything</span></div>
<div class="line">    <a class="code hl_variable" href="../../d9/d38/Control__Surface__Class_8cpp.html#af7a5d250297d82b2b29605dd7ac250df">Control_Surface</a>.<a class="code hl_function" href="../../dc/d45/classControl__Surface__.html#ab0bdf5cca484fb2ba637c39384b27fb2">begin</a>();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> loop() {</div>
<div class="line">    <a class="code hl_variable" href="../../d9/d38/Control__Surface__Class_8cpp.html#af7a5d250297d82b2b29605dd7ac250df">Control_Surface</a>.<a class="code hl_function" href="../../dc/d45/classControl__Surface__.html#afe461d27b9c48d5921c00d521181f12f">loop</a>();</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="midi_md-pipe-factories"></a>
MIDI pipe factories</h2>
<p >If you want to keep adding new connections, you need a new pipe for each one. For large numbers of pipes this is cumbersome, so the library includes a pipe factory that gives you a new pipe every time you use it.</p>
<p >Using the factory, the previous example can be simplified as follows:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../db/dbf/Control__Surface_8h.html">Control_Surface.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Instantiate a MIDI over USB interface</span></div>
<div class="line"><a class="code hl_class" href="../../de/d05/classUSBMIDI__Interface.html">USBMIDI_Interface</a> midi_usb;</div>
<div class="line"><span class="comment">// Instantiate a MIDI over Serial interface using `Serial1`</span></div>
<div class="line"><a class="code hl_class" href="../../d9/d78/classHardwareSerialMIDI__Interface.html">HardwareSerialMIDI_Interface</a> midi_ser = Serial1;</div>
<div class="line"><span class="comment">// Instantiate a factory that can produce three pipes</span></div>
<div class="line"><a class="code hl_struct" href="../../d3/da5/structMIDI__PipeFactory.html">MIDI_PipeFactory&lt;3&gt;</a> pipes;</div>
<div class="line"> </div>
<div class="line"><a class="code hl_class" href="../../d1/d9f/classNoteButton.html">NoteButton</a> button {2, <a class="code hl_variable" href="../../d7/d78/namespaceMIDI__Notes.html#adc612a1e4e057463777480eabc3fb0ca">MIDI_Notes::C</a>(4)};</div>
<div class="line"><a class="code hl_class" href="../../d9/d55/classNoteCCKPLED.html">NoteLED</a> led {13, <a class="code hl_variable" href="../../d7/d78/namespaceMIDI__Notes.html#adc612a1e4e057463777480eabc3fb0ca">MIDI_Notes::C</a>(4)};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> setup() {</div>
<div class="line">    <span class="comment">// Manually route MIDI output from Control_Surface to the USB MIDI interface</span></div>
<div class="line">    <a class="code hl_variable" href="../../d9/d38/Control__Surface__Class_8cpp.html#af7a5d250297d82b2b29605dd7ac250df">Control_Surface</a> &gt;&gt; pipes &gt;&gt; midi_usb;</div>
<div class="line">    <span class="comment">// Manually route MIDI output from the USB MIDI interface to Control_Surface</span></div>
<div class="line">    <a class="code hl_variable" href="../../d9/d38/Control__Surface__Class_8cpp.html#af7a5d250297d82b2b29605dd7ac250df">Control_Surface</a> &lt;&lt; pipes &lt;&lt; midi_usb;</div>
<div class="line">    <span class="comment">// Manually route MIDI output from Control_Surface to the Serial MIDI interface</span></div>
<div class="line">    <a class="code hl_variable" href="../../d9/d38/Control__Surface__Class_8cpp.html#af7a5d250297d82b2b29605dd7ac250df">Control_Surface</a> &gt;&gt; pipes &gt;&gt; midi_ser;</div>
<div class="line">    <span class="comment">// Initialize everything</span></div>
<div class="line">    <a class="code hl_variable" href="../../d9/d38/Control__Surface__Class_8cpp.html#af7a5d250297d82b2b29605dd7ac250df">Control_Surface</a>.<a class="code hl_function" href="../../dc/d45/classControl__Surface__.html#ab0bdf5cca484fb2ba637c39384b27fb2">begin</a>();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> loop() {</div>
<div class="line">    <a class="code hl_variable" href="../../d9/d38/Control__Surface__Class_8cpp.html#af7a5d250297d82b2b29605dd7ac250df">Control_Surface</a>.<a class="code hl_function" href="../../dc/d45/classControl__Surface__.html#afe461d27b9c48d5921c00d521181f12f">loop</a>();</div>
<div class="line">}</div>
<div class="ttc" id="astructMIDI__PipeFactory_html"><div class="ttname"><a href="../../d3/da5/structMIDI__PipeFactory.html">MIDI_PipeFactory</a></div><div class="ttdoc">Class that produces multiple MIDI_Pipes.</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/ddf/MIDI__Pipes_8hpp_source.html#l00648">MIDI_Pipes.hpp:648</a></div></div>
</div><!-- fragment --><p >The number of pipes that the factory can produce is specified between angle brackets (<code>&lt;&gt;</code>). If you try to use more pipes than specified, you will get an error at run time, which is indicated by a blinking on-board LED.</p>
<p >Instead of specifying a specific pipe when doing the routing in the <code>setup</code> function, you can now just use the <code>pipes</code> factory, it will give you a new pipe each time you use it.</p>
<p >If you need bidirectional pipes, you can use the <a class="el" href="../../df/ddc/group__MIDI__Routing.html#gab1901f6fc0f19b8c05c5639ab0a0b2ab">BidirectionalMIDI_PipeFactory</a> class instead.</p>
<h2><a class="anchor" id="midi_md-routing-between-interfaces"></a>
Routing between MIDI interfaces</h2>
<p >Up to now, we've only created connections between <code>Control_Surface</code> itself and a MIDI interface, but you can also create routes between MIDI interfaces. This is demonstrated in the following example, where we connect a debug MIDI interface to a MIDI over USB interface.</p>
<p ><img src="../../midi-pipes-interfaces.svg" alt="" style="pointer-events: none; margin: 0 auto; display: block; width: 38em" class="inline"/></p>
<p >In this case, all messages that arrive on the <code>midi_dbg</code> interface are sent to the <code>midi_usb</code> interface, and all messages that arrive on <code>midi_usb</code> are sent to <code>midi_dbg</code>.</p>
<p >Now that we're no longer using <code>Control_Surface.begin()</code> and <code>Control_Surface.loop()</code>, we have to take care of initializing and updating the MIDI interfaces ourselves.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../db/dbf/Control__Surface_8h.html">Control_Surface.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Instantiate a MIDI over USB interface</span></div>
<div class="line"><a class="code hl_class" href="../../de/d05/classUSBMIDI__Interface.html">USBMIDI_Interface</a> midi_usb;</div>
<div class="line"><span class="comment">// Instantiate a debug MIDI interface for debugging in the Serial Monitor</span></div>
<div class="line"><a class="code hl_class" href="../../de/d2d/classUSBDebugMIDI__Interface.html">USBDebugMIDI_Interface</a> midi_dbg;</div>
<div class="line"><span class="comment">// Instantiate the pipe to connect the two interfaces</span></div>
<div class="line"><a class="code hl_typedef" href="../../df/ddc/group__MIDI__Routing.html#ga987286a8b6dfd1b157a8fde75c203627">BidirectionalMIDI_Pipe</a> pipes;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> setup() {</div>
<div class="line">    <span class="comment">// Manually route MIDI output from Control_Surface to the MIDI interface,</span></div>
<div class="line">    <span class="comment">// and the MIDI output from the MIDI interface to Control_Surface</span></div>
<div class="line">    midi_dbg | pipes | midi_usb;</div>
<div class="line">    <span class="comment">// Initialize the MIDI interfaces</span></div>
<div class="line">    <a class="code hl_function" href="../../d1/d55/classAH_1_1Updatable.html#a4f7077a56ec41a07f5a54dd8b3828984">MIDI_Interface::beginAll</a>();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> loop() {</div>
<div class="line">    <a class="code hl_function" href="../../d1/d55/classAH_1_1Updatable.html#a44e05f733dace05adcf585b5a17be292">MIDI_Interface::updateAll</a>();</div>
<div class="line">}</div>
<div class="ttc" id="aclassAH_1_1Updatable_html_a44e05f733dace05adcf585b5a17be292"><div class="ttname"><a href="../../d1/d55/classAH_1_1Updatable.html#a44e05f733dace05adcf585b5a17be292">AH::Updatable&lt; MIDI_Interface &gt;::updateAll</a></div><div class="ttdeci">static void updateAll()</div><div class="ttdoc">Update all enabled instances of this class.</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d93/Updatable_8hpp_source.html#l00190">Updatable.hpp:190</a></div></div>
<div class="ttc" id="aclassAH_1_1Updatable_html_a4f7077a56ec41a07f5a54dd8b3828984"><div class="ttname"><a href="../../d1/d55/classAH_1_1Updatable.html#a4f7077a56ec41a07f5a54dd8b3828984">AH::Updatable&lt; MIDI_Interface &gt;::beginAll</a></div><div class="ttdeci">static void beginAll()</div><div class="ttdoc">Begin all enabled instances of this class.</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d93/Updatable_8hpp_source.html#l00186">Updatable.hpp:186</a></div></div>
</div><!-- fragment --><p >If you have an Arduino with native MIDI over USB support, you can try out this example yourself: <br  />
 Open your favorite MIDI monitor and select the MIDI over USB port of the Arduino. Then open the Serial Monitor, set the line ending to “Newline”, and then enter a MIDI message, e.g. <code>90 3C 7F</code>. You should see the message arrive in the MIDI monitor as a Note On message for note C4 on channel 1 with a velocity of 127. Similarly, if you send a message to the Arduino using the MIDI monitor, it will be printed in the Serial Monitor, because we used a bidirectional pipe.</p>
<p >If you only want to print MIDI messages, you can use the <a class="el" href="../../d5/dbc/classUSBDebugMIDI__Output.html">USBDebugMIDI_Output</a> class instead of <a class="el" href="../../de/d2d/classUSBDebugMIDI__Interface.html">USBDebugMIDI_Interface</a>. <a class="el" href="../../d5/dbc/classUSBDebugMIDI__Output.html" title="A class for debug MIDI outputs sending human-readable MIDI messages over the USB CDC connection.">USBDebugMIDI_Output</a> uses less memory, and one of the issues of having multiple USBDebugMIDI_Interfaces is that input cannot work (some of the characters you type in are sent to one of the interfaces, some to the others), <a class="el" href="../../d5/dbc/classUSBDebugMIDI__Output.html">USBDebugMIDI_Output</a> doesn't have this issue.</p>
<p >In the following example, Control Surface works normally, using the USB MIDI interface: you can try sending note on/off messages for note C4 and it'll turn on/off the on-board LED, and if you press/release the button on pin 2 you'll receive note on/off messages. <br  />
 Additionally, all MIDI input that arrives on the MIDI over USB interface is routed to a secondary MIDI debug output, allowing you to use the Serial Monitor to inspect the messages being sent to the Arduino.</p>
<p ><img src="../../midi-pipes-mon.svg" alt="" style="pointer-events: none; margin: 0 auto; display: block; width: 38em" class="inline"/></p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../db/dbf/Control__Surface_8h.html">Control_Surface.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// The primary MIDI interface used by Control Surface.</span></div>
<div class="line"><a class="code hl_class" href="../../de/d05/classUSBMIDI__Interface.html">USBMIDI_Interface</a> midi;</div>
<div class="line"><span class="comment">// A secondary interface to print incoming messages</span></div>
<div class="line"><span class="comment">// on the primary interface to the serial monitor.</span></div>
<div class="line"><a class="code hl_class" href="../../d5/dbc/classUSBDebugMIDI__Output.html">USBDebugMIDI_Output</a> midimon { 115200 };</div>
<div class="line"><span class="comment">// Pipe to route messages from midi to midimon.</span></div>
<div class="line"><a class="code hl_class" href="../../df/d72/classMIDI__Pipe.html">MIDI_Pipe</a> mpipe;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// You can add normal Control Surface MIDI elements:</span></div>
<div class="line"><a class="code hl_class" href="../../d1/d9f/classNoteButton.html">NoteButton</a> btn {  2, <a class="code hl_variable" href="../../d7/d78/namespaceMIDI__Notes.html#adc612a1e4e057463777480eabc3fb0ca">MIDI_Notes::C</a>(4) };</div>
<div class="line"><a class="code hl_class" href="../../d9/d55/classNoteCCKPLED.html">NoteLED</a>    led { 13, <a class="code hl_variable" href="../../d7/d78/namespaceMIDI__Notes.html#adc612a1e4e057463777480eabc3fb0ca">MIDI_Notes::C</a>(4) };</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> setup() {</div>
<div class="line">    midi.<a class="code hl_function" href="../../d9/d73/classMIDI__Interface.html#a922dd87d272bb2be2771c43ac974481a">setAsDefault</a>(); <span class="comment">// Make this the primary interface.</span></div>
<div class="line">    midi &gt;&gt; mpipe &gt;&gt; midimon; <span class="comment">// Route messages from midi to midimon.</span></div>
<div class="line">    <a class="code hl_variable" href="../../d9/d38/Control__Surface__Class_8cpp.html#af7a5d250297d82b2b29605dd7ac250df">Control_Surface</a>.<a class="code hl_function" href="../../dc/d45/classControl__Surface__.html#ab0bdf5cca484fb2ba637c39384b27fb2">begin</a>();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> loop() {</div>
<div class="line">    <a class="code hl_variable" href="../../d9/d38/Control__Surface__Class_8cpp.html#af7a5d250297d82b2b29605dd7ac250df">Control_Surface</a>.<a class="code hl_function" href="../../dc/d45/classControl__Surface__.html#afe461d27b9c48d5921c00d521181f12f">loop</a>();</div>
<div class="line">}</div>
<div class="ttc" id="aclassMIDI__Interface_html_a922dd87d272bb2be2771c43ac974481a"><div class="ttname"><a href="../../d9/d73/classMIDI__Interface.html#a922dd87d272bb2be2771c43ac974481a">MIDI_Interface::setAsDefault</a></div><div class="ttdeci">void setAsDefault()</div><div class="ttdoc">Set this MIDI interface as the default interface.</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d0f/MIDI__Interface_8cpp_source.html#l00015">MIDI_Interface.cpp:15</a></div></div>
<div class="ttc" id="aclassUSBDebugMIDI__Output_html"><div class="ttname"><a href="../../d5/dbc/classUSBDebugMIDI__Output.html">USBDebugMIDI_Output</a></div><div class="ttdoc">A class for debug MIDI outputs sending human-readable MIDI messages over the USB CDC connection.</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d55/DebugMIDI__Interface_8hpp_source.html#l00154">DebugMIDI_Interface.hpp:154</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="midi_md-routing-more-examples"></a>
More examples</h2>
<ul>
<li><a class="el" href="../../d0/dc4/MIDI_Pipes-Routing_8ino-example.html">MIDI_Pipes-Routing.ino</a></li>
<li><a class="el" href="../../d5/da5/Dual-MIDI-Interface_8ino-example.html">Dual-MIDI-Interface.ino</a></li>
<li><a class="el" href="../../dc/d0b/MIDI-Monitor_8ino-example.html">MIDI-Monitor.ino</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4
</small></address>
</body>
</html>
