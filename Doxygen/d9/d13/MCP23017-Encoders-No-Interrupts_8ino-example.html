<!-- HTML header for doxygen 1.10.0-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Control Surface: MCP23017-Encoders-No-Interrupts.ino</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../clipboard.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
window.MathJax = {
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  }
};
</script>
<script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
<script type="text/javascript" src="../../darkmode_toggle.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300&family=Roboto:wght@400&family=Roboto:wght@500&display=swap" rel="stylesheet">
<link href="../../custom_stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Control Surface<span id="projectnumber">&#160;<code><a href="/Control-Surface/">main</a></code></span>
   </div>
   <div id="projectbrief">MIDI Control Surface library for Arduino</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">MCP23017-Encoders-No-Interrupts.ino</div></div>
</div><!--header-->
<div class="contents">
<h1><a class="anchor" id="mcp23017-encoders-no-interrupts"></a>
MCP23017-Encoders-No-Interrupts</h1>
<p>This example demonstrates the use of MCP23017 IÂ²C port expanders with rotary encoders.</p>
<dl class="section user"><dt>Boards: <b class="boards-info" title="Control Surface&apos;s automated continuous integration workflows regularly verify that this example compiles successfully for the following boards. The list is not exhaustive, and the example will most likely work on other boards as well (perhaps requiring slight modifications).">ðŸ›ˆ</b> </dt><dd>AVR, AVR USB, Nano Every, Nano 33 IoT, Nano 33 BLE, UNO R4, Pi Pico, Due, Teensy 3.x, ESP8266, ESP32</dd></dl>
<h2><a class="anchor" id="connections-36"></a>
Connections</h2>
<ul>
<li>SDA: MCP23017 SDA</li>
<li>SCL: MCP23017 SCL</li>
<li>12: MCP23017 INTA or INTB</li>
</ul>
<p>Connect up to 8 encoders to the MCP23017's GPIO pins: the first encoder connects to GPIO A0 and A1, the second encoder connects to GPIO A2 and A3, ..., the eighth encoder connects to GPIO B6 and B7. <br  />
 Connect the "common" pins of the encoders to ground. <br  />
 The built-in pull-up resistors of the MCP23017 will be enabled.</p>
<p>Make sure that the reset and address pins are all configured correctly (reset to Vcc; A0, A1 and A2 to ground).</p>
<p>If you need more than one MCP23017 with encoders, you can connect their interrupt pins together. This does result in higher latency, because on average, half of the total number of MCP23017s have to be polled, which is relatively slow, and might lead to missed pulses when using a large number of encoders.</p>
<h2><a class="anchor" id="behavior-37"></a>
Behavior</h2>
<p>When the position of one of the encoders changes, it is printed to the Serial monitor.</p>
<h2><a class="anchor" id="cautions-1"></a>
Cautions</h2>
<p>The interrupt pin of the MCP23017 doesn't trigger a hardware interrupt on the Arduino. It's used only to determine whether the Arduino should read the GPIO registers from the MCP23017. <br  />
 If the update function isn't called often enough, you will miss encoder pulses, and the position will be incorrect. <br  />
 It's very important to keep your main loop free from any code that blocks for more than a couple of hundreds of microseconds.</p>
<p>Written by PieterP, 2020-04-06 <br  />
 <a href="https://github.com/tttapa/Arduino-Helpers">https://github.com/tttapa/Arduino-Helpers</a></p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;Wire.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../dc/de6/Arduino__Helpers_8h.html">Arduino_Helpers.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d8/dd2/MCP23017Encoders_8hpp.html">AH/Hardware/MCP23017Encoders.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../dd/d80/PrintStream_8hpp.html">AH/PrintStream/PrintStream.hpp</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using </span>WireType = <span class="keyword">decltype</span>(Wire);     <span class="comment">// The type of IÂ²C driver to use</span></div>
<div class="line"><span class="keyword">using </span>EncoderPositionType = int32_t; <span class="comment">// The type for saving encoder positions</span></div>
<div class="line"><span class="keyword">using </span>MCPEncoderType = <a class="code hl_class" href="../../dc/d42/classAH_1_1MCP23017Encoders.html">MCP23017Encoders&lt;WireType, EncoderPositionType&gt;</a>;</div>
<div class="line"> </div>
<div class="line">MCPEncoderType enc {Wire, 0x0, 12};</div>
<div class="line"><span class="comment">//                  â”‚     â”‚    â””â”€ Interrupt pin</span></div>
<div class="line"><span class="comment">//                  â”‚     â””â”€â”€â”€â”€â”€â”€ Address offset</span></div>
<div class="line"><span class="comment">//                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ IÂ²C interface</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> setup() {</div>
<div class="line">  Serial.<a id="a0" name="a0"></a><a class="code hl_function" href="../../dc/d42/classAH_1_1MCP23017Encoders.html#ab0bdf5cca484fb2ba637c39384b27fb2">begin</a>(115200);</div>
<div class="line">  Wire.begin(); <span class="comment">// Must be called before enc.begin()</span></div>
<div class="line">  Wire.setClock(800000);</div>
<div class="line">  enc.begin(); <span class="comment">// Initialize the MCP23017</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> loop() {</div>
<div class="line">  enc.update(); <span class="comment">// Read the state of the encoders and update the positions</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Save the previous positions</span></div>
<div class="line">  <span class="keyword">static</span> EncoderPositionType prevPositions[8] {};</div>
<div class="line">  <span class="comment">// Check if an encoder position changed and print it</span></div>
<div class="line">  <span class="keywordflow">for</span> (uint8_t i = 0; i &lt; 8; ++i) {</div>
<div class="line">    <span class="keywordflow">if</span> (enc.read(i) != prevPositions[i]) {</div>
<div class="line">      Serial &lt;&lt; <span class="charliteral">&#39;[&#39;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;] &quot;</span> &lt;&lt; enc.read(i) &lt;&lt; <a class="code hl_function" href="../../d8/d4b/group__AH__PrintStream.html#ga439f453f806df7d97e736ff0e7151344">endl</a>;</div>
<div class="line">      prevPositions[i] = enc.read(i);</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="ttc" id="aArduino__Helpers_8h_html"><div class="ttname"><a href="../../dc/de6/Arduino__Helpers_8h.html">Arduino_Helpers.h</a></div><div class="ttdoc">Dummy header file for Arduino builder.</div></div>
<div class="ttc" id="aMCP23017Encoders_8hpp_html"><div class="ttname"><a href="../../d8/dd2/MCP23017Encoders_8hpp.html">MCP23017Encoders.hpp</a></div></div>
<div class="ttc" id="aPrintStream_8hpp_html"><div class="ttname"><a href="../../dd/d80/PrintStream_8hpp.html">PrintStream.hpp</a></div></div>
<div class="ttc" id="aclassAH_1_1MCP23017Encoders_html"><div class="ttname"><a href="../../dc/d42/classAH_1_1MCP23017Encoders.html">::MCP23017Encoders</a></div><div class="ttdoc">Class for reading 8 rotary encoders using a MCP23017 IÂ²C port expander.</div><div class="ttdef"><b>Definition</b> <a href="../../d8/dd2/MCP23017Encoders_8hpp_source.html#l00033">MCP23017Encoders.hpp:33</a></div></div>
<div class="ttc" id="aclassAH_1_1MCP23017Encoders_html_ab0bdf5cca484fb2ba637c39384b27fb2"><div class="ttname"><a href="../../dc/d42/classAH_1_1MCP23017Encoders.html#ab0bdf5cca484fb2ba637c39384b27fb2">AH::MCP23017Encoders::begin</a></div><div class="ttdeci">void begin()</div><div class="ttdoc">Initialize the MCP23017.</div><div class="ttdef"><b>Definition</b> <a href="../../d8/dd2/MCP23017Encoders_8hpp_source.html#l00125">MCP23017Encoders.hpp:125</a></div></div>
<div class="ttc" id="agroup__AH__PrintStream_html_ga439f453f806df7d97e736ff0e7151344"><div class="ttname"><a href="../../d8/d4b/group__AH__PrintStream.html#ga439f453f806df7d97e736ff0e7151344">AH::endl</a></div><div class="ttdeci">Print &amp; endl(Print &amp;printer)</div><div class="ttdef"><b>Definition</b> <a href="../../da/d69/PrintStream_8cpp_source.html#l00028">PrintStream.cpp:28</a></div></div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
