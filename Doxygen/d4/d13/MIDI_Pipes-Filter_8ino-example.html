<!-- HTML header for doxygen 1.10.0-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Control Surface: MIDI_Pipes-Filter.ino</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../clipboard.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
window.MathJax = {
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  }
};
</script>
<script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
<script type="text/javascript" src="../../darkmode_toggle.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300&family=Roboto:wght@400&family=Roboto:wght@500&display=swap" rel="stylesheet">
<link href="../../custom_stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Control Surface<span id="projectnumber">&#160;<code><a href="/Control-Surface/">main</a></code></span>
   </div>
   <div id="projectbrief">MIDI Control Surface library for Arduino</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">MIDI_Pipes-Filter.ino</div></div>
</div><!--header-->
<div class="contents">
<h1><a class="anchor" id="midi_pipes-filter"></a>
MIDI_Pipes-Filter</h1>
<p>Filtering and modifying MIDI messages that travel through a <a class="el" href="../../df/d72/classMIDI__Pipe.html" title="Class that routes MIDI messages from a MIDI_Source to a MIDI_Sink.">MIDI_Pipe</a>.</p>
<p>This example demonstrates how to create custom MIDI pipes that can filter out and modify the messages that travel through it. It uses a debug MIDI interface for demonstration purposes, and loops back only MIDI note and real-time messages, messages of any other type are dropped. Additionally, all MIDI note messages are transposed down an octave, and their channel is set to 5.</p>
<p>To try it out, open the Serial monitor (at 115200 baud) and type <code>98 3C 7F</code> (Note On, channel 9, C4, full velocity). When you press enter, you'll get back the following message (note how the channel and pitch changed):</p>
<div class="fragment"><div class="line">Note <a class="code hl_function" href="../../da/de8/group__AH__Containers.html#ga6ee13d5c260727ac6a7de2ee21cc76f9">On</a>    <a id="_a0" name="_a0"></a><a class="code hl_class" href="../../d2/d48/classChannel.html">Channel</a>: 5    <a class="code hl_function" href="../../da/de8/group__AH__Containers.html#ga6ee13d5c260727ac6a7de2ee21cc76f9">Data</a> 1: 0x30    <a class="code hl_function" href="../../da/de8/group__AH__Containers.html#ga6ee13d5c260727ac6a7de2ee21cc76f9">Data</a> 2: 0x7F</div>
<div class="ttc" id="aclassChannel_html"><div class="ttname"><a href="../../d2/d48/classChannel.html">Channel</a></div><div class="ttdoc">A type-safe class for MIDI channels.</div><div class="ttdef"><b>Definition</b> <a href="../../d7/d42/Channel_8hpp_source.html#l00013">Channel.hpp:13</a></div></div>
<div class="ttc" id="agroup__AH__Containers_html_ga6ee13d5c260727ac6a7de2ee21cc76f9"><div class="ttname"><a href="../../da/de8/group__AH__Containers.html#ga6ee13d5c260727ac6a7de2ee21cc76f9">AH::copyAs</a></div><div class="ttdeci">Array&lt; T, N &gt; copyAs(const Array&lt; U, N &gt; &amp;src)</div><div class="ttdoc">Copy an Array to an Array of a different type.</div><div class="ttdef"><b>Definition</b> <a href="../../d5/db6/ArrayHelpers_8hpp_source.html#l00105">ArrayHelpers.hpp:105</a></div></div>
</div><!-- fragment --><p>If you try to send a Pitch Bend message (for example, <code>E0 12 34</code>), you'll get no response, because the code filtered it out.</p>
<dl class="section user"><dt>Boards: <b class="boards-info" title="Control Surface&apos;s automated continuous integration workflows regularly verify that this example compiles successfully for the following boards. The list is not exhaustive, and the example will most likely work on other boards as well (perhaps requiring slight modifications).">ðŸ›ˆ</b> </dt><dd>AVR, AVR USB, Nano Every, Due, Nano 33 IoT, Nano 33 BLE, UNO R4, Pi Pico, ESP32, Teensy 3.x</dd></dl>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../db/dbf/Control__Surface_8h.html">Control_Surface.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><a id="_a0" name="_a0"></a><a class="code hl_class" href="../../de/d2d/classUSBDebugMIDI__Interface.html">USBDebugMIDI_Interface</a> midi;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// A unidirectional pipe that connects a MIDI source to a MIDI sink.</span></div>
<div class="line"><span class="comment">// Messages coming from the source are handled by the `mapForwardMIDI()`</span></div>
<div class="line"><span class="comment">// function, where they can be modified or filtered out, and then sent</span></div>
<div class="line"><span class="comment">// to the MIDI sink by calling the `sourceMIDItoSink()` function.</span></div>
<div class="line"><span class="keyword">struct </span><a class="code hl_function" href="../../da/de8/group__AH__Containers.html#ga6ee13d5c260727ac6a7de2ee21cc76f9">MyMIDIFilter</a> : <a id="_a1" name="_a1"></a><a class="code hl_class" href="../../df/d72/classMIDI__Pipe.html">MIDI_Pipe</a> {</div>
<div class="line">  <span class="comment">// Pass on only Note On/Off messages, changing the channel to 5 and</span></div>
<div class="line">  <span class="comment">// transposing all notes an octave down.</span></div>
<div class="line">  <span class="keywordtype">void</span> <a id="a2" name="a2"></a><a class="code hl_function" href="../../df/d72/classMIDI__Pipe.html#a9f1ac3c620465a1ed18336938e3f17e5">mapForwardMIDI</a>(<a id="_a3" name="_a3"></a><a class="code hl_struct" href="../../d7/d3f/structChannelMessage.html">ChannelMessage</a> <a class="code hl_function" href="../../da/de8/group__AH__Containers.html#ga6ee13d5c260727ac6a7de2ee21cc76f9">msg</a>)<span class="keyword"> override </span>{</div>
<div class="line">    <span class="keywordflow">switch</span> (<a class="code hl_function" href="../../da/de8/group__AH__Containers.html#ga6ee13d5c260727ac6a7de2ee21cc76f9">msg</a>.getMessageType()) {</div>
<div class="line">      <span class="keywordflow">case</span> <a id="a4" name="a4"></a><a class="code hl_enumvalue" href="../../dc/d40/MIDI__MessageTypes_8hpp.html#a0f3f6ac1a61700bdea6873fdfe9248f5a6138748b0dea7e54d0ab77709ab74ba1">MIDIMessageType::NoteOff</a>:  <span class="comment">// fallthrough</span></div>
<div class="line">      <span class="keywordflow">case</span> <a id="a5" name="a5"></a><a class="code hl_enumvalue" href="../../dc/d40/MIDI__MessageTypes_8hpp.html#a0f3f6ac1a61700bdea6873fdfe9248f5a392b06517dc40739343a9ef9533cad46">MIDIMessageType::NoteOn</a>:</div>
<div class="line">        <a class="code hl_function" href="../../da/de8/group__AH__Containers.html#ga6ee13d5c260727ac6a7de2ee21cc76f9">msg</a>.setChannel(<a id="a6" name="a6"></a><a class="code hl_variable" href="../../d7/d42/Channel_8hpp.html#ad55a9954f18a5b89f78e9d332930bfb1">Channel_5</a>);</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code hl_function" href="../../da/de8/group__AH__Containers.html#ga6ee13d5c260727ac6a7de2ee21cc76f9">msg</a>.data1 &gt;= 12)</div>
<div class="line">          <a class="code hl_function" href="../../da/de8/group__AH__Containers.html#ga6ee13d5c260727ac6a7de2ee21cc76f9">msg</a>.data1 -= 12;</div>
<div class="line">        <a id="a7" name="a7"></a><a class="code hl_function" href="../../df/d72/classMIDI__Pipe.html#a199bd7c52e5f9c03516a72b9d414bf3e">sourceMIDItoSink</a>(<a class="code hl_function" href="../../da/de8/group__AH__Containers.html#ga6ee13d5c260727ac6a7de2ee21cc76f9">msg</a>);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      <span class="keywordflow">default</span>: <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  <span class="comment">// Do not pass on System Exclusive messages.</span></div>
<div class="line">  <span class="keywordtype">void</span> <a class="code hl_function" href="../../df/d72/classMIDI__Pipe.html#a9f1ac3c620465a1ed18336938e3f17e5">mapForwardMIDI</a>(<a id="_a8" name="_a8"></a><a class="code hl_struct" href="../../db/d45/structSysExMessage.html">SysExMessage</a>)<span class="keyword"> override </span>{}</div>
<div class="line">  <span class="comment">// Do not pass on System Common messages.</span></div>
<div class="line">  <span class="keywordtype">void</span> <a class="code hl_function" href="../../df/d72/classMIDI__Pipe.html#a9f1ac3c620465a1ed18336938e3f17e5">mapForwardMIDI</a>(<a id="_a9" name="_a9"></a><a class="code hl_struct" href="../../d5/dad/structSysCommonMessage.html">SysCommonMessage</a>)<span class="keyword"> override </span>{}</div>
<div class="line">  <span class="comment">// Pass on Real-Time messages without changes.</span></div>
<div class="line">  <span class="keywordtype">void</span> <a class="code hl_function" href="../../df/d72/classMIDI__Pipe.html#a9f1ac3c620465a1ed18336938e3f17e5">mapForwardMIDI</a>(<a id="_a10" name="_a10"></a><a class="code hl_struct" href="../../d6/d99/structRealTimeMessage.html">RealTimeMessage</a> <a class="code hl_function" href="../../da/de8/group__AH__Containers.html#ga6ee13d5c260727ac6a7de2ee21cc76f9">msg</a>)<span class="keyword"> override </span>{</div>
<div class="line">    <a class="code hl_function" href="../../df/d72/classMIDI__Pipe.html#a199bd7c52e5f9c03516a72b9d414bf3e">sourceMIDItoSink</a>(<a class="code hl_function" href="../../da/de8/group__AH__Containers.html#ga6ee13d5c260727ac6a7de2ee21cc76f9">msg</a>);</div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="../../da/de8/group__AH__Containers.html#ga6ee13d5c260727ac6a7de2ee21cc76f9">MyMIDIFilter</a> filter;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="../../da/de8/group__AH__Containers.html#ga6ee13d5c260727ac6a7de2ee21cc76f9">setup</a>() {</div>
<div class="line">  <span class="comment">// Loop back the MIDI input to the MIDI output, through the filter:</span></div>
<div class="line">  <span class="comment">// (MIDI input) -&gt; (MIDI filter) -&gt; (MIDI output)</span></div>
<div class="line">  <span class="comment">// (source)     -&gt;    (pipe)     -&gt;        (sink)</span></div>
<div class="line">      midi        &gt;&gt;    filter     &gt;&gt;         midi;</div>
<div class="line">  midi.<a id="a11" name="a11"></a><a class="code hl_function" href="../../db/dc4/classSerialDebugMIDI__Interface.html#a7c3e14d99bd3dc0e3670d6956dafcaf2">begin</a>();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> loop() {</div>
<div class="line">  midi.update();</div>
<div class="line">}</div>
<div class="ttc" id="aChannel_8hpp_html_ad55a9954f18a5b89f78e9d332930bfb1"><div class="ttname"><a href="../../d7/d42/Channel_8hpp.html#ad55a9954f18a5b89f78e9d332930bfb1">Channel_5</a></div><div class="ttdeci">constexpr Channel Channel_5</div><div class="ttdef"><b>Definition</b> <a href="../../d7/d42/Channel_8hpp_source.html#l00122">Channel.hpp:122</a></div></div>
<div class="ttc" id="aControl__Surface_8h_html"><div class="ttname"><a href="../../db/dbf/Control__Surface_8h.html">Control_Surface.h</a></div><div class="ttdoc">The main header file that includes all Control-Surface header files.</div></div>
<div class="ttc" id="aMIDI__MessageTypes_8hpp_html_a0f3f6ac1a61700bdea6873fdfe9248f5a392b06517dc40739343a9ef9533cad46"><div class="ttname"><a href="../../dc/d40/MIDI__MessageTypes_8hpp.html#a0f3f6ac1a61700bdea6873fdfe9248f5a392b06517dc40739343a9ef9533cad46">MIDIMessageType::NoteOn</a></div><div class="ttdeci">@ NoteOn</div><div class="ttdoc">Note On Channel Voice message (3B).</div></div>
<div class="ttc" id="aMIDI__MessageTypes_8hpp_html_a0f3f6ac1a61700bdea6873fdfe9248f5a6138748b0dea7e54d0ab77709ab74ba1"><div class="ttname"><a href="../../dc/d40/MIDI__MessageTypes_8hpp.html#a0f3f6ac1a61700bdea6873fdfe9248f5a6138748b0dea7e54d0ab77709ab74ba1">MIDIMessageType::NoteOff</a></div><div class="ttdeci">@ NoteOff</div><div class="ttdoc">Note Off Channel Voice message (3B).</div></div>
<div class="ttc" id="aclassMIDI__Pipe_html"><div class="ttname"><a href="../../df/d72/classMIDI__Pipe.html">MIDI_Pipe</a></div><div class="ttdoc">Class that routes MIDI messages from a MIDI_Source to a MIDI_Sink.</div><div class="ttdef"><b>Definition</b> <a href="../../dd/ddf/MIDI__Pipes_8hpp_source.html#l00335">MIDI_Pipes.hpp:335</a></div></div>
<div class="ttc" id="aclassMIDI__Pipe_html_a199bd7c52e5f9c03516a72b9d414bf3e"><div class="ttname"><a href="../../df/d72/classMIDI__Pipe.html#a199bd7c52e5f9c03516a72b9d414bf3e">MIDI_Pipe::sourceMIDItoSink</a></div><div class="ttdeci">void sourceMIDItoSink(Message msg)</div><div class="ttdoc">Send the given MIDI message to the sink of this pipe.</div><div class="ttdef"><b>Definition</b> <a href="../../dd/ddf/MIDI__Pipes_8hpp_source.html#l00521">MIDI_Pipes.hpp:521</a></div></div>
<div class="ttc" id="aclassMIDI__Pipe_html_a9f1ac3c620465a1ed18336938e3f17e5"><div class="ttname"><a href="../../df/d72/classMIDI__Pipe.html#a9f1ac3c620465a1ed18336938e3f17e5">MIDI_Pipe::mapForwardMIDI</a></div><div class="ttdeci">virtual void mapForwardMIDI(ChannelMessage msg)</div><div class="ttdoc">Function that maps, edits or filters MIDI messages, and then forwards them to the sink of the pipe.</div><div class="ttdef"><b>Definition</b> <a href="../../dd/ddf/MIDI__Pipes_8hpp_source.html#l00364">MIDI_Pipes.hpp:364</a></div></div>
<div class="ttc" id="aclassSerialDebugMIDI__Interface_html_a7c3e14d99bd3dc0e3670d6956dafcaf2"><div class="ttname"><a href="../../db/dc4/classSerialDebugMIDI__Interface.html#a7c3e14d99bd3dc0e3670d6956dafcaf2">SerialDebugMIDI_Interface::begin</a></div><div class="ttdeci">void begin() override</div><div class="ttdoc">Start the Serial interface at the predefined baud rate.</div><div class="ttdef"><b>Definition</b> <a href="../../db/d55/DebugMIDI__Interface_8hpp_source.html#l00272">DebugMIDI_Interface.hpp:272</a></div></div>
<div class="ttc" id="aclassUSBDebugMIDI__Interface_html"><div class="ttname"><a href="../../de/d2d/classUSBDebugMIDI__Interface.html">USBDebugMIDI_Interface</a></div><div class="ttdoc">A class for debug MIDI interfaces sending and receiving human-readable MIDI messages over the USB CDC...</div><div class="ttdef"><b>Definition</b> <a href="../../db/d55/DebugMIDI__Interface_8hpp_source.html#l00317">DebugMIDI_Interface.hpp:318</a></div></div>
<div class="ttc" id="astructChannelMessage_html"><div class="ttname"><a href="../../d7/d3f/structChannelMessage.html">ChannelMessage</a></div><div class="ttdef"><b>Definition</b> <a href="../../dc/d40/MIDI__MessageTypes_8hpp_source.html#l00205">MIDI_MessageTypes.hpp:205</a></div></div>
<div class="ttc" id="astructRealTimeMessage_html"><div class="ttname"><a href="../../d6/d99/structRealTimeMessage.html">RealTimeMessage</a></div><div class="ttdef"><b>Definition</b> <a href="../../dc/d40/MIDI__MessageTypes_8hpp_source.html#l00354">MIDI_MessageTypes.hpp:354</a></div></div>
<div class="ttc" id="astructSysCommonMessage_html"><div class="ttname"><a href="../../d5/dad/structSysCommonMessage.html">SysCommonMessage</a></div><div class="ttdef"><b>Definition</b> <a href="../../dc/d40/MIDI__MessageTypes_8hpp_source.html#l00263">MIDI_MessageTypes.hpp:263</a></div></div>
<div class="ttc" id="astructSysExMessage_html"><div class="ttname"><a href="../../db/d45/structSysExMessage.html">SysExMessage</a></div><div class="ttdef"><b>Definition</b> <a href="../../dc/d40/MIDI__MessageTypes_8hpp_source.html#l00305">MIDI_MessageTypes.hpp:305</a></div></div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
