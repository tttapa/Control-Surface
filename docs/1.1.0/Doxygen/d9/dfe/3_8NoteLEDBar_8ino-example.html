<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Control Surface: 3.NoteLEDBar.ino</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/SVG"],
});
</script><script type="text/javascript" async="async" src="/MathJax/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../custom_stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Control Surface
   &#160;<span id="projectnumber">1.1.0</span>
   </div>
   <div id="projectbrief">MIDI Control Surface library for Arduino</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">3.NoteLEDBar.ino</div>  </div>
</div><!--header-->
<div class="contents">
<h1><a class="anchor" id="autotoc_md99"></a>
3.NoteLEDBar</h1>
<p>This example demonstrates the use of LED bar graphs that respond to incoming MIDI note events. The LEDs are driven by a 74HC595 (or equivalent) shift register.</p>
<dl class="section user"><dt>Boards:</dt><dd>AVR, AVR USB, Teensy 3.x, ESP32</dd></dl>
<h2><a class="anchor" id="autotoc_md100"></a>
Connections</h2>
<ul>
<li>SS: 74HC595 ST_CP</li>
<li>MOSI: 74HC595 DS</li>
<li>SCK: 74HC595 SH_CP</li>
</ul>
<p>Connect eight LEDs (and series resistors) between the outputs of the shift register and ground.</p>
<p>Remember to connect the enable pin of the shift register to ground and the master reset pin to Vcc in order to enable it. <br  />
</p>
<h2><a class="anchor" id="autotoc_md101"></a>
Behavior</h2>
<p>If a MIDI Note On event for note 0x3C (C4 or middle C) is sent, the LED bar display is turned on, the higher the velocity (the harder you press the key), the more LEDs will turn on.</p>
<h2><a class="anchor" id="autotoc_md102"></a>
Mapping</h2>
<p>Route the MIDI output of a MIDI keyboard or from an audio workstation to the Arduino's MIDI input.</p>
<p>Written by PieterP, 2019-11-25 <br  />
 <a href="https://github.com/tttapa/Control-Surface">https://github.com/tttapa/Control-Surface</a></p>
<div class="fragment"><div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * This example demonstrates the use of LED bar graphs that respond to incoming </span></div>
<div class="line"><span class="comment"> * MIDI note events. The LEDs are driven by a 74HC595 (or equivalent) shift register.</span></div>
<div class="line"><span class="comment"> * </span></div>
<div class="line"><span class="comment"> * @boards  AVR, AVR USB, Teensy 3.x, ESP32</span></div>
<div class="line"><span class="comment"> * </span></div>
<div class="line"><span class="comment"> * Connections</span></div>
<div class="line"><span class="comment"> * -----------</span></div>
<div class="line"><span class="comment"> * </span></div>
<div class="line"><span class="comment"> *   - SS:   74HC595 ST_CP</span></div>
<div class="line"><span class="comment"> *   - MOSI: 74HC595 DS</span></div>
<div class="line"><span class="comment"> *   - SCK:  74HC595 SH_CP</span></div>
<div class="line"><span class="comment"> * </span></div>
<div class="line"><span class="comment"> * Connect eight LEDs (and series resistors) between the outputs of the shift</span></div>
<div class="line"><span class="comment"> * register and ground.</span></div>
<div class="line"><span class="comment"> * </span></div>
<div class="line"><span class="comment"> * Remember to connect the enable pin of the shift register to ground and the </span></div>
<div class="line"><span class="comment"> * master reset pin to Vcc in order to enable it.  </span></div>
<div class="line"><span class="comment"> * </span></div>
<div class="line"><span class="comment"> * Behavior</span></div>
<div class="line"><span class="comment"> * --------</span></div>
<div class="line"><span class="comment"> * </span></div>
<div class="line"><span class="comment"> * If a MIDI Note On event for note 0x3C (C4 or middle C) is sent, the LED bar</span></div>
<div class="line"><span class="comment"> * display is turned on, the higher the velocity (the harder you press the key),</span></div>
<div class="line"><span class="comment"> * the more LEDs will turn on.</span></div>
<div class="line"><span class="comment"> * </span></div>
<div class="line"><span class="comment"> * Mapping</span></div>
<div class="line"><span class="comment"> * -------</span></div>
<div class="line"><span class="comment"> * </span></div>
<div class="line"><span class="comment"> * Route the MIDI output of a MIDI keyboard or from an audio workstation to </span></div>
<div class="line"><span class="comment"> * the Arduino&#39;s MIDI input.</span></div>
<div class="line"><span class="comment"> * </span></div>
<div class="line"><span class="comment"> * Written by PieterP, 2019-11-25  </span></div>
<div class="line"><span class="comment"> * https://github.com/tttapa/Control-Surface</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Include the library</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../db/dbf/Control__Surface_8h.html">Control_Surface.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Instantiate a MIDI Interface to use</span></div>
<div class="line"><a name="_a0"></a><a class="code" href="../../de/d2d/classUSBDebugMIDI__Interface.html">USBDebugMIDI_Interface</a> midi;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Instantiate a shift register as output for the LEDs</span></div>
<div class="line">SPIShiftRegisterOut&lt;8&gt; sreg = {</div>
<div class="line">  10,       <span class="comment">// Latch pin (ST_CP)</span></div>
<div class="line">  MSBFIRST, <span class="comment">// Byte order</span></div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="../../d7/d78/namespaceMIDI__Notes.html">MIDI_Notes</a>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create a LED bar driver that listens for MIDI Note C4 that drives</span></div>
<div class="line"><span class="comment">// the LEDs connected to the eight input pins of the shift register</span></div>
<div class="line"><a name="_a1"></a><a class="code" href="../../d9/dac/classNoteLEDBar.html">NoteLEDBar&lt;8&gt;</a> leds = { sreg.pins(), <a name="a2"></a><a class="code" href="../../d7/d78/namespaceMIDI__Notes.html#a559f01ec7251fdc9c5a5bc0e26b97372">note</a>(<a name="a3"></a><a class="code" href="../../d7/d78/namespaceMIDI__Notes.html#ac199d8a68ddb5b6aab199fc827947900">C</a>, 4) };</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Initialize the Control Surface</span></div>
<div class="line"><span class="keywordtype">void</span> setup() {</div>
<div class="line">  <a name="a4"></a><a class="code" href="../../d9/d38/Control__Surface__Class_8cpp.html#af7a5d250297d82b2b29605dd7ac250df">Control_Surface</a>.<a name="a5"></a><a class="code" href="../../dc/d45/classControl__Surface__.html#a1fda63983d83a8be20302e9fef48f63e">begin</a>();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Update the Control Surface</span></div>
<div class="line"><span class="keywordtype">void</span> loop() {</div>
<div class="line">  <a class="code" href="../../d9/d38/Control__Surface__Class_8cpp.html#af7a5d250297d82b2b29605dd7ac250df">Control_Surface</a>.<a name="a6"></a><a class="code" href="../../dc/d45/classControl__Surface__.html#a69fd0ae13604c39d6dc0da12fc94a18f">loop</a>();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * Extra</span></div>
<div class="line"><span class="comment"> * =====</span></div>
<div class="line"><span class="comment"> * </span></div>
<div class="line"><span class="comment"> * 1. The exact same approach can be used to make a LED bar graph that shows</span></div>
<div class="line"><span class="comment"> *    the value of a Control Change input.</span></div>
<div class="line"><span class="comment"> *    In that case, use CCLEDBar instead of NoteLEDBar.</span></div>
<div class="line"><span class="comment"> *    </span></div>
<div class="line"><span class="comment"> * 2. You can use any type of pins for the LEDs, and in any combination.</span></div>
<div class="line"><span class="comment"> *    For example, if you want to use the normal Arduino pins 2-9:</span></div>
<div class="line"><span class="comment"> *    </span></div>
<div class="line"><span class="comment"> *      NoteLEDBar&lt;8&gt; leds = { </span></div>
<div class="line"><span class="comment"> *          {{2, 3, 4, 5, 6, 7, 8, 9}}, </span></div>
<div class="line"><span class="comment"> *          note(C, 4), </span></div>
<div class="line"><span class="comment"> *      };</span></div>
<div class="line"><span class="comment"> *    </span></div>
<div class="line"><span class="comment"> *    Note the use of double braces for the list of numbers.</span></div>
<div class="line"><span class="comment"> *    </span></div>
<div class="line"><span class="comment"> *    You can even mix and match pins of different types:</span></div>
<div class="line"><span class="comment"> *    </span></div>
<div class="line"><span class="comment"> *      NoteLEDBar&lt;8&gt; leds = { </span></div>
<div class="line"><span class="comment"> *          {{2, 3, 4, 5, 6, 7, sreg.pin(0), sreg.pin(1) }},</span></div>
<div class="line"><span class="comment"> *          note(C, 4), </span></div>
<div class="line"><span class="comment"> *      };</span></div>
<div class="line"><span class="comment"> */</span></div>
</div><!-- fragment --> </div><!-- contents -->
<div class="ttc" id="aControl__Surface_8h_html"><div class="ttname"><a href="../../db/dbf/Control__Surface_8h.html">Control_Surface.h</a></div><div class="ttdoc">The main header file that includes all Control-Surface header files.</div></div>
<div class="ttc" id="aControl__Surface__Class_8cpp_html_af7a5d250297d82b2b29605dd7ac250df"><div class="ttname"><a href="../../d9/d38/Control__Surface__Class_8cpp.html#af7a5d250297d82b2b29605dd7ac250df">Control_Surface</a></div><div class="ttdeci">Control_Surface_ &amp; Control_Surface</div><div class="ttdoc">A predefined instance of the Control Surface to use in the Arduino sketches.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d38/Control__Surface__Class_8cpp_source.html#l00174">Control_Surface_Class.cpp:174</a></div></div>
<div class="ttc" id="anamespaceMIDI__Notes_html_a559f01ec7251fdc9c5a5bc0e26b97372"><div class="ttname"><a href="../../d7/d78/namespaceMIDI__Notes.html#a559f01ec7251fdc9c5a5bc0e26b97372">MIDI_Notes::note</a></div><div class="ttdeci">constexpr int8_t note(int8_t note, int8_t numOctave)</div><div class="ttdoc">Get the MIDI note in the given octave.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dc5/Notes_8hpp_source.html#l00035">Notes.hpp:35</a></div></div>
<div class="ttc" id="aclassControl__Surface___html_a1fda63983d83a8be20302e9fef48f63e"><div class="ttname"><a href="../../dc/d45/classControl__Surface__.html#a1fda63983d83a8be20302e9fef48f63e">Control_Surface_::begin</a></div><div class="ttdeci">void begin()</div><div class="ttdoc">Initialize the Control_Surface.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d38/Control__Surface__Class_8cpp_source.html#l00025">Control_Surface_Class.cpp:25</a></div></div>
<div class="ttc" id="aclassNoteLEDBar_html"><div class="ttname"><a href="../../d9/dac/classNoteLEDBar.html">NoteLEDBar</a></div><div class="ttdoc">Class that listens for Note events and displays the velocity on an LED Bar Graph.</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/ddf/NoteCCRangeLEDBar_8hpp_source.html#l00052">NoteCCRangeLEDBar.hpp:52</a></div></div>
<div class="ttc" id="anamespaceMIDI__Notes_html_ac199d8a68ddb5b6aab199fc827947900"><div class="ttname"><a href="../../d7/d78/namespaceMIDI__Notes.html#ac199d8a68ddb5b6aab199fc827947900">MIDI_Notes::C</a></div><div class="ttdeci">constexpr int8_t C</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dc5/Notes_8hpp_source.html#l00018">Notes.hpp:18</a></div></div>
<div class="ttc" id="aclassUSBDebugMIDI__Interface_html"><div class="ttname"><a href="../../de/d2d/classUSBDebugMIDI__Interface.html">USBDebugMIDI_Interface</a></div><div class="ttdoc">A class for debug MIDI interfaces sending and receiving human-readable MIDI messages over the USB CDC...</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d55/DebugMIDI__Interface_8hpp_source.html#l00115">DebugMIDI_Interface.hpp:115</a></div></div>
<div class="ttc" id="anamespaceMIDI__Notes_html"><div class="ttname"><a href="../../d7/d78/namespaceMIDI__Notes.html">MIDI_Notes</a></div><div class="ttdoc">MIDI note names.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dc5/Notes_8hpp_source.html#l00016">Notes.hpp:16</a></div></div>
<div class="ttc" id="aclassControl__Surface___html_a69fd0ae13604c39d6dc0da12fc94a18f"><div class="ttname"><a href="../../dc/d45/classControl__Surface__.html#a69fd0ae13604c39d6dc0da12fc94a18f">Control_Surface_::loop</a></div><div class="ttdeci">void loop()</div><div class="ttdoc">Update all MIDI elements, send MIDI events and read MIDI input.</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d38/Control__Surface__Class_8cpp_source.html#l00048">Control_Surface_Class.cpp:48</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.16
</small></address>
</body>
</html>
