<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Arduino Helpers: MCP23017-Encoders-No-Interrupts.ino</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/SVG"],
});
</script>
<script type="text/javascript" async="async" src="/MathJax/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../custom_stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Arduino Helpers
   &#160;<span id="projectnumber">master</span>
   </div>
   <div id="projectbrief">Utility library for Arduino</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">MCP23017-Encoders-No-Interrupts.ino</div>  </div>
</div><!--header-->
<div class="contents">
<h1><a class="anchor" id="autotoc_md46"></a>
MCP23017-Encoders-No-Interrupts</h1>
<p>This example demonstrates the use of <a class="el" href="../../d8/d84/classMCP23017.html" title="Class for MCP23017 I²C I/O expanders.">MCP23017</a> I²C port expanders with rotary encoders.</p>
<dl class="section user"><dt>Boards:</dt><dd>AVR, AVR USB, Nano Every, Nano 33 IoT, Nano 33 BLE, Due, Teensy 3.x, ESP8266, ESP32</dd></dl>
<h2><a class="anchor" id="autotoc_md47"></a>
Connections</h2>
<ul>
<li>SDA: <a class="el" href="../../d8/d84/classMCP23017.html" title="Class for MCP23017 I²C I/O expanders.">MCP23017</a> SDA</li>
<li>SCL: <a class="el" href="../../d8/d84/classMCP23017.html" title="Class for MCP23017 I²C I/O expanders.">MCP23017</a> SCL</li>
<li>12: <a class="el" href="../../d8/d84/classMCP23017.html" title="Class for MCP23017 I²C I/O expanders.">MCP23017</a> INTA or INTB</li>
</ul>
<p>Connect up to 8 encoders to the <a class="el" href="../../d8/d84/classMCP23017.html" title="Class for MCP23017 I²C I/O expanders.">MCP23017</a>'s GPIO pins: the first encoder connects to GPIO A0 and A1, the second encoder connects to GPIO A2 and A3, ..., the eighth encoder connects to GPIO B6 and B7. <br  />
 Connect the "common" pins of the encoders to ground. <br  />
 The built-in pull-up resistors of the <a class="el" href="../../d8/d84/classMCP23017.html" title="Class for MCP23017 I²C I/O expanders.">MCP23017</a> will be enabled.</p>
<p>Make sure that the reset and address pins are all configured correctly (reset to Vcc; A0, A1 and A2 to ground).</p>
<p>If you need more than one <a class="el" href="../../d8/d84/classMCP23017.html" title="Class for MCP23017 I²C I/O expanders.">MCP23017</a> with encoders, you can connect their interrupt pins together. This does result in higher latency, because on average, half of the total number of MCP23017s have to be polled, which is relatively slow, and might lead to missed pulses when using a large number of encoders.</p>
<h2><a class="anchor" id="autotoc_md48"></a>
Behavior</h2>
<p>When the position of one of the encoders changes, it is printed to the Serial monitor.</p>
<h2><a class="anchor" id="autotoc_md49"></a>
Cautions</h2>
<p>The interrupt pin of the <a class="el" href="../../d8/d84/classMCP23017.html" title="Class for MCP23017 I²C I/O expanders.">MCP23017</a> doesn't trigger a hardware interrupt on the Arduino. It's used only to determine whether the Arduino should read the GPIO registers from the <a class="el" href="../../d8/d84/classMCP23017.html" title="Class for MCP23017 I²C I/O expanders.">MCP23017</a>. <br  />
 If the update function isn't called often enough, you will miss encoder pulses, and the position will be incorrect. <br  />
 It's very important to keep your main loop free from any code that blocks for more than a couple of hundreds of microseconds.</p>
<p>Written by PieterP, 2020-04-06 <br  />
 <a href="https://github.com/tttapa/Arduino-Helpers">https://github.com/tttapa/Arduino-Helpers</a></p>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../dc/de6/Arduino__Helpers_8h.html">Arduino_Helpers.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d8/dd2/MCP23017Encoders_8hpp.html">AH/Hardware/MCP23017Encoders.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../dd/d80/PrintStream_8hpp.html">AH/PrintStream/PrintStream.hpp</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;Wire.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using</span> WireType = decltype(Wire);     <span class="comment">// The type of I²C driver to use</span></div>
<div class="line"><span class="keyword">using</span> EncoderPositionType = int32_t; <span class="comment">// The type for saving encoder positions</span></div>
<div class="line"><span class="keyword">using</span> MCPEncoderType = <a name="_a0"></a><a class="code" href="../../d5/dd0/classMCP23017Encoders.html">MCP23017Encoders&lt;WireType, EncoderPositionType&gt;</a>;</div>
<div class="line"> </div>
<div class="line">MCPEncoderType enc = {Wire, 0x0, 12};</div>
<div class="line"><span class="comment">//                    │     │    └─ Interrupt pin</span></div>
<div class="line"><span class="comment">//                    │     └────── Address offset</span></div>
<div class="line"><span class="comment">//                    └──────────── I²C interface</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> setup() {</div>
<div class="line">  Serial.<a name="a1"></a><a class="code" href="../../d5/dd0/classMCP23017Encoders.html#ab0bdf5cca484fb2ba637c39384b27fb2">begin</a>(115200);</div>
<div class="line">  Wire.begin(); <span class="comment">// Must be called before enc.begin()</span></div>
<div class="line">  Wire.setClock(800000);</div>
<div class="line">  enc.begin(); <span class="comment">// Initialize the MCP23017</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> loop() {</div>
<div class="line">  enc.update(); <span class="comment">// Read the state of the encoders and update the positions</span></div>
<div class="line">  </div>
<div class="line">  <span class="comment">// Save the previous positions</span></div>
<div class="line">  <span class="keyword">static</span> EncoderPositionType prevPositions[8] = {};</div>
<div class="line">  <span class="comment">// Check if an encoder position changed and print it</span></div>
<div class="line">  <span class="keywordflow">for</span> (uint8_t i = 0; i &lt; 8; ++i) {</div>
<div class="line">    <span class="keywordflow">if</span> (enc.read(i) != prevPositions[i]) {</div>
<div class="line">      Serial &lt;&lt; <span class="charliteral">&#39;[&#39;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;] &quot;</span> &lt;&lt; enc.read(i) &lt;&lt; <a name="a2"></a><a class="code" href="../../d8/d4b/group__AH__PrintStream.html#gaae13bd0e8ea7184cf85b86bcd1a01e2d">endl</a>;</div>
<div class="line">      prevPositions[i] = enc.read(i);</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="ttc" id="aArduino__Helpers_8h_html"><div class="ttname"><a href="../../dc/de6/Arduino__Helpers_8h.html">Arduino_Helpers.h</a></div><div class="ttdoc">Dummy header file for Arduino builder.</div></div>
<div class="ttc" id="aMCP23017Encoders_8hpp_html"><div class="ttname"><a href="../../d8/dd2/MCP23017Encoders_8hpp.html">MCP23017Encoders.hpp</a></div></div>
<div class="ttc" id="aPrintStream_8hpp_html"><div class="ttname"><a href="../../dd/d80/PrintStream_8hpp.html">PrintStream.hpp</a></div></div>
<div class="ttc" id="aclassMCP23017Encoders_html"><div class="ttname"><a href="../../d5/dd0/classMCP23017Encoders.html">MCP23017Encoders</a></div><div class="ttdoc">Class for reading 8 rotary encoders using a MCP23017 I²C port expander.</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd2/MCP23017Encoders_8hpp_source.html#l00058">MCP23017Encoders.hpp:58</a></div></div>
<div class="ttc" id="aclassMCP23017Encoders_html_ab0bdf5cca484fb2ba637c39384b27fb2"><div class="ttname"><a href="../../d5/dd0/classMCP23017Encoders.html#ab0bdf5cca484fb2ba637c39384b27fb2">MCP23017Encoders::begin</a></div><div class="ttdeci">void begin()</div><div class="ttdoc">Initialize the MCP23017.</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/dd2/MCP23017Encoders_8hpp_source.html#l00155">MCP23017Encoders.hpp:155</a></div></div>
<div class="ttc" id="agroup__AH__PrintStream_html_gaae13bd0e8ea7184cf85b86bcd1a01e2d"><div class="ttname"><a href="../../d8/d4b/group__AH__PrintStream.html#gaae13bd0e8ea7184cf85b86bcd1a01e2d">endl</a></div><div class="ttdeci">Print &amp; endl(Print &amp;printer)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d69/PrintStream_8cpp_source.html#l00027">PrintStream.cpp:27</a></div></div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
