<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Control Surface: Toggle-LEDs.ino</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/SVG"],
});
</script><script type="text/javascript" async="async" src="/MathJax/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../custom_stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Control Surface
   &#160;<span id="projectnumber">master</span>
   </div>
   <div id="projectbrief">MIDI Control Surface library for Arduino</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Toggle-LEDs.ino</div>  </div>
</div><!--header-->
<div class="contents">
<h1><a class="anchor" id="autotoc_md61"></a>
Toggle-LEDs</h1>
<p>This example demonstrates the use of push buttons and LEDs and how to use shift registers and analog multiplexers to save pins.</p>
<dl class="section user"><dt>Boards:</dt><dd>AVR, AVR USB, Nano 33, Due, Teensy 3.x, ESP8266, ESP32</dd></dl>
<h2><a class="anchor" id="autotoc_md62"></a>
Connections</h2>
<ul>
<li>SS: 74HC595 ST_CP</li>
<li>MOSI: 74HC595 DS</li>
<li>SCK: 74HC595 SH_CP</li>
<li>2: 74HC4067 A (COM OUT/IN)</li>
<li>3: 74HC4067 S0</li>
<li>4: 74HC4067 S1</li>
<li>5: 74HC4067 S2</li>
<li>6: 74HC4067 S3</li>
</ul>
<p>Connect 16 momentary push buttons between the input pins of the multiplexer and ground. <br  />
 The internal pull-up resistor for the buttons will be enabled automatically, so no external resistors are necessary.</p>
<p>Connect 16 LEDs (and series resistors) between the eight outputs of the two shift registers and ground.</p>
<p>Remember to connect the enable pins of both the multiplexer and the shift registers to ground in order to enable them. Also connect the master reset pin of the shift registers to Vcc. <br  />
 Connect the serial data output of the first shift register (QH' or Q7S) to the serial input of the second shift register.</p>
<h2><a class="anchor" id="autotoc_md63"></a>
Behavior</h2>
<p>Pressing the first button will turn on the first LED. Pressing it again will turn it off again. Pressing the second button will turn on the second LED. Pressing it again will turn it off again, and so on.</p>
<p>Written by PieterP, 2018-08-28 <br  />
 <a href="https://github.com/tttapa/Arduino-Helpers">https://github.com/tttapa/Arduino-Helpers</a></p>
<div class="fragment"><div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * This example demonstrates the use of push buttons and LEDs and how to use</span></div>
<div class="line"><span class="comment"> * shift registers and analog multiplexers to save pins.</span></div>
<div class="line"><span class="comment"> * </span></div>
<div class="line"><span class="comment"> * @boards  AVR, AVR USB, Nano 33, Due, Teensy 3.x, ESP8266, ESP32</span></div>
<div class="line"><span class="comment"> * </span></div>
<div class="line"><span class="comment"> * Connections</span></div>
<div class="line"><span class="comment"> * -----------</span></div>
<div class="line"><span class="comment"> * </span></div>
<div class="line"><span class="comment"> *   - SS:   74HC595 ST_CP</span></div>
<div class="line"><span class="comment"> *   - MOSI: 74HC595 DS</span></div>
<div class="line"><span class="comment"> *   - SCK:  74HC595 SH_CP</span></div>
<div class="line"><span class="comment"> *   - 2: 74HC4067 A (COM OUT/IN)</span></div>
<div class="line"><span class="comment"> *   - 3: 74HC4067 S0</span></div>
<div class="line"><span class="comment"> *   - 4: 74HC4067 S1</span></div>
<div class="line"><span class="comment"> *   - 5: 74HC4067 S2</span></div>
<div class="line"><span class="comment"> *   - 6: 74HC4067 S3</span></div>
<div class="line"><span class="comment"> * </span></div>
<div class="line"><span class="comment"> * Connect 16 momentary push buttons between the input pins of the </span></div>
<div class="line"><span class="comment"> * multiplexer and ground.  </span></div>
<div class="line"><span class="comment"> * The internal pull-up resistor for the buttons will be enabled automatically,</span></div>
<div class="line"><span class="comment"> * so no external resistors are necessary.</span></div>
<div class="line"><span class="comment"> * </span></div>
<div class="line"><span class="comment"> * Connect 16 LEDs (and series resistors) between the eight outputs of the</span></div>
<div class="line"><span class="comment"> * two shift registers and ground. </span></div>
<div class="line"><span class="comment"> * </span></div>
<div class="line"><span class="comment"> * Remember to connect the enable pins of both the multiplexer and the shift</span></div>
<div class="line"><span class="comment"> * registers to ground in order to enable them. Also connect the master reset </span></div>
<div class="line"><span class="comment"> * pin of the shift registers to Vcc.  </span></div>
<div class="line"><span class="comment"> * Connect the serial data output of the first shift register (QH&#39; or Q7S) to</span></div>
<div class="line"><span class="comment"> * the serial input of the second shift register.</span></div>
<div class="line"><span class="comment"> * </span></div>
<div class="line"><span class="comment"> * Behavior</span></div>
<div class="line"><span class="comment"> * --------</span></div>
<div class="line"><span class="comment"> *  </span></div>
<div class="line"><span class="comment"> * Pressing the first button will turn on the first LED. Pressing it again will</span></div>
<div class="line"><span class="comment"> * turn it off again.</span></div>
<div class="line"><span class="comment"> * Pressing the second button will turn on the second LED. Pressing it again </span></div>
<div class="line"><span class="comment"> * will turn it off again, and so on.</span></div>
<div class="line"><span class="comment"> * </span></div>
<div class="line"><span class="comment"> * Written by PieterP, 2018-08-28  </span></div>
<div class="line"><span class="comment"> * https://github.com/tttapa/Arduino-Helpers</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../dc/de6/Arduino__Helpers_8h.html">Arduino_Helpers.h</a>&gt;</span> <span class="comment">// Include the Arduino Helpers library.</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d5/db6/ArrayHelpers_8hpp.html">AH/Containers/ArrayHelpers.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d4/db3/Button_8hpp.html">AH/Hardware/Button.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d7/def/AnalogMultiplex_8hpp.html">AH/Hardware/ExtendedInputOutput/AnalogMultiplex.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d7/d88/SPIShiftRegisterOut_8hpp.html">AH/Hardware/ExtendedInputOutput/SPIShiftRegisterOut.hpp</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Instantiate a multiplexer</span></div>
<div class="line"><a name="a0"></a><a class="code" href="../../db/dd3/group__AH__ExtIO.html#ga0f0c7f73d22542f0ff7df26b5a74c448">CD74HC4067</a> mux = {</div>
<div class="line">  2,            <span class="comment">// input pin</span></div>
<div class="line">  {3, 4, 5, 6}, <span class="comment">// Address pins S0, S1, S2, S3</span></div>
<div class="line">  <span class="comment">// 7, // Optionally, specify the enable pin</span></div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Alternatively, if you have a 3-bit mux:</span></div>
<div class="line"><span class="comment">// CD74HC4051 mux = {</span></div>
<div class="line"><span class="comment">//   2,</span></div>
<div class="line"><span class="comment">//   {3, 4, 5},</span></div>
<div class="line"><span class="comment">//   // 7, // Optional</span></div>
<div class="line"><span class="comment">// };</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Instantiate a shift register with the SPI slave select pin as latch pin, most</span></div>
<div class="line"><span class="comment">// significant bit first, and a total of 16 outputs.</span></div>
<div class="line">SPIShiftRegisterOut&lt;mux.length()&gt; sreg = {SS, MSBFIRST};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Instantiate an array of momentary push buttons.</span></div>
<div class="line"><span class="comment">// It generates an array of Buttons on pins:</span></div>
<div class="line"><span class="comment">// { mux.pin(0), mux.pin(1) ... mux.pin(15) }</span></div>
<div class="line"><span class="comment">// For each button it creates, it increments the pin number by 1,</span></div>
<div class="line"><span class="comment">// and it starts counting from mux.pin(0)</span></div>
<div class="line"><span class="keyword">auto</span> buttons = <a name="a1"></a><a class="code" href="../../dc/d69/namespaceAH.html#ab7b9dc6793f9c9c808f62617550e1472">generateIncrementalArray</a>&lt;Button, mux.length()&gt;(mux.pin(0));</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> setup() { <span class="comment">// Initialize everything</span></div>
<div class="line">  mux.begin();</div>
<div class="line">  sreg.begin();</div>
<div class="line">  <span class="keywordflow">for</span> (Button &amp;button : buttons)</div>
<div class="line">    button.begin();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> loop() { <span class="comment">// Check if a button is pressed, if so toggle the LED</span></div>
<div class="line">  <span class="keywordflow">for</span> (uint8_t i = 0; i &lt; mux.length(); ++i)</div>
<div class="line">    <span class="keywordflow">if</span> (buttons[i].update() == Button::Falling)</div>
<div class="line">      sreg.digitalWrite(i, !sreg.digitalRead(i));</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
<div class="ttc" id="aButton_8hpp_html"><div class="ttname"><a href="../../d4/db3/Button_8hpp.html">Button.hpp</a></div></div>
<div class="ttc" id="aSPIShiftRegisterOut_8hpp_html"><div class="ttname"><a href="../../d7/d88/SPIShiftRegisterOut_8hpp.html">SPIShiftRegisterOut.hpp</a></div></div>
<div class="ttc" id="anamespaceAH_html_ab7b9dc6793f9c9c808f62617550e1472"><div class="ttname"><a href="../../dc/d69/namespaceAH.html#ab7b9dc6793f9c9c808f62617550e1472">AH::generateIncrementalArray</a></div><div class="ttdeci">Array&lt; T, N &gt; generateIncrementalArray(U start=0, V increment=V(1))</div><div class="ttdoc">Generate an array where the first value is given, and the subsequent values are calculated as the pre...</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/db6/ArrayHelpers_8hpp_source.html#l00183">ArrayHelpers.hpp:183</a></div></div>
<div class="ttc" id="aAnalogMultiplex_8hpp_html"><div class="ttname"><a href="../../d7/def/AnalogMultiplex_8hpp.html">AnalogMultiplex.hpp</a></div></div>
<div class="ttc" id="aArrayHelpers_8hpp_html"><div class="ttname"><a href="../../d5/db6/ArrayHelpers_8hpp.html">ArrayHelpers.hpp</a></div></div>
<div class="ttc" id="agroup__AH__ExtIO_html_ga0f0c7f73d22542f0ff7df26b5a74c448"><div class="ttname"><a href="../../db/dd3/group__AH__ExtIO.html#ga0f0c7f73d22542f0ff7df26b5a74c448">AH::CD74HC4067</a></div><div class="ttdeci">AnalogMultiplex&lt; 4 &gt; CD74HC4067</div><div class="ttdoc">An alias for AnalogMultiplex&lt;4&gt; to use with CD74HC4067 analog multiplexers.</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/def/AnalogMultiplex_8hpp_source.html#l00146">AnalogMultiplex.hpp:146</a></div></div>
<div class="ttc" id="aArduino__Helpers_8h_html"><div class="ttname"><a href="../../dc/de6/Arduino__Helpers_8h.html">Arduino_Helpers.h</a></div><div class="ttdoc">Dummy header file for Arduino builder. You have to add this file first, so the other headers are in t...</div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.16
</small></address>
</body>
</html>
